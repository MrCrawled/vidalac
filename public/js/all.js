Ext.apply(Ext,{isFirebug:(window.console&&window.console.firebug)});Ext.chart.Chart.CHART_URL='/js/ext/resources/charts.swf';Ext.Window.prototype.floating={shadow:!1};Ext.Panel.prototype.shadow=!1;Ext.QuickTip.prototype.floating={shadow:!1};Ext.QuickTip.prototype.frame=!1;Ext.QuickTip.prototype.tagConfig.url='qurl';Ext.override(Ext.QuickTip,{urlBodyUpdate:function(t){var u,url,et=Ext.fly(t.el),cfg=this.tagConfig,ns=cfg.namespace;url=et.getAttribute(cfg.url,ns);if(url){u=this.body.getUpdater();u.update({scope:this,url:url,callback:function(el,success,response,options){if(success&&(et=Ext.fly(t.el))){var o={};o[ns+':'+cfg.attribute]=response.responseText;o[ns+':'+cfg.url]='';et.set(o);if(!t.width){this.doAutoWidth()}}}})}},showAt:Ext.QuickTip.prototype.showAt.createSequence(function(xy){var t=this.activeTarget;if(t){this.urlBodyUpdate(t)}})});Ext.override(Ext.chart.Chart,{refresh:function(){if(this.fireEvent('beforerefresh',this)!==!1){var styleChanged=!1;var data=[],rs=this.store.data.items;for(var j=0,len=rs.length;j<len;j++){data[j]=rs[j].data}
var dataProvider=[];var seriesCount=0;var currentSeries=null;var i=0;if(this.series){seriesCount=this.series.length;for(i=0;i<seriesCount;i++){currentSeries=this.series[i];var clonedSeries={};for(var prop in currentSeries){if(prop=="style"&&currentSeries.style!==null){clonedSeries.style=Ext.encode(currentSeries.style);styleChanged=!0}else{clonedSeries[prop]=currentSeries[prop]}}
dataProvider.push(clonedSeries)}}
if(seriesCount>0){for(i=0;i<seriesCount;i++){currentSeries=dataProvider[i];if(!currentSeries.type){currentSeries.type=this.type}
currentSeries.dataProvider=data}}else{dataProvider.push({type:this.type,dataProvider:data})}
if(this.swf&&this.swf.setDataProvider){this.swf.setDataProvider(dataProvider)}
if(this.seriesStyles){this.setSeriesStyles(this.seriesStyles)}
this.fireEvent('refresh',this)}}});var ajaxErrorHandler=function(obj,response,options,e)
{if(response.status==506){Rad.confirmDialog(Ext.util.JSON.decode(response.responseText),function(btn,text,cnf){options.headers.confirm='{"uid":"'+cnf.uid+'","data":"'+btn+'"}';obj.request(options)});return!1}
if(response.status==505){var loginWin=new Rad.loginWindow();loginWin.show();return!1}
if(response.status==501){errorCode=Ext.util.JSON.decode(response.responseText);if(errorCode.error){app.publish('/desktop/modules/Develop/debugconsole',{'action':'servererror','title':errorCode.title,'error':errorCode.error,'date':errorCode.date})}}else{msg=response.responseText;if(!msg){switch(response.status){case 500:msg='Error del lado del servidor';break;case 404:msg='No existe el controlador';default:msg='Error status: '+response.status+'<br>'+msg}}
app.publish('/desktop/showMsg',{title:'Error',msg:msg,renderTo:'x-desktop',modal:!0,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})}};Ext.util.Observable.observeClass(Ext.data.Connection);Ext.data.Connection.on('requestexception',ajaxErrorHandler);Ext.namespace('Rad');Rad.confirmDialog=function(cnf,callback){var btns=(cnf.options.includeCancel)?Ext.MessageBox.YESNOCANCEL:Ext.MessageBox.YESNO;app.desktop.showMsg({title:'Atencion',msg:cnf.msg,modal:!0,width:300,buttons:btns,icon:Ext.MessageBox.INFO,fn:function(btn,text){if((cnf.options.includeCancel&&btn!='cancel')||(!cnf.options.includeCancel&&btn!='no')){callback(btn,text,cnf)}}})}
Rad.loginWindow=Ext.extend(Ext.Window,{title:'SmartGestión',width:300,height:260,resizable:!1,border:!1,closable:!1,buttonAlign:'center',layout:'fit',onSuccess:Ext.emptyFn,initComponent:function(){var usuarioField=new Ext.form.TextField({fieldLabel:'Usuario',value:'',name:'login',hasfocus:!0,width:150,allowBlank:!1,listeners:{'specialkey':{fn:function(obj,e){if(e.getKey()==13)this.formulario.login.apply(this)},scope:this}}});this.formulario=new Ext.form.FormPanel({baseCls:'x-plain',labelWidth:80,labelAlign:'right',defaultButton:usuarioField,standardSubmit:!1,region:'center',login:function(){if(this.formulario.getForm().isValid()){this.formulario.getForm().submit({scope:this,standardSubmit:!1,waitMsg:'Por favor espere...',url:'/auth/login',failure:function(form,action){Ext.Msg.show({title:'Error',msg:action.result.msg,modal:!0,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})},success:function(form,action){this.onSuccess();this.close()}})}else{Ext.Msg.show({title:'Error',msg:'Por favor ingrese un Usuario y Contraseña correctos.',modal:!0,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})}},items:[usuarioField,new Ext.form.TextField({fieldLabel:'Clave',value:'',name:'password',width:150,inputType:'password',allowBlank:!1,listeners:{'specialkey':{fn:function(obj,e){if(e.getKey()==13)this.formulario.login.apply(this)},scope:this}}}),new Ext.form.Checkbox({fieldLabel:'Recordarme',name:'remember',inputValue:'1'})]});this.items=[{xtype:'panel',style:'padding-left:10px;text-align:center;',border:!1,layout:'border',items:[{xtype:'panel',html:'<img src="images/cargando.jpg">',border:!1,region:'north',height:110,bodyStyle:'background:#fff;'},this.formulario]}];this.buttons=[{id:'submit-button',text:'Login',scope:this,handler:this.formulario.login}];Rad.loginWindow.superclass.initComponent.call(this)}});Rad.callRemoteJsonAction=function(params){if(params.async==null)params.async=!0;var cfg={url:params.url,async:params.async,params:params.params,success:function(result,request){var response=Ext.util.JSON.decode(result.responseText);if(response.success){params.success.call(this,response)}else{if(!params.failure||params.failure(response)){app.publish('/desktop/showError',response.msg)}}}};if(params.scope)cfg.scope=params.scope;Ext.Ajax.request(cfg)};Rad.autoHideFields=function(form,combo,rules){var desactivados={};combo.on('select',function(t,data,id){for(var key in desactivados){var field=form.getForm().findField(key);if(field){field.show()}}
desactivados={};if(rules[data.id]){des=rules[data.id];for(var i=des.length-1;i>=0;i--){var field=form.getForm().findField(des[i]);if(field){desactivados[des[i]]=1;field.reset();field.hide()}}}})};Ext.ns('Rad');Rad.Wizard=Ext.extend(Ext.Panel,{txtNext:'Siguiente >>',txtPrev:'<< Atras',txtFinish:'Finalizar',position:0,initComponent:function(){this.addEvents('next','prev','finish','activate');this.buttonPrev=new Ext.Toolbar.Button({text:'<< Atras',handler:this.prev,disabled:!0,scope:this,current:0});this.buttonNext=new Ext.Toolbar.Button({text:'Siguiente >>',handler:this.next,scope:this,disabled:!1,current:0});var config={layout:'card',activeItem:0,bbar:['->',this.buttonPrev,'|',this.buttonNext]};Ext.apply(this,config);Ext.apply(this.initialConfig,config);Rad.Wizard.superclass.initComponent.apply(this,arguments)},next:function(){this.cardNav(1)},prev:function(){this.cardNav(-1)},getActiveItem:function(){return this.getLayout().activeItem},getItemsCount:function(){return this.items.getCount()},onFinish:function(){this.fireEvent("finish",this)},setActiveItem:function(item){if(item<0||item>this.getItemsCount()-1){alert('RadWizard: No existe el item '+item);return}else if(item>0){this.buttonPrev.enable()}else{this.buttonPrev.disable()}
if(item==this.getItemsCount()-1){this.buttonNext.setText(this.txtFinish);this.buttonNext.setHandler(this.onFinish,this)}else{this.buttonNext.setText(this.txtNext);this.buttonNext.setHandler(this.next,this)}
this.position=item;this.getLayout().setActiveItem(item);this.fireEvent("activate",item)},cardNav:function(nav){var dest=this.position+nav;if(nav==1){var ok=this.fireEvent("next",this.position)!==!1}else{var ok=this.fireEvent("prev",this.position)!==!1}
if(ok){this.setActiveItem(dest)}}});Ext.ns('RadDesktop');Ext.data.DataProxy.on('exception',function(proxy,type,action,exception,request){if(request.status==506){return!1}
if(request.status!=505){if(request.message){window.app.publish('/desktop/showError',request.message)}else if(request.responseText){window.app.publish('/desktop/showError',request.responseText)}else{window.app.publish('/desktop/showError','Error de comunicacion con el servidor')}}});Ext.Direct.on("exception",function(event){if(event.relogin=='relogin'){var loginWin=new Rad.loginWindow();loginWin.show();return}
if(event.confirm){var t=event.getTransaction();Rad.confirmDialog(event,function(btn,text,cnf){t.headers={}
t.headers.confirm='{"uid":"'+cnf.uid+'","data":"'+btn+'"}';Ext.Direct.addTransaction(t);t.retry()});return}
window.app.publish('/desktop/showError',event.message)});Ext.ns('Models');RadDesktop.App=Ext.extend(Ext.util.Observable,{constructor:function(config){Ext.apply(this,config);this.addEvents({'ready':!0,'beforeunload':!0});window.app=this;Ext.onReady(this.initApp,this)},idCounter:1,id:function(x){return(x||'rd-gen')+(++app.idCounter)},isReady:!1,startMenu:null,modules:[],getStartConfig:function(){},channels:{registerApp:'/desktop/module/register',apps:'/desktop/modules',registerModelApi:'/desktop/model/register'},initApp:function(){this.subscribe(this.channels.registerApp,this.eventRegisterModule,this);this.subscribe(this.channels.apps,this.eventCallApp,this);this.subscribe(this.channels.registerModelApi,this.eventRegisterModel,this);this.startConfig=this.startConfig||this.getStartConfig();this.desktop=new RadDesktop.Desktop(this);this.wamp=new Rad.wamp({wsuri:'wss://'+window.location.hostname+':8443'});this.init();Ext.EventManager.on(window,'beforeunload',this.onUnload,this);this.fireEvent('ready',this);this.isReady=!0},eventRegisterModel:function(ev){},eventCallApp:function(ev,channel){module=app.getModule(channel);if(module){return!0}else{if(!ev.rethrow){this.fetchRemoteModule(channel,ev);return!1}else{this.publish('/desktop/showError','Error al cargar el modulo')}
return!1}},fetchRemoteModule:function(channel,ev){this.publish('/desktop/notify',{title:'Cargando...',iconCls:'x-icon-information',html:'El modulo se esta cargando'});var url=channel.replace(this.channels.apps,'');new RadDesktop.FileFetcher({files:[url],noCache:!1,start:!0,success:function(){ev.rethrow=!0;this.publish(channel,ev)},failure:function(){this.publish('/desktop/notify',{title:'Error',iconCls:'x-icon-error',html:'Error al cargar el modulo'})},scope:this})},getModule:function(channel){var ms=this.modules;for(var i=0,len=ms.length;i<len;i++){if(ms[i].channel==channel||ms[i].id==channel){return ms[i]}}
return ''},eventRegisterModule:function(ev){if(!this.isReady){return Ext.onReady(this.eventRegisterApp.createDelegate(this,[ev]))}
module=this.getModule(ev.channel);if(module==''){this.modules.push(ev);if(ev.trayIcon){app.desktop.taskbar.trayPanel.add(ev.trayIcon)}}else{module=ev}},getModules:Ext.emptyFn,init:Ext.emptyFn,onReady:function(fn,scope){if(!this.isReady){this.on('ready',fn,scope)}else{fn.call(scope,this)}},getDesktop:function(){return this.desktop},onUnload:function(e){if(this.fireEvent('beforeunload',this)===!1){e.stopEvent()}}});RadDesktop.FileFetcher=Ext.extend(Ext.util.Observable,{extRegexp:/\.([^\./]+)$/,basedirRegexp:/(^.+)\/[^\/]*$/,constructor:function(config){this.queue=[];this.active=!1;if(Ext.isArray(config))
this.load({files:config});if(Ext.isObject(config))
this.start(config)},load:function(data){if(Ext.isArray(data.files)){var files=data.files;delete data.files;for(var i=0,len=files.length;i<len;i++)
this.queue.push(Ext.copyTo({file:files[i]},data,'callback,scope,noCache'))}else this.queue.push(Ext.copyTo({file:data.file},data,'callback,scope,noCache'))},getType:function(file){var r=this.extRegexp.exec(file);if(r)
return r[1];else return 'js'},getBaseDir:function(file){var r=this.basedirRegexp.exec(file);return r[1]},start:function(config){var start=config.start?!0:!1;delete config.start;Ext.apply(this,config);if(this.files)
this.load({files:this.files});if(start||!config)
this.checkQueue()},checkQueue:function(){if(this.active)
return;this.active=!0;var item=this.queue[0];if(!item.type)
item.type=this.getType(item.file);item.id=app.id(item.type+'-file-');item.basedir=this.getBaseDir(item.file);switch(item.type){case 'js':Ext.Ajax.request({method:'GET',url:item.file,scope:this,disableCaching:(item.noCache||this.noCache?!0:!1),success:function(res){try{eval(res.responseText);this.requestDone()}catch(e){var msg;var error=null;try{error=Ext.util.JSON.decode(res.responseText)}catch(e2){}
if(error){msg=error.msg}else{msg=e.message;if(e.lineNumber)msg+='<br>linea '+(e.lineNumber-328)+' en '+e.fileName}
app.publish('/desktop/showMsg',{title:'Error',msg:msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});this.requestFailed()}},failure:this.requestFailed});break;case 'css':Ext.Ajax.request({method:'GET',url:item.file,scope:this,disableCaching:(item.noCache||this.noCache?!0:!1),success:function(res){var txt=res.responseText.replace('url(','url('+item.basedir+'/','g');txt=txt.replace("src='","src='"+item.basedir+'/','g');Ext.util.CSS.createStyleSheet(txt,this.queue[0].id);this.requestDone()},failure:this.requestFailed});break;default:}},requestDone:function(){this.active=!1;var item=this.queue.shift();if(this.itemHandler){if(this.scope)
this.itemHandler.call(this.scope,item);else this.itemHandler(item)}
if(item.callback){if(item.scope)
item.callback.call(item.scope,this,item);else item.callback(this,item)}
if(this.queue.length)
this.checkQueue.defer(10,this);else{if(this.scope)
this.success.call(this.scope,this);else this.success(this)}},requestFailed:function(){this.active=!1;if(this.failure){if(this.scope)
this.failure.call(this.scope,this);else this.failure(this)}},callback:function(callback,scope){this.queue.push({type:'callback',callback:callback,scope:scope})}});RadDesktop.Module=Ext.extend(Ext.util.Observable,{trayIcon:null,requires:null,eventQueue:[],started:!1,constructor:function(config){Ext.apply(this,config);if(!this.id){this.id=app.id('app-')}
if(!this.appChannel){this.appChannel=RadDesktop.App.channels.apps+this.id}
this.subscribe(this.appChannel,this.eventReceived,this);this.register({id:this.id,channel:this.appChannel,title:this.title,trayIcon:this.trayIcon});this.init(config);if(this.requires){this.loadFiles(this.requires)}else{this.startup();this.postStartup()}},postStartup:function(){this.started=!0;while(this.eventQueue.length>0){ev=this.eventQueue.pop();this.eventReceived(ev,this.appChannel)}},init:Ext.emptyFn,startup:Ext.emptyFn,eventReceived:function(ev,channel){if(channel!=this.appChannel)return;if(!this.started){this.eventQueue.push(ev)}else{if(this['event'+ev.action]){this['event'+ev.action].call(this,ev)}}},register:function(ev){this.publish(app.channels.registerApp,ev)},__loadSuccess:function(){this.__fetcher=null;this.startup();this.postStartup()},__loadFailure:function(){this.__retryCount++;if(this.__retryCount>10){this.publish('/desktop/notify',{title:'Error',iconCls:'x-icon-error',html:'Error al cargar dependencias para el modulo'});return}
this.__fetcher.start()},__loadedFile:function(data){},loadFiles:function(files){if(Ext.isEmpty(files))
return;if(!Ext.isArray(files))
files=[files];this.__fetcher=new RadDesktop.FileFetcher({files:files,noCache:!1,start:!0,itemHandler:this.__loadedFile,success:this.__loadSuccess,failure:this.__loadFailure,scope:this})}});Ext.override(Ext.menu.BaseItem,{initComponent:function(){Ext.menu.BaseItem.superclass.initComponent.apply(this,arguments);if(this.channel&&!this.handler){this.on('click',function(){this.publish(this.channel,{action:'launch'})},this)}
if(this.handler)
this.on('click',this.handler,this.scope||this)}});(function(){Ext.namespace('Ext.ux.Sprocket');var singleton=null;Ext.override(Ext.util.Observable,{subscribe:function(eventName,fn,scope,o){singleton.addEvents(eventName);singleton.on(eventName,fn,scope,o);if(!this.events)
this.events={};this.on('destroy',singleton.un.createDelegate(singleton,[eventName,fn,scope,o],!1))},publish:function(eventName,event){if(singleton.eventsSuspended===!0)
return!0;var glob=singleton.events['*'];if(glob)
if(glob.fire.call(glob,event,eventName)===!1)
return!0;if(eventName.substr(0,1)=='/'&&eventName.length>1){var chans=eventName.substr(1).split('/');var matched=!1;for(var i=0,len=chans.length;i<=len;i++){var fn=singleton.events['/'+chans.slice(0,i).join('/').toLowerCase()];if(fn){matched=!0;if(fn.fire.call(fn,event,eventName)===!1)
return!0}}
return matched}else{var fn=singleton.events[eventName.toLowerCase()];if(fn){fn.fire.call(fn,event,eventName);return!0}}
return!1},removeSubscribers:function(eventName){if(eventName!==undefined){eventName=eventName.toLowerCase();var fn=singleton.events[eventName];if(fn)
fn.clearListeners();delete singleton.events[eventName]}else{Ext.iterate(singleton.events,function(k,v,o){v.clearListeners();delete o[k]})}}});singleton=Ext.ux.Sprocket.PubSub=new Ext.util.Observable();singleton.events={}})();Ext.ns('RadDesktop');RadDesktop.Desktop=function(app){this.taskbar=new Ext.ux.TaskBar(app);var taskbar=this.taskbar;this.el=Ext.get('x-desktop');var desktopEl=this.el;var taskbarEl=Ext.get('ux-taskbar');this.shortcuts=new Ext.ux.Shortcuts({renderTo:'x-desktop',viewId:'x-desktop-view',taskbarEl:taskbarEl});this.config={styles:{},launchers:{}};this.initialConfig=null;this.subscribe('/desktop/showMsg',function(config){config.title=config.title||'Sistema';this.showMsg(config)},this);this.subscribe('/desktop/showError',function(msg){this.showMsg({title:'Error',msg:msg,modal:!0,manager:window.app.desktop.getManager(),icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})},this);this.subscribe('/desktop/showWarning',function(msg){this.showMsg({title:'Advertencia',msg:msg,modal:!0,manager:window.app.desktop.getManager(),icon:Ext.Msg.WARNING,buttons:Ext.Msg.OK})},this);this.subscribe('/desktop/wait',function(msg){this.showMsg({progressText:'Espere por favor...',msg:msg,modal:!0,manager:window.app.desktop.getManager(),closable:!1,width:300,wait:!0,waitConfig:{interval:200}})},this);this.subscribe('/desktop/notify',function(config){var win=new Ext.ux.Notification(Ext.apply({animateTarget:taskbarEl,autoDestroy:!0,hideDelay:3000,html:'',iconCls:'x-icon-waiting',title:''},config));win.show()});var windows=new Ext.WindowGroup();var activeWindow;function minimizeWin(win){win.minimized=!0;win.hide()}
function showWin(win){if(win.ishidden){win.ishidden=!1;win.taskButton=taskbar.taskButtonPanel.add(win);if(win.trayButton){win.animateTarget=win.trayButton.el}else{win.animateTarget=win.taskButton.el}
layout()}
markActive(win)}
function markActive(win){if(activeWindow&&activeWindow!=win){markInactive(activeWindow)}
taskbar.setActiveButton(win.taskButton);activeWindow=win;Ext.fly(win.taskButton.el).addClass('active-win');win.minimized=!1}
function markInactive(win){if(win==activeWindow){activeWindow=null;Ext.fly(win.taskButton.el).removeClass('active-win')}}
function removeWin(win){if(win.taskButton){taskbar.taskButtonPanel.remove(win.taskButton);win.taskButton=null}
layout()}
function hideWin(win){if(win.minimized)
return;win.ishidden=!0;taskbar.taskButtonPanel.remove(win.taskButton);win.taskButton=null;layout()}
function layout(){var dbg=Ext.getCmp('x-debug-browser');var extra=dbg?dbg.el.getHeight():0;desktopEl.setHeight(Ext.lib.Dom.getViewHeight()-taskbarEl.getHeight()-extra)}
Ext.EventManager.onWindowResize(layout);this.layout=layout;this.showMsg=function(config)
{if(Ext.isWebKit&&config.width==undefined){config.width=450}
Ext.WindowMgr.zseed=20000;config.manager=this.getManager();return Ext.Msg.show(config)};this.createWindow=function(config,cls){var win=new(cls||Ext.Window)(Ext.applyIf(config||{},{manager:windows,minimizable:!0,constrain:!0,maximizable:!0,renderTo:desktopEl}));win.render(desktopEl);if(!win.ishidden){win.taskButton=taskbar.taskButtonPanel.add(win)}
if(win.notifyButton){var mod=this.addNotificationButton(win.notifyButton);if(mod){win.trayButton=mod.trayButton;if(win.animateToNotifyButton){}}}
win.on({'activate':{fn:markActive},'beforeshow':{fn:showWin},'deactivate':{fn:markInactive},'minimize':{fn:minimizeWin},'close':{fn:removeWin},'destroy':{fn:removeWin},'hide':{fn:hideWin}});layout();return win};this.getManager=function(){return windows};this.getWindow=function(id){return windows.get(id)};this.getViewHeight=function(){var dbg=Ext.getCmp('x-debug-browser');var extra=dbg?dbg.el.getHeight():0;return(Ext.lib.Dom.getViewHeight()-taskbarEl.getHeight()-extra)};this.getViewWidth=function(){return Ext.lib.Dom.getViewWidth()};this.getWinWidth=function(){var width=Ext.lib.Dom.getViewWidth();return width<200?200:width};this.getWinHeight=function(){var dbg=Ext.getCmp('x-debug-browser');var extra=dbg?dbg.el.getHeight():0;var height=(Ext.lib.Dom.getViewHeight()-taskbarEl.getHeight()-extra);return height<100?100:height};this.getWinX=function(width){return(Ext.lib.Dom.getViewWidth()-width)/2};this.getWinY=function(height){var dbg=Ext.getCmp('x-debug-browser');var extra=dbg?dbg.el.getHeight():0;return(Ext.lib.Dom.getViewHeight()-taskbarEl.getHeight()-extra-height)/2};this.setBackgroundColor=function(hex){if(hex){Ext.get(document.body).setStyle('background-color','#'+hex);this.config.styles.backgroundcolor=hex}};this.setFontColor=function(hex){if(hex){Ext.util.CSS.updateRule('.ux-shortcut-btn-text','color','#'+hex);this.config.styles.fontcolor=hex}};this.setTheme=function(o){if(o&&o.id&&o.name&&o.pathtofile){Ext.util.CSS.swapStyleSheet('theme',o.pathtofile);this.config.styles.theme=o}};this.setTransparency=function(b){if(String(b)!=""){if(b)
taskbarEl.addClass("transparent");else taskbarEl.removeClass("transparent");this.config.styles.transparency=b}};this.setWallpaper=function(o,skipNotify){if(o&&o.id&&o.name&&o.pathtofile){var notifyWin;var wp;var task;function verify(){if(wp.complete){task.cancel();if(notifyWin){notifyWin.setIconClass('x-icon-done');notifyWin.setTitle('Terminado');notifyWin.setMessage('Fondo Cargado.');this.hideNotification(notifyWin)}
Ext.get(document.body).setStyle('background-image','url('+wp.src+')')}else task.delay(200)}
if(!skipNotify){notifyWin=this.showNotification({html:'Cargando Fondo...',title:'Espere'});wp=new Image();wp.src=o.pathtofile;task=new Ext.util.DelayedTask(verify,this);task.delay(200)}else{Ext.get(document.body).setStyle('background-image','url('+wp.src+')')}
this.config.styles.wallpaper=o}else{Ext.get(document.body).setStyle('background-image','')}};this.setWallpaperPosition=function(pos){if(pos){if(pos==="center"){var b=Ext.get(document.body);b.removeClass('wallpaper-tile');b.addClass('wallpaper-center')}else if(pos==="tile"){var b=Ext.get(document.body);b.removeClass('wallpaper-center');b.addClass('wallpaper-tile')}
this.config.styles.wallpaperposition=pos}};this.showNotification=function(config){var win=new Ext.ux.Notification(Ext.apply({animateTarget:taskbarEl,autoDestroy:!0,hideDelay:3000,html:'',iconCls:'x-icon-waiting',title:''},config));win.show();return win};this.hideNotification=function(win,delay){if(!win)
return;(function(){win.animHide()}).defer(delay||3000)};this.addAutoRun=function(id){var m=app.getModule(id),c=this.config.launchers.autorun;if(m&&!m.autorun){m.autorun=!0;c.push(id)}};this.removeAutoRun=function(id){var m=app.getModule(id),c=this.config.launchers.autorun;if(m&&m.autorun){var i=0;while(i<c.length){if(c[i]==id)
c.splice(i,1);else i++}
m.autorun=null}};this.addContextMenuItem=function(id){var m=app.getModule(id);if(m&&!m.contextMenuItem){this.cmenu.add(m.launcher)}};this.addShortcut=function(id,channel,icon,text,ev){this.shortcuts.addShortcut({id:id,channel:channel,icon:icon,text:text})};this.removeShortcut=function(id,updateConfig){var m=app.getModule(id);if(m&&m.shortcut){this.shortcuts.removeShortcut(m.shortcut);m.shortcut=null;if(updateConfig){var sc=this.config.launchers.shortcut,i=0;while(i<sc.length){if(sc[i]==id)
sc.splice(i,1);else i++}}}};this.addQuickStartButton=function(id,updateConfig){var m=app.getModule(id);if(m&&!m.quickStartButton){var c=m.launcher;m.quickStartButton=this.taskbar.quickStartPanel.add({handler:c.handler,icon:c.icon,iconCls:c.iconCls,scope:c.scope,text:c.text,tooltip:c.tooltip||c.text});if(updateConfig)
this.config.launchers.quickstart.push(id)}};this.removeQuickStartButton=function(id,updateConfig){var m=app.getModule(id);if(m&&m.quickStartButton){this.taskbar.quickStartPanel.remove(m.quickStartButton);m.quickStartButton=null;if(updateConfig){var qs=this.config.launchers.quickstart,i=0;while(i<qs.length){if(qs[i]==id)
qs.splice(i,1);else i++}}}};this.getElement=function(){return this.el};this.addNotificationButton=function(id,updateConfig){var m=app.getModule(id);if(m&&!m.trayButton){var c=m.launcher;m.trayButton=this.taskbar.trayPanel.add({handler:c.handler,icon:c.icon,iconCls:c.iconCls,scope:c.scope,text:c.text,tooltip:c.tooltip||c.text});if(updateConfig)
this.config.launchers.quickstart.push(id)}
return m};this.removeNotificationButton=function(id,updateConfig){var m=app.getModule(id);if(m&&m.trayButton){this.taskbar.trayPanel.remove(m.trayButton);m.trayButton=null;if(updateConfig){var qs=this.config.launchers.quickstart,i=0;while(i<qs.length){if(qs[i]==id)
qs.splice(i,1);else i++}}}};layout()};Ext.extend(RadDesktop.Desktop,Ext.util.Observable);Ext.ux.NotificationMgr={positions:[]};Ext.ux.Notification=Ext.extend(Ext.Window,{initComponent:function(){Ext.apply(this,{iconCls:this.iconCls||'x-icon-information',width:200,autoHeight:!0,closable:!0,plain:!1,shadow:!1,draggable:!1,bodyStyle:'text-align:left;padding:10px;',resizable:!1});if(this.autoDestroy)
this.task=new Ext.util.DelayedTask(this.animHide,this);else this.closable=!0;Ext.ux.Notification.superclass.initComponent.call(this)},setMessage:function(msg){this.body.update(msg)},setTitle:function(title,iconCls){Ext.ux.Notification.superclass.setTitle.call(this,title,iconCls||this.iconCls)},onRender:function(ct,position){Ext.ux.Notification.superclass.onRender.call(this,ct,position)},onDestroy:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);Ext.ux.Notification.superclass.onDestroy.call(this)},afterShow:function(){Ext.ux.Notification.superclass.afterShow.call(this);this.on('move',function(){Ext.ux.NotificationMgr.positions.remove(this.pos);if(this.autoDestroy){this.task.cancel()}},this);if(this.autoDestroy){this.task.delay(this.hideDelay||5000)}},animShow:function(){this.pos=0;while(Ext.ux.NotificationMgr.positions.indexOf(this.pos)>-1){this.pos++}
Ext.ux.NotificationMgr.positions.push(this.pos);this.setSize(200,100);this.el.alignTo(this.animateTarget||document,"br-tr",[-1,-1-((this.getSize().height+10)*this.pos)]);this.el.slideIn('b',{duration:.7,callback:this.afterShow,scope:this})},animHide:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);this.el.ghost("b",{duration:1,remove:!0})}});Ext.namespace("Ext.ux");Ext.ux.StartMenu=Ext.extend(Ext.menu.Menu,{initComponent:function(config){Ext.ux.StartMenu.superclass.initComponent.call(this,config);var tools=this.toolItems;this.toolItems=new Ext.util.MixedCollection();if(tools){this.addTool.apply(this,tools)}},onRender:function(ct,position){Ext.ux.StartMenu.superclass.onRender.call(this,ct,position);var el=this.el.addClass('ux-start-menu');var header=el.createChild({tag:"div",cls:"x-window-header x-unselectable x-panel-icon "+this.iconCls});this.header=header;var headerText=header.createChild({tag:"span",cls:"x-window-header-text"});var tl=header.wrap({cls:"ux-start-menu-tl"});var tr=header.wrap({cls:"ux-start-menu-tr"});var tc=header.wrap({cls:"ux-start-menu-tc"});this.menuBWrap=el.createChild({tag:"div",cls:"x-window-body x-border-layout-ct ux-start-menu-body"});var ml=this.menuBWrap.wrap({cls:"ux-start-menu-ml"});var mc=this.menuBWrap.wrap({cls:"x-window-mc ux-start-menu-bwrap"});this.menuPanel=this.menuBWrap.createChild({tag:"div",cls:"x-panel x-border-panel ux-start-menu-apps-panel"});this.toolsPanel=this.menuBWrap.createChild({tag:"div",cls:"x-panel x-border-panel ux-start-menu-tools-panel"});var bwrap=ml.wrap({cls:"x-window-bwrap"});var bc=bwrap.createChild({tag:"div",cls:"ux-start-menu-bc"});var bl=bc.wrap({cls:"ux-start-menu-bl x-panel-nofooter"});var br=bc.wrap({cls:"ux-start-menu-br"});this.ul.appendTo(this.menuPanel);var toolsUl=this.toolsPanel.createChild({tag:"ul",cls:"x-menu-list"});this.mon(toolsUl,'click',this.onClick,this);this.mon(toolsUl,'mouseover',this.onMouseOver,this);this.mon(toolsUl,'mouseout',this.onMouseOut,this);this.items.each(function(item){item.parentMenu=this},this);this.toolItems.each(function(item){var li=document.createElement("li");li.className="x-menu-list-item";toolsUl.dom.appendChild(li);item.render(li);item.parentMenu=this},this);this.toolsUl=toolsUl;this.menuBWrap.setStyle('position','relative');this.menuBWrap.setHeight(this.height-25);this.menuPanel.setStyle({padding:'2px',position:'absolute',overflow:'auto'});this.toolsPanel.setStyle({padding:'2px 4px 2px 2px',position:'absolute',overflow:'auto'});this.setTitle(this.title)},findTargetItem:function(e){var t=e.getTarget(".x-menu-list-item",this.ul,!0);if(t&&t.menuItemId){if(this.items&&this.items.get(t.menuItemId)){return this.items.get(t.menuItemId)}else{return this.toolItems.get(t.menuItemId)}}},show:function(el,pos,parentMenu){this.parentMenu=parentMenu;if(!this.el){this.render()}
this.fireEvent("beforeshow",this);this.showAt(this.el.getAlignToXY(el,pos||this.defaultAlign),parentMenu,!1);var tPanelWidth=100;var box=this.menuBWrap.getBox();this.menuPanel.setWidth(box.width-tPanelWidth);this.menuPanel.setHeight(box.height);this.toolsPanel.setWidth(tPanelWidth);this.toolsPanel.setX(box.x+box.width-tPanelWidth);this.toolsPanel.setHeight(box.height)},addTool:function(){var a=arguments,l=a.length,item;for(var i=0;i<l;i++){var el=a[i];if(el.render){item=this.addToolItem(el)}else if(typeof el=="string"){if(el=="separator"||el=="-"){item=this.addToolSeparator()}else{item=this.addText(el)}}else if(el.tagName||el.el){item=this.addElement(el)}else if(typeof el=="object"){item=this.addToolMenuItem(el)}}
return item},addToolSeparator:function(){return this.addToolItem(new Ext.menu.Separator({itemCls:'ux-toolmenu-sep'}))},addToolItem:function(item){this.toolItems.add(item);if(this.ul){var li=document.createElement("li");li.className="x-menu-list-item";this.ul.dom.appendChild(li);item.render(li,this);this.delayAutoWidth()}
return item},addToolMenuItem:function(config){if(!(config instanceof Ext.menu.Item)){if(typeof config.checked=="boolean"){config=new Ext.menu.CheckItem(config)}else{config=new Ext.menu.Item(config)}}
return this.addToolItem(config)},setTitle:function(title,iconCls){this.title=title;this.header.child('span').update(title);return this}});Ext.namespace("Ext.ux");Ext.ux.TaskBar=function(app){this.app=app;this.init()}
Ext.extend(Ext.ux.TaskBar,Ext.util.Observable,{init:function(){this.startMenu=new Ext.ux.StartMenu(Ext.apply({height:300,shadow:!0,width:300},this.app.startConfig));this.startMenu.add(this.app.appsMenu);var startButton=this.startButton=new Ext.Button({text:'Menu',id:'ux-startbutton',iconCls:'start',menu:this.startMenu,menuAlign:'bl-tl',renderTo:'ux-taskbar-start',clickEvent:'mousedown',template:new Ext.Template('<table cellspacing="0" class="x-btn {3}"><tbody><tr>','<td class="ux-startbutton-left"><i>&#160;</i></td><td class="ux-startbutton-center"><button class="x-btn-text {2}" type="{1}" style="height:30px;">{0}</button></td><td class="ux-startbutton-right"><i>&#160;</i></td>','</tr></tbody></table>')});var dropTarget=new Ext.dd.DropTarget(startButton.el,{ddGroup:'file-manager-group',copy:!1,notifyDrop:function(){return!1},notifyEnter:function(){startButton.showMenu()}});var startWidth=Ext.getCmp('ux-startbutton').getWidth()+10;var sbBox=new Ext.BoxComponent({el:'ux-taskbar-start',id:'TaskBarStart',minWidth:startWidth,region:'west',split:!1,width:startWidth});this.quickStartPanel=new Ext.ux.QuickStartPanel({el:'ux-quickstart-panel',id:'TaskBarQuickStart',stateId:'ext-quickstart',minWidth:60,region:'west',split:!0,width:94});this.trayPanel=new Ext.ux.TrayPanel({el:'ux-tray-panel',id:'TaskBarTray',stateId:'ext-task-tray',minWidth:75,region:'east',split:!0,width:100});this.taskButtonPanel=new Ext.ux.TaskButtonsPanel({el:'ux-taskbuttons-panel',id:'TaskBarButtons',region:'center'});var panelWrap=new Ext.Container({el:'ux-taskbar-panel-wrap',items:[this.quickStartPanel,this.taskButtonPanel,this.trayPanel],layout:'border',region:'center'});var container=new Ext.ux.TaskBarContainer({el:'ux-taskbar',layout:'border',items:[sbBox,panelWrap]});this.el=container.el;this.el.on('contextmenu',function(e){e.stopEvent()},this);return this},setActiveButton:function(btn){this.taskButtonPanel.setActiveButton(btn)}});Ext.ux.TaskBarContainer=Ext.extend(Ext.Container,{initComponent:function(){Ext.ux.TaskBarContainer.superclass.initComponent.call(this);this.el=Ext.get(this.el)||Ext.getBody();this.el.setHeight=Ext.emptyFn;this.el.setWidth=Ext.emptyFn;this.el.setSize=Ext.emptyFn;this.el.setStyle({overflow:'hidden',margin:'0',border:'0 none'});this.el.dom.scroll='no';this.allowDomMove=!1;this.autoWidth=!0;this.autoHeight=!0;Ext.EventManager.onWindowResize(this.fireResize,this);this.renderTo=this.el},fireResize:function(w,h){this.fireEvent('resize',this,w,h,w,h)}});Ext.ux.TaskButtonsPanel=Ext.extend(Ext.BoxComponent,{activeButton:null,enableScroll:!0,scrollIncrement:0,scrollRepeatInterval:400,scrollDuration:.35,animScroll:!0,resizeButtons:!0,buttonWidth:168,minButtonWidth:118,buttonMargin:2,buttonWidthSet:!1,initComponent:function(){Ext.ux.TaskButtonsPanel.superclass.initComponent.call(this);this.on('resize',this.delegateUpdates);this.items=[];this.stripWrap=Ext.get(this.el).createChild({cls:'ux-taskbuttons-strip-wrap',cn:{tag:'ul',cls:'ux-taskbuttons-strip'}});this.stripSpacer=Ext.get(this.el).createChild({cls:'ux-taskbuttons-strip-spacer'});this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:'li',cls:'ux-taskbuttons-edge'});this.strip.createChild({cls:'x-clear'})},add:function(win){var li=this.strip.createChild({tag:'li'},this.edge);var btn=new Ext.ux.TaskBar.TaskButton(win,li);this.items.push(btn);if(!this.buttonWidthSet){this.lastButtonWidth=btn.container.getWidth()}
this.setActiveButton(btn);var x;if((win.blinkTaskButton!==undefined)&&(win.blinkTaskButton!==!1)){x=btn.el.sequenceFx();var len=(win.blinkTaskButton===!0)?1:win.blinkTaskButton||0;for(var i=0;i<len;i++){x.fadeOut({endOpacity:.5,duration:.1,easing:'easeOut'});x.fadeIn({endOpacity:1,duration:.5})}}
if((win.frameTaskButton!==undefined)&&(win.blinkTaskButton!==!1)){if(!x)
x=btn.el.sequenceFx();var len=(win.frameTaskButton===!0)?1:win.frameTaskButton||0;for(var i=0;i<len;i++)
x.frame();}
return btn},remove:function(btn){var li=document.getElementById(btn.container.id);btn.destroy();li.parentNode.removeChild(li);var s=[];for(var i=0,len=this.items.length;i<len;i++){if(this.items[i]!=btn){s.push(this.items[i])}}
this.items=s;this.delegateUpdates()},setActiveButton:function(btn){this.activeButton=btn;this.delegateUpdates()},delegateUpdates:function(){if(this.resizeButtons&&this.rendered){this.autoSize()}
if(this.enableScroll&&this.rendered){this.autoScroll()}},autoSize:function(){var count=this.items.length;var ow=this.el.dom.offsetWidth;var aw=this.el.dom.clientWidth;if(!this.resizeButtons||count<1||!aw){return}
var each=Math.max(Math.min(Math.floor((aw-4)/count)-this.buttonMargin,this.buttonWidth),this.minButtonWidth);var btns=this.stripWrap.dom.getElementsByTagName('button');this.lastButtonWidth=Ext.get(btns[0].id).findParent('li').offsetWidth;for(var i=0,len=btns.length;i<len;i++){var btn=btns[i];var tw=Ext.get(btns[i].id).findParent('li').offsetWidth;var iw=btn.offsetWidth;btn.style.width=(each-(tw-iw))+'px'}},autoScroll:function(){var count=this.items.length;var ow=this.el.dom.offsetWidth;var tw=this.el.dom.clientWidth;var wrap=this.stripWrap;var cw=wrap.dom.offsetWidth;var pos=this.getScrollPos();var l=this.edge.getOffsetsTo(this.stripWrap)[0]+pos;if(!this.enableScroll||count<1||cw<20){return}
wrap.setWidth(tw);if(l<=tw){wrap.dom.scrollLeft=0;if(this.scrolling){this.scrolling=!1;this.el.removeClass('x-taskbuttons-scrolling');this.scrollLeft.hide();this.scrollRight.hide()}}else{if(!this.scrolling){this.el.addClass('x-taskbuttons-scrolling')}
tw-=wrap.getMargins('lr');wrap.setWidth(tw>20?tw:20);if(!this.scrolling){if(!this.scrollLeft){this.createScrollers()}else{this.scrollLeft.show();this.scrollRight.show()}}
this.scrolling=!0;if(pos>(l-tw)){wrap.dom.scrollLeft=l-tw}else{this.scrollToButton(this.activeButton,!0)}
this.updateScrollButtons()}},createScrollers:function(){var h=this.el.dom.offsetHeight;var sl=this.el.insertFirst({cls:'ux-taskbuttons-scroller-left'});sl.setHeight(h);sl.addClassOnOver('ux-taskbuttons-scroller-left-over');this.leftRepeater=new Ext.util.ClickRepeater(sl,{interval:this.scrollRepeatInterval,handler:this.onScrollLeft,scope:this});this.scrollLeft=sl;var sr=this.el.insertFirst({cls:'ux-taskbuttons-scroller-right'});sr.setHeight(h);sr.addClassOnOver('ux-taskbuttons-scroller-right-over');this.rightRepeater=new Ext.util.ClickRepeater(sr,{interval:this.scrollRepeatInterval,handler:this.onScrollRight,scope:this});this.scrollRight=sr},getScrollWidth:function(){return this.edge.getOffsetsTo(this.stripWrap)[0]+this.getScrollPos()},getScrollPos:function(){return parseInt(this.stripWrap.dom.scrollLeft,10)||0},getScrollArea:function(){return parseInt(this.stripWrap.dom.clientWidth,10)||0},getScrollAnim:function(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this}},getScrollIncrement:function(){return(this.scrollIncrement||this.lastButtonWidth+2)},scrollToButton:function(item,animate){item=item.el.dom.parentNode;if(!item){return}
var el=item;var pos=this.getScrollPos(),area=this.getScrollArea();var left=Ext.fly(el).getOffsetsTo(this.stripWrap)[0]+pos;var right=left+el.offsetWidth;if(left<pos){this.scrollTo(left,animate)}else if(right>(pos+area)){this.scrollTo(right-area,animate)}},scrollTo:function(pos,animate){this.stripWrap.scrollTo('left',pos,animate?this.getScrollAnim():!1);if(!animate){this.updateScrollButtons()}},onScrollRight:function(){var sw=this.getScrollWidth()-this.getScrollArea();var pos=this.getScrollPos();var s=Math.min(sw,pos+this.getScrollIncrement());if(s!=pos){this.scrollTo(s,this.animScroll)}},onScrollLeft:function(){var pos=this.getScrollPos();var s=Math.max(0,pos-this.getScrollIncrement());if(s!=pos){this.scrollTo(s,this.animScroll)}},updateScrollButtons:function(){var pos=this.getScrollPos();this.scrollLeft[pos==0?'addClass':'removeClass']('ux-taskbuttons-scroller-left-disabled');this.scrollRight[pos>=(this.getScrollWidth()-this.getScrollArea())?'addClass':'removeClass']('ux-taskbuttons-scroller-right-disabled')}});Ext.ux.TaskBar.TaskButton=function(win,el){this.win=win;Ext.ux.TaskBar.TaskButton.superclass.constructor.call(this,{iconCls:win.iconCls,text:Ext.util.Format.ellipsis(win.title,20),tooltip:win.taskbuttonTooltip||win.title,renderTo:el,handler:function(){if(win.minimized||win.hidden){win.show()}else if(win==win.manager.getActive()){if(win.minimizable===!1){if(win.closeAction=='hide')
win.hide();else{win.show();win.el.frame()}}else win.minimize()}else{win.toFront()}},clickEvent:'mousedown',template:new Ext.Template('<table cellspacing="0" class="x-btn {3}"><tbody><tr>','<td class="ux-taskbutton-left"><i>&#160;</i></td>','<td class="ux-taskbutton-center"><em class="{5} unselectable="on">','<button class="x-btn-text {2}" type="{1}" style="height:28px;">{0}</button>','</em></td>','<td class="ux-taskbutton-right"><i>&#160;</i></td>',"</tr></tbody></table>")})};Ext.extend(Ext.ux.TaskBar.TaskButton,Ext.Button,{onRender:function(){Ext.ux.TaskBar.TaskButton.superclass.onRender.apply(this,arguments);this.cmenu=new Ext.menu.Menu({items:[{id:'restore',text:'Restaurar',handler:function(){if(!this.win.isVisible()){this.win.show()}else{this.win.restore()}},scope:this},{id:'minimize',text:'Minimizar',handler:this.win.minimize,scope:this.win},{id:'maximize',text:'Maximizar',handler:this.win.maximize,scope:this.win},'-',{id:'close',text:'Cerrar',handler:this.closeWin.createDelegate(this,this.win,!0),scope:this.win}]});this.cmenu.on('beforeshow',function(){var items=this.cmenu.items.items;var w=this.win;items[0].setDisabled(w.maximized!==!0&&w.hidden!==!0);items[1].setDisabled(w.minimized===!0);items[1].setDisabled(w.minimizable===!1);items[2].setDisabled(w.maximized===!0||w.hidden===!0);items[2].setDisabled(w.maximizable===!1);items[3].setDisabled(w.closable===!1)},this);this.el.on('contextmenu',function(e){e.stopEvent();if(!this.cmenu.el){this.cmenu.render()}
var xy=e.getXY();xy[1]-=this.cmenu.el.getHeight();this.cmenu.showAt(xy)},this)},closeWin:function(cMenu,e,win){if(!win.isVisible()){win.show()}else{win.restore()}
win.close()},setTooltip:function(text){if(text){this.tooltip=text;var btnEl=this.el.child(this.buttonSelector);Ext.QuickTips.unregister(btnEl.id);if(typeof this.tooltip=='object'){Ext.QuickTips.register(Ext.apply({target:btnEl.id},this.tooltip))}else{btnEl.dom[this.tooltipType]=this.tooltip}}}});Ext.ux.QuickStartPanel=Ext.extend(Ext.BoxComponent,{enableMenu:!0,initComponent:function(){Ext.ux.QuickStartPanel.superclass.initComponent.call(this);this.on('resize',this.delegateUpdates);this.menu=new Ext.menu.Menu();this.items=[];this.stripWrap=Ext.get(this.el).createChild({cls:'ux-quickstart-strip-wrap',cn:{tag:'ul',cls:'ux-quickstart-strip'}});this.stripSpacer=Ext.get(this.el).createChild({cls:'ux-quickstart-strip-spacer'});this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:'li',cls:'ux-quickstart-edge'});this.strip.createChild({cls:'x-clear'})},add:function(config){var li=this.strip.createChild({tag:'li'},this.edge);var btn=new Ext.Button(Ext.apply(config,{cls:'x-btn-icon',menuText:config.text,renderTo:li,text:''}));this.items.push(btn);this.delegateUpdates();return btn},remove:function(btn){var li=document.getElementById(btn.container.id);btn.destroy();li.parentNode.removeChild(li);var s=[];for(var i=0,len=this.items.length;i<len;i++){if(this.items[i]!=btn){s.push(this.items[i])}}
this.items=s;this.delegateUpdates()},menuAdd:function(config){this.menu.add(config)},delegateUpdates:function(){if(this.enableMenu&&this.rendered){this.showButtons();this.clearMenu();this.autoMenu()}},showButtons:function(){var count=this.items.length;for(var i=0;i<count;i++){this.items[i].show()}},clearMenu:function(){this.menu.removeAll()},autoMenu:function(){var count=this.items.length;var ow=this.el.dom.offsetWidth;var tw=this.el.dom.clientWidth;var wrap=this.stripWrap;var cw=wrap.dom.offsetWidth;var l=this.edge.getOffsetsTo(this.stripWrap)[0];if(!this.enableMenu||count<1||cw<20){return}
wrap.setWidth(tw);if(l<=tw){if(this.showingMenu){this.showingMenu=!1;this.menuButton.hide()}}else{tw-=wrap.getMargins('lr');wrap.setWidth(tw>20?tw:20);if(!this.showingMenu){if(!this.menuButton){this.createMenuButton()}else{this.menuButton.show()}}
mo=this.getMenuButtonPos();for(var i=count-1;i>=0;i--){var bo=this.items[i].el.dom.offsetLeft+this.items[i].el.dom.offsetWidth;if(bo>mo){this.items[i].hide();var ic=this.items[i].initialConfig,config={iconCls:ic.iconCls,handler:ic.handler,scope:ic.scope,text:ic.menuText};this.menuAdd(config)}else{this.items[i].show()}}
this.showingMenu=!0}},createMenuButton:function(){var h=this.el.dom.offsetHeight;var mb=this.el.insertFirst({cls:'ux-quickstart-menubutton-wrap'});mb.setHeight(h);var btn=new Ext.Button({cls:'x-btn-icon',id:'ux-quickstart-menubutton',menu:this.menu,renderTo:mb});mb.setWidth(Ext.get('ux-quickstart-menubutton').getWidth());this.menuButton=mb},getMenuButtonPos:function(){return this.menuButton.dom.offsetLeft}});Ext.ux.TrayPanel=Ext.extend(Ext.BoxComponent,{enableMenu:!0,initComponent:function(){Ext.ux.QuickStartPanel.superclass.initComponent.call(this);this.on('resize',this.delegateUpdates);this.menu=new Ext.menu.Menu();this.items=[];this.stripWrap=Ext.get(this.el).createChild({cls:'ux-tray-strip-wrap',cn:{tag:'ul',cls:'ux-tray-strip'}});this.stripSpacer=Ext.get(this.el).createChild({cls:'ux-tray-strip-spacer'});this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:'li',cls:'ux-tray-edge'});this.strip.createChild({cls:'x-clear'})},add:function(config){if(config.id){var o={tag:'li',id:config.id}}else{var o={tag:'li'}}
var li=this.strip.createChild(o,this.edge);var btn=new Ext.Button(Ext.apply(config,{cls:'x-btn-icon',menuText:config.text,renderTo:li,text:'',template:new Ext.Template('<table cellspacing="0" class="x-btn {3} tray-icon"><tbody><tr>','<td class="ux-taskbutton-left"><i>&#160;</i></td>','<td class="ux-taskbutton-center"><em class="{5} unselectable="on">','<button class="x-btn-text {2}" type="{1}" style="height:28px;">{0}</button>','</em></td>','<td class="ux-taskbutton-right"><i>&#160;</i></td>',"</tr></tbody></table>")}));this.items.push(btn);this.delegateUpdates();return btn},remove:function(btn){var li=document.getElementById(btn.container.id);btn.destroy();li.parentNode.removeChild(li);var s=[];for(var i=0,len=this.items.length;i<len;i++){if(this.items[i]!=btn){s.push(this.items[i])}}
this.items=s;this.delegateUpdates()},getButton:function(id){for(var i=0,len=this.items.length;i<len;i++)
if(this.items[i]==id)
return this.items[i];return null},menuAdd:function(config){this.menu.add(config)},delegateUpdates:function(){if(this.enableMenu&&this.rendered){this.showButtons();this.clearMenu();this.autoMenu()}},showButtons:function(){var count=this.items.length;for(var i=0;i<count;i++){this.items[i].show()}},clearMenu:function(){this.menu.removeAll()},autoMenu:function(){var count=this.items.length;var ow=this.el.dom.offsetWidth;var tw=this.el.dom.clientWidth;var wrap=this.stripWrap;var cw=wrap.dom.offsetWidth;var l=this.edge.getOffsetsTo(this.stripWrap)[0];if(!this.enableMenu||count<1||cw<20){return}
wrap.setWidth(tw);if(l<=tw){if(this.showingMenu){this.showingMenu=!1;this.menuButton.hide()}}else{tw-=wrap.getMargins('lr');wrap.setWidth(tw>20?tw:20);if(!this.showingMenu){if(!this.menuButton){this.createMenuButton()}else{this.menuButton.show()}}
mo=this.getMenuButtonPos();for(var i=count-1;i>=0;i--){var bo=this.items[i].el.dom.offsetLeft+this.items[i].el.dom.offsetWidth;if(bo>mo){this.items[i].hide();var ic=this.items[i].initialConfig,config={iconCls:ic.iconCls,handler:ic.handler,scope:ic.scope,text:ic.menuText};this.menuAdd(config)}else{this.items[i].show()}}
this.showingMenu=!0}},createMenuButton:function(){var h=this.el.dom.offsetHeight;var mb=this.el.insertFirst({cls:'ux-tray-button-wrap'});mb.setHeight(h);var btn=new Ext.Button({cls:'x-btn-icon',id:'ux-tray-button',menu:this.menu,renderTo:mb});mb.setWidth(Ext.get('ux-tray-button').getWidth());this.menuButton=mb},getMenuButtonPos:function(){return this.menuButton.dom.offsetLeft}});Ext.namespace("Ext.ux");Ext.ux.FileDragZone=function(view,config){this.view=view;this.scroll=!1;Ext.ux.FileDragZone.superclass.constructor.call(this,view.getEl(),config)};Ext.extend(Ext.ux.FileDragZone,Ext.dd.DragZone,{getDragData:function(e){var target=e.getTarget(this.targetCls||'.thumb-wrap');if(target){var view=this.view;if(!view.isSelected(target)){view.onClick(e)}
var records=view.getSelectedRecords();var dragData={selections:records,nodes:view.getSelectedNodes()};if(records.length==1){dragData.ddel=target;dragData.single=!0}else{var div=document.createElement('div');div.className='multi-proxy';var count=document.createElement('div');count.innerHTML=records.length+' selected';div.appendChild(count);dragData.ddel=div;dragData.multi=!0}
return dragData}
return!1},afterRepair:function(){if(this.dragData.nodes){for(var i=0,len=this.dragData.nodes.length;i<len;i++){Ext.fly(this.dragData.nodes[i]).frame('#8db2e3',1)}}
this.dragging=!1},getRepairXY:function(e){if(!this.dragData.multi){var xy=Ext.Element.fly(this.dragData.ddel).getXY();xy[0]+=3;xy[1]+=3;return xy}
return!1}});Ext.ux.Shortcuts=function(config){var desktopEl=Ext.get(config.renderTo),taskbarEl=config.taskbarEl;var shortcutRecord=Ext.data.Record.create(['id','channel','text','icon']);var store=new Ext.data.JsonStore({url:'/default/Desktop/getdesktopicons',idProperty:'Id',root:'files',fields:shortcutRecord,listeners:{'load':function(){this.publish('/desktop/shortcuts/loaded',{})}}});store.load();var dbg=Ext.getCmp('x-debug-browser');var extra=dbg?dbg.el.getHeight():0;var iconHeight=96;var sizes={desktopHeight:(Ext.lib.Dom.getViewHeight()-taskbarEl.getHeight()-extra)};function isOverflow(y){if(y>sizes.desktopHeight){return!0}
return!1}
var tpl=new Ext.XTemplate('<tpl for=".">','<tpl if="(xindex &gt; 1) && !((xindex - 1) % this.cols(xindex))">','<div style="clear:left"></div>','</tpl>','<div class="thumb thumb-wrap ux-shortcut-item-btn {cls}-shortcut" id="shortcut-{id}" style="float: right;">','<div class="thumb ux-shortcut-btn"><img src="images/modulos/{icon}64.png" title="{text}"/></div>','<span class="x-editable ux-shortcut-btn-text x-unselectable" style="color: white;">{shortName}</span></div>','</tpl>','<div class="x-clear"></div>',{cols:function(idx){var j=0;for(var i=0,len=store.getCount();i<len;i++){if((j*iconHeight)>=sizes.desktopHeight){j--;break}
j++}
return Math.ceil(store.getCount()/j)}});var view=new Ext.DataView({id:config.viewId,store:store,tpl:tpl,width:'100%',height:'100%',multiSelect:!0,overClass:'x-view-over',itemSelector:'div.thumb-wrap',emptyText:'',plugins:[],prepareData:function(data){data.shortName=Ext.util.Format.ellipsis(data.text,50);return data},listeners:{selectionchange:{fn:function(dv,nodes){var l=nodes.length;try{window.status=l+' item'+(l!=1?'s':'')+' selected'}catch(e){}}},dblclick:{fn:function(dv){var records=dv.getSelectedRecords();var record=records[0];if(!record||!record.data.channel)
return!1;if(!record.data.ev)ev={action:'launch'};else ev=record.data.ev;app.publish(record.data.channel,ev)}}}});this.desktopPanel=new Ext.Panel({renderTo:config.renderTo,id:'desktop-view',frame:!1,border:!1,width:'100%',height:sizes.desktopHeight,layout:'fit',items:view});this.reload=function(){store.reload()};this.addShortcut=function(config){var record=new shortcutRecord({id:config.id,text:config.text,icon:config.icon,channel:config.channel,ev:config.ev});store.add([record]);view.refresh();return record};this.removeShortcut=function(shortcut){var record=store.getById(shortcut.id);if(record){var node=view.getNode(store.find('id',shortcut.data.id));if(node)
Ext.fly(node).ghost('l',{duration:.5,callback:function(){store.remove(record);view.refresh()}});else{store.remove(record);view.refresh()}}};this.handleUpdate=function(){var dbg=Ext.getCmp('x-debug-browser');var extra=dbg?dbg.el.getHeight():0;sizes.desktopHeight=Ext.lib.Dom.getViewHeight()-taskbarEl.getHeight()-extra;this.desktopPanel.setHeight(sizes.desktopHeight);view.refresh()};Ext.EventManager.onWindowResize(this.handleUpdate,this,{delay:500});var dragZone=new Ext.ux.FileDragZone(view,{containerScroll:!1,ddGroup:'file-manager-group',startDrag:function(x,y){Ext.get("ux-papelera-img").fadeIn()},endDrag:function(x,y){Ext.get("ux-papelera-img").puff()}});var dropTarget=new Ext.dd.DropTarget('ux-papelera',{ddGroup:'file-manager-group',copy:!1,notifyDrop:function(ddSource,e,odata){var id=odata.selections[0].data.id
Models.Model_UsuariosEscritorioMapper.removeShortcut(id,function(result,e){if(e.status){app.desktop.shortcuts.reload()}},this);return!0}})};Ext.ns('Ext.ux.Format');Ext.ux.Format=function(){return{menorrojo:function(val,menor){if(menor==undefined)menor=50;if(val>=menor){return '<span style=\"color:green;\">$'+val+'</span>'}else if(val<menor){return '<span style=\"color:red;\">$'+val+'</span>'}
return val},moneda4decimales:function(v,params,record){v=(Math.round((v-0)*10000))/10000;v=(v==Math.floor(v))?v+".0000":((v*10==Math.floor(v*10))?v+"0":v);v=String(v);var ps=v.split('.');var whole=ps[0];var sub=ps[1]?'.'+ps[1]:'.0000';var r=/(\d+)(\d{3})/;while(r.test(whole)){whole=whole.replace(r,'$1'+','+'$2')}
v=whole+sub;if(v.charAt(0)=='-'){return '-$ '+v.substr(1)}
return "$ "+v},porcentaje:function(v,params,record){v=(Math.round((v-0)*100))/100;v=(v==Math.floor(v))?v+".00":((v*10==Math.floor(v*10))?v+"0":v);v=String(v);var ps=v.split('.');var whole=ps[0];var sub=ps[1]?'.'+ps[1]:'.00';var r=/(\d+)(\d{3})/;while(r.test(whole)){whole=whole.replace(r,'$1'+','+'$2');Ext.ns()}
v=whole+sub;if(v.charAt(0)=='-'){return '-% '+v.substr(1)}
return "% "+v},redondeo4decimales:function(v,params,record){return parseFloat(v).toFixed(4)},redondeo2decimales:function(v,params,record){return parseFloat(v).toFixed(2)},saldo2decimales:function(v,params,record){return parseFloat(v).toFixed(2);if(record.data.Saldo<0){return '<font color=red>'+parseFloat(record.data.Saldo).toFixed(2)+'</font>'}else{return parseFloat(record.data.Saldo).toFixed(2)}},estados:function(v,params,record){var estados={'Nada':'red','Parcialmente':'blue','Totalmente':'green','Contado':'lightseagreen','Anulado':'maroon','Excedido':'black'}
var color=(estados[v])?estados[v]:'black';return "<font color='"+color+"'>"+record.data.EstadoPagado+"</font>"},mmiTrazabilidad:function(v,params,record){var a='<div onclick=\"app.publish(app.channels.apps + \'/Almacenes/Trazabilidad\', {action:\'launch\', id: '+record.data.Id+'})\" style=\"background-image:url(images/arrow_divide.png)\" qtip=\"Trazabilidad\" class=\"ux-cell-action \"> </div>';return a+v},pagadoCon:function(app){var rend=function(v,params,record){var v;var a='<div onclick="app.publish(app.channels.apps+\''+app+'\', {action:\'custom\', value: '+record.data.Id+'})" style="background-image:url(images/money.png)" qtip="Ver Pagos" class="ux-cell-action"> </div>';if(record.data.EstadoPagado=='Nada'){v='<font color=red>'+record.data.EstadoPagado+'</font>'}
if(record.data.EstadoPagado=='Parcialmente'){v=a+'<font color=blue>'+record.data.EstadoPagado+'</font>'}
if(record.data.EstadoPagado=='Totalmente'){v=a+'<font color=green>'+record.data.EstadoPagado+'</font>'}
if(record.data.EstadoPagado=='Contado'){v=a+'<font color=LightSeaGreen>'+record.data.EstadoPagado+'</font>'}
if(record.data.EstadoPagado=='Anulado'){v='<font color=Maroon>'+record.data.EstadoPagado+'</font>'}
if(record.data.EstadoPagado=='Excedido'){v=a+'<font color=black>'+record.data.EstadoPagado+'</font>'}
return v};return rend},recibidoConRemito:function(app){var renderer=function(v,params,record){var a='<div onclick="app.publish(app.channels.apps+\''+app+'\', {action:\'recibido\', value: '+record.data.Id+'})" style="background-image:url(images/lorry_go.png)" qtip="Ver Remitos" class="ux-cell-action"> </div>';if(record.data.EstadoRecibido=='Nada'){v='<font color=red>'+record.data.EstadoRecibido+'</font>'}
if(record.data.EstadoRecibido=='Parcialmente'){v=a+'<font color=blue>'+record.data.EstadoRecibido+'</font>'}
if(record.data.EstadoRecibido=='Totalmente'){v=a+'<font color=green>'+record.data.EstadoRecibido+'</font>'}
if(record.data.EstadoRecibido=='Excedido'){v=a+'<font color=black>'+record.data.EstadoRecibido+'</font>'}
return v}
return renderer},zeroFill:function(ceros,campo){var renderer=function(v,params,record){if(!record.data[campo])
return record.data[campo];var num=record.data[campo];if(num.toString().length>=ceros)
return num;var mask=Array(ceros+1).join('0');return(mask+num.toString()).slice(-(ceros))};return renderer},miniatura:function(campo,modulo,modelo,size,desacarga,vacio){var rend=function(v,params,record){if(v!=''){var lnk='';if(desacarga){lnk='<a href="/default/datagateway/downloadfile/model/'+modelo+'/m/'+modulo+'/field/'+campo+'/id/'+v.replace('.','/ext/')+'"/>'+desacarga+'</a>'}
return '<img src="/default/datagateway/getthumbnailfile/model/'+modelo+'/m/'+modulo+'/size/'+size+'/field/'+campo+'/id/'+v.replace('.','/ext/')+'"/>'+lnk}else{if(vacio!=undefined)return vacio;return 'Vacio'}};return rend},comprobanteRegistroPrecios:function(v,params,record){if(!record.data.Comprobante)return '-';var app;if(record.data.TipoDeRegistroDePrecio=='1'){app='/Facturacion/facturasCompras'}else{app='/Facturacion/facturasVentas'}
var a='<div onclick="app.publish(app.channels.apps+\''+app+'\', {action:\'find\', value: '+record.data.Comprobante+'})" style="background-image:url(images/page_go.png)" qtip="Ver Factura" class="ux-cell-action"> </div>';var v=a+'<font color=blue>'+record.data.ComprobantePunto+' - '+record.data.Comprobante_cdisplay+'</font>'
return v},tipoDeLiquidaciones:function(v,params,r){switch(r.data.TipoDeLiquidacion){case '1':return '<span style="color:black">'+r.data.TipoDeLiquidacion_cdisplay+'</span>';case '2':return '<span style="color:#2554C7">'+r.data.TipoDeLiquidacion_cdisplay+'</span>';case '3':return '<span style="color:#9DC209">'+r.data.TipoDeLiquidacion_cdisplay+'</span>';case '4':return '<span style="color:#F87217">'+r.data.TipoDeLiquidacion_cdisplay+'</span>'}}}}();Ext.ns('Ext.ux.form');Ext.ux.form.ComboBox=function(cfg){if(!cfg)cfg={};if(!cfg.store&&cfg.url){cfg.store=new Ext.data.Store({baseParams:cfg.baseParams||{},url:cfg.url,reader:new Ext.data.JsonReader({},[cfg.valueField,cfg.displayField||cfg.valueField])})}else{if(!cfg.store||Ext.type(cfg.store)=='array'||cfg.store instanceof Ext.data.SimpleStore){cfg.mode="local"}
else{cfg.mode="remote"}}
if(cfg.transform){this.clearValueOnRender=!Ext.fly(cfg.transform).first("[selected=true]")}
if(cfg.valueField){var extraCfg={hiddenName:cfg.name,hiddenId:cfg.name+"Id"}}else{var extraCfg={}}
Ext.ux.form.ComboBox.superclass.constructor.call(this,Ext.apply(extraCfg,{minListWidth:cfg.width},cfg))};Ext.extend(Ext.ux.form.ComboBox,Ext.form.ComboBox,{editable:!1,triggerAction:'all',autoLoad:!0,forceSelection:!0,clearValueOnRender:!1,displayFieldTpl:null,descriptionPanel:null,filterFrom:null,mustFilter:!0,filterQuery:null,initComponent:function(){if(this.clearValueOnRender){this.on({'render':function(){this.clearValue()},'destroy':function(){Ext.destroy(this.tooltip)}},this)}
if(((!this.width||this.width=='auto')&&!this.minListWidth)){this.on("render",function(){this.minListWidth=this.wrap.getWidth()},this)}
Ext.ux.form.ComboBox.superclass.initComponent.apply(this,arguments);if(this.mode=="remote"){this.store.on('load',this.assureValueEntry,this);if(this.autoLoad){this.on("render",function(){if(this.store.getCount()==0){if(this.triggerAction=='all'){this.doQuery(this.allQuery,!0)}else{this.doQuery(this.getRawValue())}}},this)}}else{this.assureValueEntry(this.store)}
if(this.filterFrom&&this.mustFilter){this.form=this.findParentByType('radform');if(this.form){this.form.on('afterrender',this.attachClearEvent,this)}}},attachClearEvent:function(i,component,index){for(filter in this.filterFrom){field=this.form.getForm().findField(filter);if(field){field.on('select',function(){if(this.mustFilter)
this.clearValue()},this);}}},doCustomLoad:function()
{if(this.tooltip){Ext.destroy(this.tooltip)}
this.customLoad=!0;if(this.store.getCount()==0||this.getValue()==this.getRawValue()){if(this.triggerAction=='all'){this.doQuery(this.allQuery,!0)}else{this.doQuery(this.getRawValue())}}
this.customLoad=!1},assureValueEntry:function(){if(this.forceSelection&&this.getValue()==this.getRawValue())this.setValue(this.value)},setValue:function(v){var text=v;if(this.valueField){var r=this.findRecord(this.valueField,v);if(r){if(this.displayFieldTpl){tpl=new Ext.XTemplate(this.displayFieldTpl);text=tpl.apply(r.data);Ext.destroy(tpl)}else{text=r.data[this.displayField]}
if(this.descriptionPanel){var tpl=new Ext.Template(this.descriptionPanel.tpl);this.tooltip=new Ext.ToolTip({target:this.id,anchor:'left',width:300,autoHide:!0,html:tpl.apply(r.data)})}}else if(this.valueNotFoundText!==undefined){text=this.valueNotFoundText}else if(this.lastSelectionText!==undefined&&v==this.value){text=this.lastSelectionText}}
this.lastSelectionText=text;if(this.hiddenField){this.hiddenField.value=v}
Ext.form.ComboBox.superclass.setValue.call(this,text);this.value=v},load:function(options){this.store.load(options);var q=(this.triggerAction=='all')?this.allQuery:this.getRawValue();if(q===undefined||q===null)q='';this.lastQuery=q},doQuery:function(q,forceAll){this.store.baseParams.search=this.searchField;if(this.filterFrom&&this.mustFilter&&!this.form){var roweditor=this.ownerCt;if(roweditor)this.roweditor=roweditor;if(!this.roweditor)alert('El combo '+this.name+' no encontro el formulario o grilla para filtrar')}
if(this.forceReload)this.lastQuery='%$%';if(this.filterFrom&&this.mustFilter&&(this.form||this.roweditor)&&!this.customLoad){this.lastQuery='%$%';var filterValue;if(this.form){var values=this.form.getForm().getValues();for(filter in this.filterFrom){if(values[filter]!=undefined){filterValue=values[filter]}else{filterValue=this.form.record.data[filter]}
if(filterValue)this.store.baseParams[this.filterFrom[filter]]=filterValue;else{app.publish('/desktop/showError','Debe seleccionar primero '+filter);return!1}}}else{for(filter in this.filterFrom){filterValue=this.roweditor.record.data[filter];if(filterValue)this.store.baseParams[this.filterFrom[filter]]=filterValue}}}
if(this.pageSize!=0){this.store.baseParams.Id=this.getValue()}
Ext.ux.form.ComboBox.superclass.doQuery.call(this,q,forceAll)}});Ext.reg('xcombo',Ext.ux.form.ComboBox);Ext.ux.Mask=function(mask){var config={mask:mask};Ext.apply(this,config)};Ext.extend(Ext.ux.Mask,Object,{init:function(c){this.LetrasL='abcdefghijklmnopqrstuvwxyz';this.LetrasU=Ext.util.Format.uppercase(this.LetrasL);this.Letras=this.LetrasL+this.LetrasU;this.Numeros='0123456789';this.Fixos='().-:/ ';this.Charset=" !\"#$%&\'()*+,-./0123456789:;<=>?@"+this.LetrasU+"[\]^_/`"+this.LetrasL+"{|}~";c.enableKeyEvents=!0;c.on('keypress',function(field,evt){return this.press(field,evt)},this)},press:function(field,evt){var value=field.getValue();var key=evt.getKey();var mask=this.mask;if(evt){var tecla=this.Charset.substr(key-32,1);if(key<32||evt.isNavKeyPress()||key==evt.BACKSPACE){return!0}
if(Ext.isGecko||Ext.isGecko2||Ext.isGecko3)
if((evt.charCode==0&&evt.keyCode==46)||evt.isSpecialKey())return!0;var tamanho=value.length;if(tamanho>=mask.length){field.setValue(value);evt.stopEvent();return!1}
var pos=mask.substr(tamanho,1);while(this.Fixos.indexOf(pos)!=-1){value+=pos;tamanho=value.length;if(tamanho>=mask.length){evt.stopEvent();return!1}
pos=mask.substr(tamanho,1)}
switch(pos){case '#':if(this.Numeros.indexOf(tecla)==-1){evt.stopEvent();return!1}break;case 'A':if(this.LetrasU.indexOf(tecla)==-1){evt.stopEvent();return!1}break;case 'a':if(this.LetrasL.indexOf(tecla)==-1){evt.stopEvent();return!1}break;case 'Z':if(this.Letras.indexOf(tecla)==-1){evt.stopEvent();return!1}break;case '*':field.setValue(value+tecla);break;default:field.setValue(value);break}}
field.setValue(value+tecla);evt.stopEvent();return!1}});Ext.ns('Ext.ux.form');Ext.ux.form.XDateField=Ext.extend(Ext.form.DateField,{submitFormat:'Y-m-d',onRender:function(){Ext.ux.form.XDateField.superclass.onRender.apply(this,arguments);var name=this.name||this.el.dom.name;this.hiddenField=this.el.insertSibling({tag:'input',type:'hidden',name:name,value:this.formatHiddenDate(this.parseDate(this.value))});this.hiddenName=name;this.el.dom.removeAttribute('name');this.el.on({keyup:{scope:this,fn:this.updateHidden},blur:{scope:this,fn:this.updateHidden},dblclick:{scope:this,fn:this.onDblClick}},Ext.isIE?'after':'before');this.setValue=this.setValue.createSequence(this.updateHidden)},onDisable:function(){Ext.ux.form.XDateField.superclass.onDisable.apply(this,arguments);if(this.hiddenField){this.hiddenField.dom.setAttribute('disabled','disabled')}},onEnable:function(){Ext.ux.form.XDateField.superclass.onEnable.apply(this,arguments);if(this.hiddenField){this.hiddenField.dom.removeAttribute('disabled')}},formatHiddenDate:function(date){if(!Ext.isDate(date)){return date}
if('timestamp'===this.submitFormat){return date.getTime()/1000}
else{return Ext.util.Format.date(date,this.submitFormat)}},updateHidden:function(){this.hiddenField.dom.value=this.formatHiddenDate(this.getValue())},onDblClick:function(){this.setValue(new Date())}});Ext.reg('xdatefield',Ext.ux.form.XDateField);Ext.ns('Ext.ux.form');Ext.ux.form.XCheckbox=Ext.extend(Ext.form.Checkbox,{submitOffValue:0,submitOnValue:1,onRender:function(){this.inputValue=this.submitOnValue;Ext.ux.form.XCheckbox.superclass.onRender.apply(this,arguments);this.hiddenField=this.wrap.insertFirst({tag:'input',type:'hidden'});if(this.tooltip){this.imageEl.set({qtip:this.tooltip})}
this.updateHidden()},setValue:function(v){v=this.convertValue(v);this.updateHidden(v);Ext.ux.form.XCheckbox.superclass.setValue.apply(this,arguments)},updateHidden:function(v){v=undefined!==v?v:this.checked;v=this.convertValue(v);if(this.hiddenField){this.hiddenField.dom.value=v?this.submitOnValue:this.submitOffValue;this.hiddenField.dom.name=v?'':this.el.dom.name}},convertValue:function(v){return(v===!0||v==='true'||v===this.submitOnValue||String(v).toLowerCase()==='on')}});Ext.reg('xcheckbox',Ext.ux.form.XCheckbox);Ext.ns('Rad');Rad.Form=Ext.extend(Ext.form.FormPanel,{childGrids:[],reloadGridOnClose:!1,border:!1,frame:!0,record:null,labelWidth:80,onAfterLoadRecord:null,buildComboStore:function(item){if(item.xtype=='xcombo'||item.xtype=='LinkTriggerField'||item.xtype=='AdvCombo'){if(item.store){storeCfg=item.store;if(storeCfg.storeType)item.store=new Ext.data[storeCfg.storeType](storeCfg.config)}}else{if(item.xtype=='radformabmeditorgridpanel'){this.childGrids.push(item)}else{if(item.items){Ext.each(item.items,this.buildComboStore,this)}}}},initComponent:function(){this.childGrids=[];this.addEvents('afterloadrecord');this.initialConfig.trackResetOnLoad=!0;Ext.each(this.initialConfig.items,this.buildComboStore,this);Rad.Form.superclass.initComponent.apply(this,arguments)},loadChildGrid:function(){Ext.each(this.childGrids,function(grid){var cmp=Ext.ComponentMgr.get(grid.id);cmp.parentForm=this;var field=this.getForm().findField(grid.parentRemoteField);var value=null;if(field){value=field.getValue()}
if(!value){value=0;cmp.newRecord=!0}else{cmp.newRecord=!1}
detailGrid={remotefield:grid.parentLocalField,localfield:grid.parentRemoteField};cmp.loadAsDetailGrid(detailGrid,value)},this)},loadRecord:function(record){this.record=record;this.getForm().loadRecord(record);this.autoLoadCombos();this.loadChildGrid();this.fireEvent("afterloadrecord",this)},onLoadClick:function(){this.load({url:this.url,waitMsg:'Cargando...'})},onAfterMetaChange:function(){},submit:function(){var opt={url:this.url,scope:this,success:this.onSuccess,failure:this.onFailure,waitTitle:'',waitMsg:'',params:{}};if(this.childGrids){Ext.each(this.childGrids,function(item){var cmp=Ext.ComponentMgr.get(item.id);if(cmp){opt.params[cmp.name]=cmp.getValue()}},this)}
if(this.url){v=this.getForm().isValid();if(!v){this.showError('El formulario contiene errores');return}
if(this.getForm().isDirty()){this.getForm().submit(opt)}else{this.getForm().fireEvent('actioncomplete',this)}}else{v=this.getForm().isValid();if(v){this.onSuccess()}else{this.showError('El formulario contiene errores')}}},autoLoadCombos:function(){var fn=function(item){if(item.xtype=='xcombo'||item.xtype=='LinkTriggerField'||item.xtype=='AdvCombo'){item.doCustomLoad()}else{if(item.items&&item.items.each){item.items.each(fn,this)}}}
this.items.each(fn,this)},fixBindedGridComboDescriptions:function(item){if(item.xtype=='xcombo'||item.xtype=='combo'||item.xtype=='LinkTriggerField'){var form=this.getForm();var combo=form.findField(item.id);this.record.set(item.name+"_cdisplay",combo.getRawValue())}else{if(item.items){item.items.each(this.fixBindedGridComboDescriptions,this)}}},updateGridStoreRecord:function(values){if(!this.record.store)return;if(values){if(!this.reloadGridOnClose){var fs=this.record.fields;fs.each(function(f){var v=values[f.name];this.record.data[f.name]=f.convert(v)},this);this.record._phid=this.record.id;this.record.id=values.Id;this.record.store.reMap(this.record);this.record.store.fireEvent('datachanged',this.record.store)}else{this.record.store.reload()}}else{this.getForm().updateRecord(this.record);this.items.each(this.fixBindedGridComboDescriptions,this)}},onSuccess:function(form,action){var form=this.getForm();if(this.record!=null){if(action){form.loadRecord(new Ext.data.Record(action.result.record))}
if(action){this.updateGridStoreRecord(action.result.record)}else{this.updateGridStoreRecord();this.getForm().fireEvent('actioncomplete',this)}}},onFailure:function(form,action){if(action.response&&action.response.status==506)return;if(action&&action.result){if(action.result.errors){var txt='<div align="left">';for(e in action.result.errors){txt=txt+'<b>'+e+'</b>: '+action.result.errors[e]+'<br>'}
txt=txt+'</div>';this.showError(txt);}else{this.showError(action.result.msg)}}else{if(action.failureType=='client'){this.showError('No se completaron todos los campos requeridos')}else{this.showError(action.response.responseText)}}},showError:function(msg,title){title=title||'Error';window.app.desktop.showMsg({title:title,msg:msg,modal:!0,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})}});Ext.reg('radform',Rad.Form);Ext.ns('Ext.ux.grid');Ext.ux.grid.GridSummary=function(config){Ext.apply(this,config)};Ext.extend(Ext.ux.grid.GridSummary,Ext.util.Observable,{setEventHandler:function(){this.view.afterMethod('onAllColumnWidthsUpdated',this.doAllWidths,this)},init:function(grid){this.grid=grid;this.view=grid.getView();var v=this.view;v.onLayout=this.onLayout;v.afterMethod('render',this.refreshSummary,this);v.afterMethod('refresh',this.refreshSummary,this);v.afterMethod('syncScroll',this.syncSummaryScroll,this);v.afterMethod('onColumnWidthUpdated',this.doWidth,this);v.afterMethod('onColumnHiddenUpdated',this.doHidden,this);grid.store.on({add:this.refreshSummary,remove:this.refreshSummary,clear:this.refreshSummary,update:this.refreshSummary,load:this.setEventHandler,scope:this});grid.getSelectionModel().on('selectionchange',this.refreshSummary,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row x-grid3-gridsummary-row-offset">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<tbody><tr>{cells}</tr></tbody>','</table>','</div>');this.rowTpl.disableFormats=!0}
this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>");this.cellTpl.disableFormats=!0}
this.cellTpl.compile()},calculate:function(rs,cm){var data={};var cm=this.grid.getColumnModel();var cfg=cm.config;for(var i=0,len=cfg.length;i<len;i++){var cf=cfg[i],cname=cf.dataIndex;data[cname]=0;if(cf.summaryType){isFunction=(typeof cf.summaryType)==='function';for(var j=0,jlen=rs.length;j<jlen;j++){var r=rs[j];if(isFunction){data[cname]=cf.summaryType(r.get(cname),r,cname,data,j,this.grid)}else{data[cname]=Ext.ux.grid.GridSummary.Calculations[cf.summaryType](r.get(cname),r,cname,data,j,this.grid)}}}}
return data},onLayout:function(vw,vh){if(Ext.type(vh)!='number'){return}
if(!this.grid.getGridEl().hasClass('x-grid-hide-gridsummary')){this.scroller.setHeight(vh-this.summary.getHeight())}},syncSummaryScroll:function(){var mb=this.view.scroller.dom;this.view.summaryWrap.dom.scrollLeft=mb.scrollLeft;this.view.summaryWrap.dom.scrollLeft=mb.scrollLeft},doWidth:function(col,w,tw){var s=this.view.summary.dom;s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.width=w},doAllWidths:function(ws,tw){var s=this.view.summary.dom,wlen=ws.length;s.firstChild.style.width=tw;var cells=s.firstChild.rows[0].childNodes;for(var j=0;j<wlen;j++){cells[j].style.width=ws[j]}},doHidden:function(col,hidden,tw){var s=this.view.summary.dom,display=hidden?'none':'';s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.display=display},renderSummary:function(o,cs,cm){cs=cs||this.view.getColumnData();var buf=[],last=cs.length-1;var cm=this.grid.getColumnModel();var cfg=cm.config;for(var i=0,len=cs.length;i<len;i++){var c=cs[i],cf=cfg[i],p={};p.id=c.id;p.style=c.style;p.css=i==0?'x-grid3-cell-first ':(i==last?'x-grid3-cell-last ':'');if(cf.summaryType||cf.summaryRenderer){p.value=(cf.summaryRenderer||c.renderer)(o.data[c.name],p,o)}else{p.value=''}
if(p.value==undefined||p.value==="")p.value="";buf[buf.length]=this.cellTpl.apply(p)}
return this.rowTpl.apply({tstyle:'width:'+this.view.getTotalWidth()+';',cells:buf.join('')})},refreshSummary:function(){var g=this.grid,ds=g.store,cs=this.view.getColumnData(),cm=this.cm,rs=ds.getRange(),data=this.calculate(rs,cm),buf=this.renderSummary({data:data},cs,cm);this.totales=data;if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:'div',cls:'x-grid3-gridsummary-row-inner'},!0)}
this.view.summary=this.view.summaryWrap.update(buf).first()},toggleSummary:function(visible){var el=this.grid.getGridEl();if(el){if(visible===undefined){visible=el.hasClass('x-grid-hide-gridsummary')}
el[visible?'removeClass':'addClass']('x-grid-hide-gridsummary');this.view.layout()}},getSummaryNode:function(){return this.view.summary}});Ext.reg('gridsummary',Ext.ux.grid.GridSummary);Ext.ux.grid.GridSummary.Calculations={checkedsum:function(v,record,colName,data,rowIdx,grid){if(record.data.checked){return data[colName]+Ext.num(v,0)}else{return data[colName]}},selectedsum:function(v,record,colName,data,rowIdx,grid){if(record.data.checked){return data[colName]+Ext.num(v,0)}else{return data[colName]}},sum:function(v,record,colName,data,rowIdx){return data[colName]+Ext.num(v,0)},count:function(v,record,colName,data,rowIdx){return rowIdx+1},max:function(v,record,colName,data,rowIdx){return Math.max(Ext.num(v,0),data[colName])},min:function(v,record,colName,data,rowIdx){return Math.min(Ext.num(v,0),data[colName])},average:function(v,record,colName,data,rowIdx){var t=data[colName]+Ext.num(v,0),count=record.store.getCount();return rowIdx==count-1?(t/count):t}};Ext.ns('Rad');Ext.override(Ext.PagingToolbar,{beforeLoad:function(t,options){if(this.rendered&&this.refresh){this.refresh.disable()}
if(options.params.start==undefined){options.params.start=this.cursor;options.params.limit=this.pageSize}}});Ext.override(Ext.data.Store,{iniSection:null,load:function(options){options=Ext.apply({},options);this.storeOptions(options);if(this.sortInfo&&this.remoteSort){var pn=this.paramNames;options.params=Ext.apply({},options.params);options.params[pn.sort]=this.sortInfo.field;options.params[pn.dir]=this.sortInfo.direction}
if(!options.params)options.params={};options.params.section=this.iniSection;if(!this.fields){options.params.reconfigure=!0}else{if(options.params){delete options.params.reconfigure}}
try{return this.execute('read',null,options)}catch(e){this.handleException(e);return!1}}});Rad.GridPanel=function(config){Rad.GridPanel.superclass.constructor.call(this,config)}
Rad.EditorGridPanel=function(config){Rad.EditorGridPanel.superclass.constructor.call(this,config)}
var metagrid={topButtons:{add:!0,del:!0,edit:!0},enableDragDrop:!0,ddGroup:'grillassistema',model:null,module:null,reloadOnModelUpdate:!0,initPreview:!0,loadAuto:!0,configured:!1,withPaginator:!0,addingRow:!1,autoSave:!1,detailGrid:null,parentGrid:null,parentForm:null,parentRemoteField:null,parentLocalField:null,iniSection:'default',multisort:!1,loadMask:{msg:'Cargando ...'},buildToolbar:function(){},createMultiSorter:function(){var reorderer=new Ext.ux.ToolbarReorderer();var droppable=new Ext.ux.ToolbarDroppable({scope:this,createItem:function(data){var column=this.getColumnFromDragDrop(data);return this.scope.createSorterButton({text:column.header,sortData:{field:column.dataIndex,direction:"ASC"}})},canDrop:function(dragSource,event,data){var sorters=dragSource.grid.getSorters(),column=this.getColumnFromDragDrop(data);if(column.multisortable==!1)return!1;for(var i=0;i<sorters.length;i++){if(sorters[i].field==column.dataIndex){return!1}}
return!0},afterLayout:function(){this.scope.doSort()},getColumnFromDragDrop:function(data){var index=data.header.cellIndex,colModel=this.scope.colModel,column=colModel.getColumnById(colModel.getColumnId(index));return column}});this.multisortbar=new Ext.Toolbar({renderTo:this.tbar,plugins:[reorderer,droppable],listeners:{reordered:{fn:function(button){this.changeSortDirection(button,!1)},scope:this},afterrender:{fn:function(button){var dragProxy=this.getView().columnDrag,ddGroup=dragProxy.ddGroup;droppable.addDDGroup(ddGroup)},scope:this}},items:[{icon:'images/delete.png',title:'Quitar Orden',handler:function(){this.clearSort()},scope:this},new Ext.form.Label({html:'Orden:'})]})},changeSortDirection:function(button,changeDirection){var sortData=button.sortData,iconCls=button.iconCls;if(sortData!=undefined){if(changeDirection!==!1){button.sortData.direction=button.sortData.direction.toggle("ASC","DESC");button.setIconClass(iconCls.toggle("sort-asc","sort-desc"))}
this.store.clearFilter();this.doSort()}},getSorters:function(){var sorters=[];Ext.each(this.multisortbar.findByType('button'),function(button){if(button.multisortbutton){sorters.push(button.sortData)}},this);return sorters},createSorterButton:function(config){config=config||{};Ext.applyIf(config,{multisortbutton:!0,listeners:{click:{fn:function(button,e){this.changeSortDirection(button,!0)},scope:this}},iconCls:'sort-'+config.sortData.direction.toLowerCase(),reorderable:!0});return new Ext.Button(config)},clearSort:function(){var sorters=this.getSorters();Ext.each(this.multisortbar.findByType('button'),function(button){if(button.multisortbutton){button.destroy()}
this.doSort()},this)},doSort:function(){var sorters=this.getSorters();var s='',f='';delete this.store.baseParams.sort;delete this.store.baseParams.dir;Ext.each(sorters,function(item){f=f.concat(item.field,',');s=s.concat(item.direction,',')});Ext.apply(this.store.baseParams,{sort:f,dir:s});this.store.reload()},updateRecorFromJson:function(record,values){record.fields.each(function(f){var v=values[f.name];if(v!=null){record.set(f.name,f.convert(v))}else{record.set(f.name,null)}},this)},maskEmpty:!0,newKey:-1,primaryKey:'Id',stripeRows:!0,trackMouseOver:!0,storeUpdatePublish:function(action,data){e={obj:this,action:action,e:data};this.publish('/rad/model/'+this.model+'/',e)},onModelUpdate:function(){},__suscribeToModelEvent:function(model){this.subscribe('/rad/model/'+model+'/',function(config,channel){if(this==config.obj)return;if(this.reloadOnModelUpdate){if(this.store.getTotalCount())this.store.reload()}
this.onModelUpdate(config)},this)},buildStore:function(){this.writer=new Ext.data.JsonWriter({encode:!0,returnJson:!0,writeAllFields:!1});this.store=new Ext.data.GroupingStore({autoLoad:this.loadAuto,autoSave:this.autoSave,pruneModifiedRecords:!0,autoDestroy:!0,iniSection:this.iniSection,reader:new Ext.data.JsonReader({idProperty:'Id',messageProperty:'msg'}),proxy:this.proxy,writer:this.writer,remoteSort:!0,groupOnSort:!1,listeners:this.store.listeners})},initComponent:function(config){this.addEvents('afterdeleterows','aftersavefield');this.buildToolbar();if(this.tbar){this.addReportButton();if(this.multisort){this.on('render',function(){this.createMultiSorter();this.syncSize()},this)}}
Ext.applyIf(this,{plugins:[],pagingPlugins:[],viewConfig:{emptyText:'No hay Datos',forceFit:!0}});if(this.filters){this.filters=new Ext.ux.grid.GridFilters({filters:[]});this.plugins.push(this.filters);this.pagingPlugins.push(this.filters)}
if(!this.store)this.store={};if(!this.store.listeners)this.store.listeners={};this.store.listeners.metachange={fn:this.onMetaChange,scope:this}
var postUrl='';if(this.module){postUrl='/m/'+this.module}
if(this.fetch){postUrl=postUrl+'/fetch/'+this.fetch}
this.proxy=new Ext.data.HttpProxy({api:{read:this.url+'/list/model/'+this.model+postUrl,create:this.url+'/createrow/model/'+this.model+postUrl,update:this.url+'/saverows/model/'+this.model+postUrl,destroy:this.url+'/deleterow/model/'+this.model+postUrl}});this.buildStore();if(this.model){this.__suscribeToModelEvent(this.model);this.on('afterdeleterows',function(r){this.storeUpdatePublish('remove',r)},this);this.store.on('update',function(s,r,a){if(a==Ext.data.Record.COMMIT)
this.storeUpdatePublish('update',r)},this)}
if(this.maskEmpty){this.store.on('load',function(){var el=this.getGridEl();if(this.detailGrid!=null){this.maskDetailGrids()}
if(this.store.getTotalCount()==0&&typeof el=='object'){if(this.store.baseParams['filter[0][data][type]']==undefined){}}else{el.unmask()}},this)}
if(this.withPaginator){this.pagingToolbar=new Ext.PagingToolbar({store:this.store,pageFit:!0,pageSize:this.pageSize||25,beforePageText:'Pág',plugins:this.pagingPlugins,displayInfo:!0,displayMsg:'{0} - {1} de {2}',emptyMsg:"No hay Datos para mostrar"});this.bbar=this.pagingToolbar}
if(this.columns&&(this.columns instanceof Array)){this.colModel=new Ext.grid.ColumnModel(this.columns);delete this.columns}
if(!this.colModel){this.colModel=new Ext.grid.ColumnModel([])}
this.colModel.defaultSortable=!0;Rad.GridPanel.superclass.initComponent.call(this);this.store.baseParams=this.baseParams||{};if(this.detailGrid!=null){var sm=this.getSelectionModel();sm.on('beforerowselect',function(grid,idx,k,record)
{this.reloadChildGrids(record)},this)}},maskDetailGrids:function(){Ext.each(this.detailGrid,function(detailGrid){if(detailGrid instanceof Rad.GridPanel){var gridD=detailGrid}else{var gridD=Ext.getCmp(detailGrid.id)}
if(!gridD){alert("No se encontro la grilla hija "+detailGrid.id+"  para "+this.id)}
if(gridD.store.getCount())gridD.store.loadData({rows:[],count:0},!1);gridD.getGridEl().parent().mask('Seleccione el dato relacionado...','x-mask')},this)},addReportButton:function(){if(this.report&&typeof this.report!="undefined"){Ext.each(this.report,function(r){if(r.separator){this.tbar.push('-')}
if(r.menu){Ext.each(r.menu,function(rc){Ext.applyIf(rc,{text:'Reporte',icon:'images/printer.png',cls:'x-btn-text-icon',ref:'../reportButton',handler:(rc.file)?this.reportWindow:Ext.EmpyFn,scope:this,})},this)}else{Ext.applyIf(r,{text:'Reporte',icon:'images/printer.png',cls:'x-btn-text-icon',ref:'../reportButton',handler:(r.file)?this.reportWindow:Ext.EmpyFn,scope:this,disabled:!this.loadAuto})}
this.tbar.push(r)},this)}},reportWindow:function(r){if(typeof r.requireSelected!='undefined'&&r.requireSelected==!1){var selected={id:-1}}else{var selected=this.getSelectionModel().getSelected()}
if(selected){this.publish('/desktop/modules/Window/birtreporter',{action:'launch',template:r.file,id:selected.id,params:r.params,output:r.output||'pdf',width:(r.window&&r.window.width)||null,height:(r.window&&r.window.height)||null})}else{this.publish('/desktop/showMsg/',{title:'Atencion',msg:'Seleccione un registro para ver el reporte'})}},reloadChildGrids:function(record){if(!this.detailGrid)return;Ext.each(this.detailGrid,function(detailGrid){var gridD=Ext.getCmp(detailGrid.id);if(gridD!=undefined){gridD.parentGrid=this;value=record.get(detailGrid.localfield)
gridD.loadAsDetailGrid(detailGrid,value)}},this)},deleteRows:function(){if(this.stopEditing)this.stopEditing();else if(this.editor.stopEditing)this.editor.stopEditing();records=this.getSelectionModel().getSelections();this.store.remove(records);this.store.save();this.fireEvent('afterdeleterows',records)},buildFilter:function(i,field,value,type,cmp){if(!cmp)cmp='eq';if(!type)type='numeric';var rt={};rt['pfilter['+i+'][field]']=field;rt['pfilter['+i+'][data][value]']=value;rt['pfilter['+i+'][data][type]']=type;rt['pfilter['+i+'][data][comparison]']=cmp;return rt},setPermanentFilter:function(i,field,value,type,cmp){if(i>this.permanentFilterCount)this.permanentFilterCount=i+1;if(!this.store.baseParams)this.store.baseParams={};Ext.apply(this.store.baseParams,this.buildFilter(i,field,value,type,cmp))},clearPermanentFilter:function(i){delete this.store.baseParams['pfilter['+i+'][field]'];delete this.store.baseParams['pfilter['+i+'][data][value]'];delete this.store.baseParams['pfilter['+i+'][data][type]'];delete this.store.baseParams['pfilter['+i+'][data][comparison]']},addPermanentFilter:function(field,value,type,cmp){if(!this.permanentFilterCount)this.permanentFilterCount=0;if(!this.store.baseParams)this.store.baseParams={};Ext.apply(this.store.baseParams,this.buildFilter(this.permanentFilterCount,field,value,type,cmp));this.permanentFilterCount++},loadAsDetailGrid:function(detailConfig,value)
{if(!value)value=0;this.parentLocalField=detailConfig.remotefield;this.parentRemoteField=detailConfig.localfield;this.setPermanentFilter(0,detailConfig.remotefield,value);this.store.load()},onMetaChange:function(store,meta){var columns=[],editor,plugins,storeCfg,l,convert;this.primaryKey=meta.idProperty;Ext.each(meta.fields,function(col){if(col.plugin!==undefined){columns.push(eval(col.plugin));return}
if(col.header==undefined){return}
if(typeof col.dataIndex=="undefined"){col.dataIndex=col.name}
if(typeof col.renderer=="string"){if(col.renderer.indexOf("Ext")<0&&col.renderer.indexOf("function")<0){col.renderer=this[col.renderer].createDelegate(this)}else{col.renderer=eval(col.renderer)}}
l=col.listeners;if(typeof l=="object"){for(var e in l){if(typeof e=="string"){for(var c in l[e]){if(typeof c=="string"){l[e][c]=eval(l[e][c])}}}}}
if(this.multisort){if(col.sortable){col.sortable=!1;col.multisortable=!0}else{col.multisortable=!1}}
if(col.convert){col.convert=eval(col.convert)}
editor=col.editor;if(editor){switch(editor.xtype){case 'combo':case 'xcombo':if(col.editor.store){storeCfg=col.editor.store;storeCfg.config.autoDestroy=!0;col.editor.store=new Ext.data[storeCfg.storeType](storeCfg.config)}
col.editor=Ext.ComponentMgr.create(editor,'textfield');break;case 'xdatefield':col.editor=Ext.ComponentMgr.create(editor,'textfield');break;default:col.editor=Ext.ComponentMgr.create(editor,'textfield');break}
plugins=editor.plugins;delete(editor.plugins);l=editor.listeners;if(typeof l=="object"){for(var e in l){if(typeof e=="string"){for(var c in l[e]){if(typeof c=="string"){l[e][c]=eval(l[e][c])}}}}}}
if(plugins instanceof Array){editor.plugins=[];Ext.each(plugins,function(plugin){plugin.name=plugin.name||col.dataIndex;editor.plugins.push(Ext.ComponentMgr.create(plugin))})}
columns.push(col)},this);if(this.onBeforeCreateColumns!=undefined)
{this.onBeforeCreateColumns(columns)}
var cm=new Ext.grid.ColumnModel(columns);if(meta.defaultSortable!=undefined){cm.defaultSortable=meta.defaultSortable}
var store=this.store;this.reconfigure(store,cm);if(meta.groupField!=undefined&&store.groupField==undefined&&meta.groupField!=''&&this.view instanceof Ext.grid.GroupingView){store.groupField=meta.groupField;store.applyGroupField()}
if(this.stateful){this.initState()}
if(this.onAfterMetaChange!=undefined)
{this.onAfterMetaChange()}}};Ext.extend(Rad.GridPanel,Ext.grid.GridPanel,metagrid);CommonEditorGrid={getParentValue:function(){if(this.parentGrid){var selected=this.parentGrid.getSelectionModel().getSelected();if(!selected){this.publish('/desktop/showError','Seleccione primero el dato relacionado');this.addingRow=!1;return}
return selected.get(this.parentRemoteField)}else{if(this.parentForm){field=this.parentForm.getForm().findField(this.parentRemoteField);if(!field){this.publish('/desktop/showError','El campo '+this.parentRemoteField+' no se encuentra')}else{return field.getValue()}}}},buildStore:function(){this.writer=new Ext.data.JsonWriter({encode:!0,returnJson:!0,writeAllFields:!1});this.store=new Ext.data.GroupingStore({autoLoad:this.loadAuto,autoSave:this.autoSave,pruneModifiedRecords:!0,iniSection:this.iniSection,autoDestroy:!0,reader:new Ext.data.JsonReader({idProperty:'Id',messageProperty:'msg'}),proxy:this.proxy,writer:this.writer,remoteSort:!0,remoteGroup:!0,listeners:this.store.listeners})},deleteRows:function(){if(this.stopEditing)this.stopEditing();else if(this.editor.stopEditing)this.editor.stopEditing();this.publish('/desktop/showMsg/',{title:'Borrar',msg:'¿Está seguro que desea borrar los registros seleccionados?',buttons:Ext.Msg.YESNO,fn:function(btn){if(btn=='yes'){records=this.getSelectionModel().getSelections();this.store.remove(records);this.fireEvent('afterdeleterows',records)}},scope:this,icon:Ext.MessageBox.QUESTION})},createRow:function(){if(this.addingRow)return;var u=new this.store.recordType();if(this.editor){this.editor.stopEditing()}
if(this.stopEditing){this.stopEditing()}
var el=this.getGridEl();el.unmask();this.store.insert(0,u);this.addingRow=!0},onStoreWrite:function(store,action,result){if(action==Ext.data.Api.actions.create){this.getSelectionModel().selectRow(0);selected=this.getSelectionModel().getSelected();parentValue=this.getParentValue();if(parentValue===!1)return;selected.data[this.parentLocalField]=parentValue;this.fireEditor()}}}
Ext.extend(Rad.EditorGridPanel,Rad.GridPanel,{withRowEditor:!1,initComponent:function(){Ext.applyIf(this,{plugins:[]});if(this.withRowEditor){this.editor=new Ext.ux.grid.RowEditor({saveText:'Guardar',cancelText:'Cancelar',commitChangesText:'Debe guardar o cancelar los cambios',errorText:'Error'});this.editor.on('canceledit',function(){var selected=this.grid.getSelectionModel().getSelected();if(this.grid.addingRow&&!this.grid.deferSave){if(selected.get(selected.store.reader.meta.idProperty)==0){this.grid.store.suspendEvents();this.grid.store.remove(selected);this.grid.store.resumeEvents();this.grid.getView().refresh()}else{this.grid.storeUpdatePublish('add',selected)}}
this.grid.addingRow=!1});this.plugins.push(this.editor)}
Rad.EditorGridPanel.superclass.initComponent.call(this);this.store.on('write',this.onStoreWrite,this);if(!this.loadAuto){this.store.on('beforeload',this.enableButtons,this)}},enableButtons:function(){this.disableButtons(!1)},disableButtons:function(disabled){var toolbar=this.getTopToolbar();if(!toolbar)return;toolbar.items.each(function(item){if(item.setDisabled){item.setDisabled(disabled)}},this)},fireEditor:function(){if(this.editor)this.editor.startEditing(0)},buildToolbar:function(){var cfg=[];if(this.topButtons.add){cfg.push({text:'Agregar',ref:'../addButton',iconCls:'add',handler:this.createRow,scope:this,disabled:!this.loadAuto})}
if(this.topButtons.del){cfg.push({text:'Borrar',ref:'../delButton',iconCls:'remove',handler:this.deleteRows,scope:this,disabled:!this.loadAuto})}
if(cfg.length==0)return;this.tbar=cfg}});Ext.override(Rad.EditorGridPanel,CommonEditorGrid);Rad.FastEditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,metagrid);Rad.FastEditorGridPanel=Ext.extend(Rad.FastEditorGridPanel,{saveRecords:function(){this.stopEditing();this.store.save()},buildToolbar:function(){this.autoSave=!1;var id=this.getId();var cfg=[];if(this.topButtons.add){cfg.push({text:'Guardar',icon:'/images/accept.png',ref:'../addButton',handler:this.saveRecords,scope:this})}
if(this.topButtons.del){cfg.push({text:'Borrar',iconCls:'remove',ref:'../delButton',handler:this.deleteRows,scope:this})}
if(cfg.length==0)return;this.tbar=cfg},initComponent:function(){Rad.FastEditorGridPanel.superclass.initComponent.call(this);this.store.on('write',this.onStoreWrite,this)},fireEditor:function(){this.startEditing(0)}});Ext.override(Rad.FastEditorGridPanel,CommonEditorGrid);Rad.ABMWindow=Ext.extend(Ext.Window,{autoHideOnSubmit:!0,grid:null,onCloseWindow:function(){var selected=this.grid.getSelectionModel().getSelected();if(selected){if(this.grid.addingRow&&!this.grid.deferSave&&selected.store){if(selected.get(selected.store.reader.meta.idProperty)==0){this.grid.store.suspendEvents();this.grid.store.remove(selected);this.grid.store.resumeEvents();this.grid.getView().refresh();this.grid.maskDetailGrids()}else{this.grid.storeUpdatePublish('add',selected);this.grid.reloadChildGrids(selected)}}}
this.grid.addingRow=!1;var el=this.grid.getGridEl();el.unmask();this.grid.disableButtons(!1);this.grid.onAbmWindowHide()},closeAbm:function(){this.onCloseWindow();this.hide()},onEsc:function(k,e){if(this.activeGhost){this.unghost()}
e.stopEvent();this.closeAbm()},initComponent:function(){this.initialConfig.closeAction='hide';this.closeAction='hide';Rad.ABMWindow.superclass.initComponent.call(this,arguments);if(this.autoHideOnSubmit){this.getForm().on('actioncomplete',function(){this.closeAbm()},this)}
this.on('render',function(){var closeb=this.getTool('close');closeb.on('click',function(){this.onCloseWindow();this[this.closeAction]()},this)},this);this.on('show',function(){this.onAbmWindowShow()},this.grid)},getForm:function(){if(this.items.items[0]instanceof Rad.Form){return this.items.items[0]}else if(this.grid.abmFormId){return this.findById(this.grid.abmFormId)}else{this.publish('/desktop/showError','La ventana ABMWindow no puede retornar el formulario<br>Posiblemente falte sobreescribir el método getForm');return!1}}});Rad.ABMEditorGridPanel=function(config){Rad.ABMEditorGridPanel.superclass.constructor.call(this,config)}
Ext.extend(Rad.ABMEditorGridPanel,Rad.EditorGridPanel,{abmWindow:null,abmForm:null,abmWindowConfig:null,abmWindowTitle:null,abmWindowWidth:750,abmWindowHeight:500,abmFormId:null,abmFormAutoHidde:!0,onAbmWindowHide:Ext.emptyFn,onAbmWindowShow:Ext.emptyFn,onRowDblClick:function(grid,rowIndex,e){if(this.withRowEditor==!0)return;var rsm=grid.getSelectionModel();row=grid.store.getAt(rowIndex);if(rsm.isIdSelected(row.data.Id)){this.abmWindowShow()}},onDestroy:function(){if(this.abmWindow){this.abmWindow.destroy()}
Rad.ABMEditorGridPanel.superclass.onDestroy.call(this)},getAbmWindowConfig:function(){var config={layout:'fit',width:this.abmWindowWidth,height:this.abmWindowHeight,title:this.abmWindowTitle,plain:!0,modal:!1,bodyStyle:'padding:0px;margin:0px;',border:!1,constrain:!0,items:this.abmForm,id:this.id+'_formwindow',grid:this}
Ext.apply(config,this.abmWindowConfig);return config},createEditorWindow:function(){this.abmWindow=app.desktop.createWindow(this.getAbmWindowConfig(),Rad.ABMWindow)},abmWindowShow:function(){var selected=this.getSelectionModel().getSelected();if(selected!=undefined){if(this.abmWindow==null){this.createEditorWindow()}
this.disableButtons(!0);var el=this.getGridEl();el.mask();this.abmWindow.show();var form=this.abmWindow.getForm();if(form){form.loadRecord(selected)}else{Ext.MessageBox.alert('Atencion','No se encontro el formulario para cargar los datos')}}else{Ext.MessageBox.alert('Atencion','Seleccione un registro a editar')}},buildToolbar:function(){var id=this.getId();var cfg=[];if(this.topButtons.add){cfg.push({text:'Agregar',iconCls:'add',handler:this.createRow,ref:'../addButton',scope:this,disabled:!this.loadAuto})}
if(this.topButtons.edit){cfg.push({text:'Editar',iconCls:'x-btn-text-icon',ref:'../editButton',icon:'images/application_form_edit.png',handler:this.abmWindowShow,scope:this,disabled:!this.loadAuto})}
if(this.topButtons.del){cfg.push('-');cfg.push({text:'Borrar',ref:'../delButton',iconCls:'remove',handler:this.deleteRows,scope:this,disabled:!this.loadAuto})}
if(this.topButtons.extra){Ext.each(this.topButtons.extra,function(btn){cfg.push(btn)})}
if(cfg.length==0)return;this.tbar=cfg},initComponent:function(){this.autoSave=!0;Rad.ABMEditorGridPanel.superclass.initComponent.call(this);if(!this.loadAuto){this.store.on('beforeload',this.enableButtons,this)}
this.on('rowdblclick',function(grid,index,e){this.onRowDblClick(grid,index,e)},this)},fireEditor:function(){this.abmWindowShow()},enableButtons:function(){this.disableButtons(!1)},disableButtons:function(disabled){var toolbar=this.getTopToolbar();if(!toolbar)return;toolbar.items.each(function(item){if(item.setDisabled){item.setDisabled(disabled)}},this)}});Rad.FormABMEditorGridPanel=function(config){Rad.FormABMEditorGridPanel.superclass.constructor.call(this,config)}
Ext.extend(Rad.FormABMEditorGridPanel,Rad.ABMEditorGridPanel,{deferSave:!0,newRecord:!1,getValue:function(){var records=this.store.getModifiedRecords();var data=[];Ext.each(records,function(item){data.push(item.data)},this);return Ext.util.JSON.encode(data)},validate:function(){return!0},initComponent:function(){this.autoSave=!1;Rad.FormABMEditorGridPanel.superclass.initComponent.call(this);this.un('afteredit',this.saveField,this)},createRow:function(){Rad.callRemoteJsonAction({url:this.url+'/createrow/model/'+this.model,scope:this,success:function(response){if(this.addingRow)return;var u=new this.store.recordType(response.rows[0]);if(this.editor)this.editor.stopEditing();var el=this.getGridEl();el.unmask();var parentValue=this.getParentValue();if(parentValue===!1)return;u.data[this.parentLocalField]=parentValue;this.store.insert(0,u);this.addingRow=!0;this.getSelectionModel().selectRow(0);this.abmWindowShow()}})},buildStore:function(){this.store=new Ext.data.GroupingStore({autoLoad:this.loadAuto,autoSave:this.autoSave,pruneModifiedRecords:!0,iniSection:this.iniSection,autoDestroy:!0,reader:new Ext.data.JsonReader({idProperty:'Id',messageProperty:'msg'}),proxy:this.proxy,remoteSort:!1,remoteGroup:!1,listeners:this.store.listeners})}});Rad.ManyToManyGridPanel=function(config){Rad.ManyToManyGridPanel.superclass.constructor.call(this,config)}
manyToManyGrid={enableDragDrop:!1,saveUrl:null,relationRowId:3,initComponent:function(){this.addEvents('saverelation');this.autoSave=!1;Rad.ManyToManyGridPanel.superclass.initComponent.apply(this);var postUrl;if(this.module)postUrl='/m/'+this.module;if(this.fetch)postUrl=postUrl+'/fetch/'+this.fetch;this.proxy.api.read.url=this.url+'/listmtom/model/'+this.model+postUrl;this.store.on('metachange',function(cols){var cm=this.getColumnModel();cm.config[0].init(this);cm.config[0].bindEvents()},this)},buildToolbar:function(){this.tbar=[{'text':'Asignar',icon:'/images/accept.png',ref:'../addButton',iconCls:'x-btn-text-icon',handler:this.saveRelation,scope:this}]},loadAsDetailGrid:function(detailConfig,value)
{if(!value)value=0;this.parentLocalField=detailConfig.remotefield;this.parentRemoteField=detailConfig.localfield;this.relationRowId=value;this.store.baseParams.Id=this.relationRowId;this.store.reload()},saveRelation:function()
{var changes=this.store.getModifiedRecords(),i=0;var param={};Ext.each(changes,function(e){param['changes['+i+'][id]']=e.data.Id;param['changes['+i+'][state]']=e.data.checked;i++});param.Id=this.relationRowId;if(i==0){this.fireEvent('saverelation',{status:!0});this.store.reload();return}
Ext.apply(param,this.baseParams);Rad.callRemoteJsonAction({url:this.saveUrl,scope:this,params:param,success:function(response){this.store.reload();this.fireEvent('saverelation',{status:!0});this.publish('/desktop/notify',{title:'Info',iconCls:'x-icon-information',html:'Cambios guardados'})}})}};Ext.extend(Rad.ManyToManyGridPanel,Rad.GridPanel,manyToManyGrid);Rad.ManyToManyEditorGridPanel=function(config){Rad.ManyToManyEditorGridPanel.superclass.constructor.call(this,config)}
Ext.extend(Rad.ManyToManyEditorGridPanel,Rad.ABMEditorGridPanel,manyToManyGrid);Ext.reg('radgridpanel',Rad.GridPanel);Ext.reg('radeditorgridpanel',Rad.EditorGridPanel);Ext.reg('radfasteditorgridpanel',Rad.FastEditorGridPanel);Ext.reg('radabmeditorgridpanel',Rad.ABMEditorGridPanel);Ext.reg('radformabmeditorgridpanel',Rad.FormABMEditorGridPanel);Ext.reg('radformmanytomanygridpanel',Rad.ManyToManyGridPanel);Ext.reg('radformmanytomanyeditorgridpanel',Rad.ManyToManyEditorGridPanel);Ext.ns('Ext.ux.form');Ext.ux.form.DateTime=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:'input',type:'hidden'},timeWidth:100,dtSeparator:' ',hiddenFormat:'Y-m-d H:i:s',otherToNow:!0,timePosition:'right',dateFormat:'m/d/y',timeFormat:'g:i A',initComponent:function(){Ext.ux.form.DateTime.superclass.initComponent.call(this);var dateConfig=Ext.apply({},{id:this.id+'-date',format:this.dateFormat||Ext.form.DateField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);this.df=new Ext.form.DateField(dateConfig);this.df.ownerCt=this;delete(this.dateFormat);var timeConfig=Ext.apply({},{id:this.id+'-time',format:this.timeFormat||Ext.form.TimeField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);this.tf=new Ext.form.TimeField(timeConfig);this.tf.ownerCt=this;delete(this.timeFormat);this.relayEvents(this.df,['focus','specialkey','invalid','valid']);this.relayEvents(this.tf,['focus','specialkey','invalid','valid'])},onRender:function(ct,position){if(this.isRendered){return}
Ext.ux.form.DateTime.superclass.onRender.call(this,ct,position);var t;if('below'===this.timePosition||'bellow'===this.timePosition){t=Ext.DomHelper.append(ct,{tag:'table',style:'border-collapse:collapse',children:[{tag:'tr',children:[{tag:'td',style:'padding-bottom:1px',cls:'ux-datetime-date'}]},{tag:'tr',children:[{tag:'td',cls:'ux-datetime-time'}]}]},!0)}
else{t=Ext.DomHelper.append(ct,{tag:'table',style:'border-collapse:collapse',children:[{tag:'tr',children:[{tag:'td',style:'padding-right:4px',cls:'ux-datetime-date'},{tag:'td',cls:'ux-datetime-time'}]}]},!0)}
this.tableEl=t;this.wrap=t.wrap({cls:'x-form-field-wrap'});this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});this.df.render(t.child('td.ux-datetime-date'));this.tf.render(t.child('td.ux-datetime-time'));if(Ext.isIE&&Ext.isStrict){t.select('input').applyStyles({top:0})}
this.on('specialkey',this.onSpecialKey,this);this.df.el.swallowEvent(['keydown','keypress']);this.tf.el.swallowEvent(['keydown','keypress']);if('side'===this.msgTarget){var elp=this.el.findParent('.x-form-element',10,!0);this.errorIcon=elp.createChild({cls:'x-form-invalid-icon'});this.df.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon}
this.el.dom.name=this.hiddenName||this.name||this.id;this.df.el.dom.removeAttribute("name");this.tf.el.dom.removeAttribute("name");this.isRendered=!0;this.updateHidden()},afterRender:function(){this.df.getEl().on('dblclick',this.onDblClick);this.tf.getEl().on('dblclick',this.onDblClick)},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,'tl-tr',[2,0])},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0)},clearInvalid:function(){this.df.clearInvalid();this.tf.clearInvalid()},markInvalid:function(msg){this.df.markInvalid(msg);this.tf.markInvalid(msg)},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();this.wrap.remove();this.tableEl.remove();this.df.destroy();this.tf.destroy()}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;this.df.onDisable();this.tf.onDisable()}
this.disabled=!0;this.df.disabled=!0;this.tf.disabled=!0;this.fireEvent("disable",this);return this},enable:function(){if(this.rendered){this.df.onEnable();this.tf.onEnable()}
this.disabled=!1;this.df.disabled=!1;this.tf.disabled=!1;this.fireEvent("enable",this);return this},focus:function(){this.df.focus()},getPositionEl:function(){return this.wrap},getResizeEl:function(){return this.wrap},getValue:function(){return this.dateValue?new Date(this.dateValue):''},isValid:function(){return this.df.isValid()&&this.tf.isValid()},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible()},onBlur:function(f){if(this.wrapClick){f.focus();this.wrapClick=!1}
if(f===this.df){this.updateDate()}
else{this.updateTime()}
this.updateHidden();(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var v=this.getValue();if(String(v)!==String(this.startValue)){this.fireEvent("change",this,v,this.startValue)}
this.hasFocus=!1;this.fireEvent('blur',this)}}).defer(100,this)},onFocus:function(){if(!this.hasFocus){this.hasFocus=!0;this.startValue=this.getValue();this.fireEvent("focus",this)}},onMouseDown:function(e){if(!this.disabled){this.wrapClick='td'===e.target.nodeName.toLowerCase()}},onDblClick:function(){Ext.getCmp(this.id).ownerCt.df.setValue(new Date());Ext.getCmp(this.id).ownerCt.tf.setValue(new Date())},onSpecialKey:function(t,e){var key=e.getKey();if(key===e.TAB){if(t===this.df&&!e.shiftKey){e.stopEvent();this.tf.focus()}
if(t===this.tf&&e.shiftKey){e.stopEvent();this.df.focus()}}
if(key===e.ENTER){this.updateValue()}},setDate:function(date){this.df.setValue(date)},setTime:function(date){this.tf.setValue(date)},setSize:function(w,h){if(!w){return}
if('below'===this.timePosition){this.df.setSize(w,h);this.tf.setSize(w,h);if(Ext.isIE){this.df.el.up('td').setWidth(w);this.tf.el.up('td').setWidth(w)}}
else{this.df.setSize(w-this.timeWidth-4,h);this.tf.setSize(this.timeWidth,h);if(Ext.isIE){this.df.el.up('td').setWidth(w-this.timeWidth-4);this.tf.el.up('td').setWidth(this.timeWidth)}}},setValue:function(val){if(!val&&!0===this.emptyToNow){this.setValue(new Date());return}
else if(!val){this.setDate('');this.setTime('');this.updateValue();return}
if('number'===typeof val){val=new Date(val)}
else if('string'===typeof val&&this.hiddenFormat){val=Date.parseDate(val,this.hiddenFormat)}
val=val?val:new Date(1970,0,1,0,0,0);var da,time;if(val instanceof Date){this.setDate(val);this.setTime(val);this.dateValue=new Date(val)}
else{da=val.split(this.dtSeparator);this.setDate(da[0]);if(da[1]){if(da[2]){da[1]+=da[2]}
this.setTime(da[1])}}
this.updateValue()},setVisible:function(visible){if(visible){this.df.show();this.tf.show()}else{this.df.hide();this.tf.hide()}
return this},show:function(){return this.setVisible(!0)},hide:function(){return this.setVisible(!1)},updateDate:function(){var d=this.df.getValue();if(d){if(!(this.dateValue instanceof Date)){this.initDateValue();if(!this.tf.getValue()){this.setTime(this.dateValue)}}
this.dateValue.setMonth(0);this.dateValue.setFullYear(d.getFullYear());this.dateValue.setMonth(d.getMonth(),d.getDate())}
else{this.dateValue='';this.setTime('')}},updateTime:function(){var t=this.tf.getValue();if(t&&!(t instanceof Date)){t=Date.parseDate(t,this.tf.format)}
if(t&&!this.df.getValue()){this.initDateValue();this.setDate(this.dateValue)}
if(this.dateValue instanceof Date){if(t){this.dateValue.setHours(t.getHours());this.dateValue.setMinutes(t.getMinutes());this.dateValue.setSeconds(t.getSeconds())}
else{this.dateValue.setHours(0);this.dateValue.setMinutes(0);this.dateValue.setSeconds(0)}}},updateHidden:function(){if(this.isRendered){var value=this.dateValue instanceof Date?this.dateValue.format(this.hiddenFormat):'';this.el.dom.value=value}},updateValue:function(){this.updateDate();this.updateTime();this.updateHidden();return},validate:function(){return this.df.validate()&&this.tf.validate()},renderer:function(field){var format=field.editor.dateFormat||Ext.ux.form.DateTime.prototype.dateFormat;format+=' '+(field.editor.timeFormat||Ext.ux.form.DateTime.prototype.timeFormat);var renderer=function(val){var retval=Ext.util.Format.date(val,format);return retval};return renderer}});Ext.reg('xdatetime',Ext.ux.form.DateTime);(function(){var addListener=function(){if(window.addEventListener){return function(el,eventName,fn,capture){el.addEventListener(eventName,fn,!!capture)}}else{if(window.attachEvent){return function(el,eventName,fn,capture){el.attachEvent("on"+eventName,fn)}}else{return function(){}}}}(),removeListener=function(){if(window.removeEventListener){return function(el,eventName,fn,capture){el.removeEventListener(eventName,fn,(capture))}}else{if(window.detachEvent){return function(el,eventName,fn){el.detachEvent("on"+eventName,fn)}}else{return function(){}}}}();var EV=Ext.lib.Event;var MIM;var MASK_TARGET="x-frame-mask-target";Ext.ux.ManagedIFrame=function(){var args=Array.prototype.slice.call(arguments,0),el=Ext.get(args[0]),config=args[0];if(el&&el.dom&&el.dom.tagName=="IFRAME"){config=args[1]||{}}else{config=args[0]||args[1]||{};el=config.autoCreate?Ext.get(Ext.DomHelper.append(config.autoCreate.parent||Ext.getBody(),Ext.apply({tag:"iframe",frameborder:0,src:(Ext.isIE&&Ext.isSecure)?Ext.SSL_SECURE_URL:"about:blank"},config.autoCreate))):null;if(el&&this.unsupportedText){Ext.DomHelper.append(el.dom.parentNode,{tag:"noframes",html:this.unsupportedText})}}if(!el||el.dom.tagName!="IFRAME"){return el}el.dom.name||(el.dom.name=el.dom.id);el.dom.ownerEl=el;this.addEvents({"focus":!0,"blur":!0,"unload":!0,"domready":!0,"documentloaded":!0,"exception":!0,"message":!0});if(config.listeners){this.listeners=config.listeners;Ext.ux.ManagedIFrame.superclass.constructor.call(this)}Ext.apply(el,this);el.addClass("x-managed-iframe");if(config.style){el.applyStyles(config.style)}Ext.apply(el,{disableMessaging:config.disableMessaging===!0,loadMask:!!config.loadMask?Ext.apply({msg:"Loading..",maskEl:null,hideOnReady:!1,disabled:!1},config.loadMask):!1,_windowContext:null,eventsFollowFrameLinks:typeof config.eventsFollowFrameLinks=="undefined"?true:config.eventsFollowFrameLinks});if(el.loadMask){el.loadMask.maskEl||(el.loadMask.maskEl=el.parent("."+MASK_TARGET)||el.parent());el.loadMask.maskEl.addClass(MASK_TARGET)}var um=el.updateManager=new Ext.UpdateManager(el,!0);um.showLoadIndicator=config.showLoadIndicator||!1;Ext.ux.ManagedIFrame.Manager.register(el);if(config.src){el.setSrc(config.src)}else{var content=config.html||config.content||!1;if(content){el.reset(null,function(frame){frame.update.apply(el,[].concat(content))})}}return el};Ext.extend(Ext.ux.ManagedIFrame,Ext.util.Observable,{src:null,CSS:null,manager:null,disableMessaging:!0,domReadyRetries:7500,resetUrl:(function(){if(Ext.isIE&&Ext.isSecure){return Ext.SSL_SECURE_URL}else{return"about:blank"}})(),unsupportedText:"Inline frames are NOT enabled/supported by your browser.",setSrc:function(url,discardUrl,callback,scope){if(url&&typeof url=="object"){callback=url.callback||!1;discardUrl=url.discardUrl||!1;url=url.url||!1;scope=url.scope||null}var src=url||this.src||this.resetUrl;this._windowContext=null;this._unHook();this._frameAction=this.frameInit=this._domReady=!1;this.showMask();var s=this._targetURI=typeof src=="function"?src()||"":src;try{this._frameAction=!0;this._callBack=typeof callback=="function"?callback.createDelegate(scope):null;this.dom.src=s;this.frameInit=!0;this.checkDOM()}catch(ex){this.fireEvent("exception",this,ex)}if(discardUrl!==!0){this.src=src}return this},setLocation:function(url,discardUrl,callback,scope){if(url&&typeof url=="object"){callback=url.callback||!1;discardUrl=url.discardUrl||!1;url=url.url||!1;scope=url.scope||null}var src=url||this.src||this.resetUrl;this._windowContext=null;this._unHook();this._frameAction=this.frameInit=this._domReady=!1;this.showMask();var s=this._targetURI=typeof src=="function"?src()||"":src;try{this._frameAction=!0;this._callBack=typeof callback=="function"?callback.createDelegate(scope):null;this.getWindow().location.replace(s);this.frameInit=!0;this.checkDOM()}catch(ex){this.fireEvent("exception",this,ex)}if(discardUrl!==!0){this.src=src}return this},reset:function(src,callback,scope){this._unHook();var loadMaskOff=!1;if(this.loadMask){loadMaskOff=this.loadMask.disabled;this.loadMask.disabled=!1}this._callBack=function(frame){if(frame.loadMask){frame.loadMask.disabled=loadMaskOff}frame._frameAction=!1;frame.frameInit=!0;this._isReset=!1;if(callback){callback.call(scope||window,frame)}};this.hideMask(!0);this._frameAction=!1;this.frameInit=!0;this._isReset=!0;var s=src;if(typeof src=="function"){s=src()}s=this._targetURI=Ext.isEmpty(s,!0)?this.resetUrl:s;this.getWindow().location.href=s;return this},scriptRE:/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/gi,update:function(content,loadScripts,callback,scope){loadScripts=loadScripts||this.getUpdateManager().loadScripts||!1;content=Ext.DomHelper.markup(content||"");content=loadScripts===!0?content:content.replace(this.scriptRE,"");var doc;if((doc=this.getDocument())&&!!content.length){this._unHook();this._windowContext=this.src=null;this._targetURI=location.href;this.src=null;this.frameInit=!0;this.showMask();this._callBack=typeof callback=="function"?callback.createDelegate(scope):null;doc.open();this._frameAction=!0;doc.write(content);doc.close();this.checkDOM()}else{this.hideMask(!0);if(callback){callback.call(scope,this)}}return this},disableMessaging:!0,_XFrameMessaging:function(){var tagStack={"$":[]};var isEmpty=function(v,allowBlank){return v===null||v===undefined||(!allowBlank?v==="":!1)};var apply=function(o,c,defaults){if(defaults){apply(o,defaults)}if(o&&c&&typeof c=="object"){for(var p in c){o[p]=c[p]}}return o};window.sendMessage=function(message,tag,origin){var MIF;if(MIF=arguments.callee.manager){if(message._fromHost){var fn,result;var compTag=message.tag||tag||null;var mstack=!isEmpty(compTag)?tagStack[compTag.toLowerCase()]||[]:tagStack["$"];for(var i=0,l=mstack.length;i<l;i++){if(fn=mstack[i]){result=fn.apply(fn.__scope,arguments)===!1?false:result;if(fn.__single){mstack[i]=null}if(result===!1){break}}}return result}else{message={type:isEmpty(tag)?"message":"message:"+tag.toLowerCase().replace(/^\s+|\s+$/g,""),data:message,domain:origin||document.domain,uri:document.documentURI,source:window,tag:isEmpty(tag)?null:tag.toLowerCase()};try{return MIF.disableMessaging!==!0?MIF.fireEvent.call(MIF,message.type,MIF,message):null}catch(ex){}return null}}};window.onhostmessage=function(fn,scope,single,tag){if(typeof fn=="function"){if(!isEmpty(fn.__index)){throw"onhostmessage: duplicate handler definition"+(tag?" for tag:"+tag:"")}var k=isEmpty(tag)?"$":tag.toLowerCase();tagStack[k]||(tagStack[k]=[]);apply(fn,{__tag:k,__single:single||!1,__scope:scope||window,__index:tagStack[k].length});tagStack[k].push(fn)}else{throw"onhostmessage: function required"}};window.unhostmessage=function(fn){if(typeof fn=="function"&&typeof fn.__index!="undefined"){var k=fn.__tag||"$";tagStack[k][fn.__index]=null}}},getHistory:function(){var h=null;try{h=this.getWindow().history}catch(eh){}return h},get:function(el){return MIM.El.get(this,el)},fly:function(el,named){named=named||"_global";el=this.getDom(el);if(!el){return null}if(!MIM._flyweights[named]){MIM._flyweights[named]=new Ext.Element.Flyweight()}MIM._flyweights[named].dom=el;return MIM._flyweights[named]},getDom:function(el){var d;if(!el||!(d=this.getDocument())){return null}return el.dom?el.dom:(typeof el=="string"?d.getElementById(el):el)},select:function(selector,unique){var d;return(d=this.getDocument())?Ext.Element.select(selector,unique,d):null},query:function(selector){var d;return(d=this.getDocument())?Ext.DomQuery.select(selector,d):null},getDoc:function(){return this.get(this.getDocument())},removeNode:function(node){MIM.removeNode(this,this.getDom(node))},_unHook:function(){var elcache,h=MIM.getFrameHash(this)||{};if(this._hooked){if(h&&(elcache=h.elCache)){for(var id in elcache){var el=elcache[id];if(el.removeAllListeners){el.removeAllListeners()}delete elcache[id]}if(h.docEl){h.docEl.removeAllListeners();h.docEl=null;delete h.docEl}}var w;if(this._frameProxy&&(w=this.getWindow())){removeListener(w,"focus",this._frameProxy);removeListener(w,"blur",this._frameProxy);removeListener(w,"resize",this._frameProxy);removeListener(w,"unload",this._frameProxy)}}this._hooked=this._domReady=this._domFired=this._frameAction=!1;MIM._flyweights={};this.CSS=this.CSS?this.CSS.destroy():null},_renderHook:function(){this._windowContext=null;this.CSS=this.CSS?this.CSS.destroy():null;this._hooked=!1;try{if(this.writeScript('(function(){(window.hostMIF = parent.Ext.get("'+this.dom.id+'"))._windowContext='+(Ext.isIE?"window":"{eval:function(s){return eval(s);}}")+";})();")){this._frameProxy||(this._frameProxy=MIM.eventProxy.createDelegate(this));var w;if(w=this.getWindow()){addListener(w,"focus",this._frameProxy);addListener(w,"blur",this._frameProxy);addListener(w,"resize",this._frameProxy);addListener(w,"unload",this._frameProxy)}if(this.disableMessaging!==!0){this.loadFunction({name:"XMessage",fn:this._XFrameMessaging},!1,!0);var sm;if(sm=w.sendMessage){sm.manager=this}}this.CSS=new CSSInterface(this.getDocument())}}catch(ex){console.warn(ex)}return(this._hooked=this.domWritable())},sendMessage:function(message,tag,origin){var win;if(this.disableMessaging!==!0&&(win=this.getWindow())){tag||(tag=message.tag||"");tag=tag.toLowerCase();message=Ext.applyIf(message.data?message:{data:message},{type:Ext.isEmpty(tag)?"message":"message:"+tag,domain:origin||document.domain,uri:document.documentURI,source:window,tag:tag||null,_fromHost:this});return win.sendMessage?win.sendMessage.call(null,message,tag,origin):null}return null},_windowContext:null,getDocument:function(){var win=this.getWindow(),doc=null;try{doc=(Ext.isIE&&win?win.document:null)||this.dom.contentDocument||window.frames[this.id].document||null}catch(gdEx){return!1}return doc},getBody:function(){var d;return(d=this.getDocument())?d.body:null},getDocumentURI:function(){var URI,d;try{URI=this.src&&(d=this.getDocument())?d.location.href:null}catch(ex){}return URI||(typeof this.src=="function"?this.src():this.src)},getWindowURI:function(){var URI,w;try{URI=(w=this.getWindow())?w.location.href:null}catch(ex){}return URI||(typeof this.src=="function"?this.src():this.src)},getWindow:function(){var dom=this.dom,win=null;try{win=dom.contentWindow||window.frames[dom.name]||null}catch(gwEx){}return win},print:function(){var win;try{if(win=this.getWindow()){if(Ext.isIE){win.focus()}win.print()}}catch(ex){throw"print exception: "+(ex.description||ex.message||ex)}},destroy:function(){this.removeAllListeners();if(this.loadMask){this.hideMask(!0);Ext.apply(this.loadMask,{masker:null,maskEl:null})}if(this.dom){Ext.ux.ManagedIFrame.Manager.deRegister(this);this.dom.ownerEl=this._windowContext=null;if(Ext.isIE&&this.dom.src){this.dom.src="javascript:false"}this._maskEl=null;this.remove()}},domWritable:function(){return!!this._windowContext},execScript:function(block,useDOM){try{if(this.domWritable()){if(useDOM){this.writeScript(block)}else{return this._windowContext.eval(block)}}else{throw"execScript:non-secure context"}}catch(ex){this.fireEvent("exception",this,ex);return!1}return!0},writeScript:function(block,attributes){attributes=Ext.apply({},attributes||{},{type:"text/javascript",text:block});try{var head,script,doc=this.getDocument();if(doc&&typeof doc.getElementsByTagName!="undefined"){if(!(head=doc.getElementsByTagName("head")[0])){head=doc.createElement("head");doc.getElementsByTagName("html")[0].appendChild(head)}if(head&&(script=doc.createElement("script"))){for(var attrib in attributes){if(attributes.hasOwnProperty(attrib)&&attrib in script){script[attrib]=attributes[attrib]}}return!!head.appendChild(script)}}}catch(ex){this.fireEvent("exception",this,ex)}return!1},loadFunction:function(fn,useDOM,invokeIt){var name=fn.name||fn;var fn=fn.fn||window[fn];this.execScript(name+"="+fn,useDOM);if(invokeIt){this.execScript(name+"()")}},mask:function(msg,msgCls,maskCls){this._mask&&this.unmask();var p=this.parent("."+MASK_TARGET)||this.parent();if(p.getStyle("position")=="static"&&!p.select("iframe,frame,object,embed").elements.length){p.addClass("x-masked-relative")}p.addClass("x-masked");this._mask=Ext.DomHelper.append(p,{cls:maskCls||"ext-el-mask"},!0);this._mask.setDisplayed(!0);this._mask._agent=p;var delay=(this.loadMask?this.loadMask.delay:0)||10;if(typeof msg=="string"){this._maskMsg=Ext.DomHelper.append(p,{cls:msgCls||"ext-el-mask-msg x-mask-loading",style:{visibility:"hidden"},cn:{tag:"div",html:msg}},!0);this._maskMsg.setVisibilityMode(Ext.Element.VISIBILITY);(function(){this._mask&&this._maskMsg&&this._maskMsg.center(p).setVisible(!0)}).defer(delay,this)}if(Ext.isIE&&!(Ext.isIE7&&Ext.isStrict)&&this.getStyle("height")=="auto"){this._mask.setSize(undefined,this._mask.getHeight())}return this._mask},unmask:function(){var a;if(this._mask){(a=this._mask._agent)&&a.removeClass(["x-masked-relative","x-masked"]);if(this._maskMsg){this._maskMsg.remove();delete this._maskMsg}this._mask.remove();delete this._mask}},showMask:function(msg,msgCls,maskCls){var lmask=this.loadMask;if(lmask&&!lmask.disabled&&!this._mask){this.mask(msg||lmask.msg,msgCls||lmask.msgCls,maskCls||lmask.maskCls)}},hideMask:function(forced){var tlm=this.loadMask;if(tlm&&!!this._mask){if(forced||(tlm.hideOnReady&&this._domReady)){this.unmask()}}},submitAsTarget:function(submitCfg){var opt=submitCfg||{},D=document;var form=opt.form||Ext.DomHelper.append(D.body,{tag:"form",cls:"x-hidden"});form=Ext.getDom(form.form||form);form.target=this.dom.name;form.method=opt.method||"POST";opt.encoding&&(form.enctype=form.encoding=String(opt.encoding));opt.url&&(form.action=opt.url);var hiddens,hd;if(opt.params){hiddens=[];var ps=typeof opt.params=="string"?Ext.urlDecode(params,!1):opt.params;for(var k in ps){if(ps.hasOwnProperty(k)){hd=D.createElement("input");hd.type="hidden";hd.name=k;hd.value=ps[k];form.appendChild(hd);hiddens.push(hd)}}}this._callBack=typeof opt.callback=="function"?opt.callback.createDelegate(opt.scope):null;this._frameAction=this.frameInit=!0;this._targetURI=location.href;this.showMask();(function(){form.submit();hiddens&&Ext.each(hiddens,Ext.removeNode,Ext);Ext.fly(form,"_dynaForm").hasClass("x-hidden")&&Ext.removeNode(form);this.hideMask(!0)}).defer(100,this)},loadHandler:function(e,target){target||(target={});var rstatus=(e&&typeof e.type!=="undefined"?e.type:this.dom.readyState);if(!this.frameInit||(!this._frameAction&&!this.eventsFollowFrameLinks)){return}switch(rstatus){case"domready":var M;try{M=this.getWindow()?this.getWindow().hostMIF:null}catch(access){}if(this._frameAction&&!M){this.frameInit&&this._renderHook()&&this.fireEvent.defer(1,this,["domready",this]);this._domFired=this._hooked}case"domfail":this._domReady=!0;this.hideMask();break;case"load":case"complete":if(!this._domFired){this.loadHandler({type:"domready",id:this.id},this.dom)}Ext.isIE&&this.getWindow()&&this.getWindow().focus();if(this._frameAction||this.eventsFollowFrameLinks){this.fireEvent.defer(1,this,["documentloaded",this]);if(this._callBack){this._callBack.defer(1,null,[this])}}this._frameAction=this.frameInit=!1;if(this.eventsFollowFrameLinks){this._domFired=this._domReady=!1}this.hideMask(!0);break;default:}this.frameState=rstatus},checkDOM:function(win){if(Ext.isOpera||Ext.isGecko||!this._frameAction){return}var n=0,manager=this,domReady=!1,b,l,d,max=this.domReadyRetries,polling=!1,startLocation=(this.getDocument()||{location:{}}).location.href;(function(){d=manager.getDocument()||{location:{}};polling=(d.location.href!==startLocation||d.location.href===manager._targetURI);if(!manager._frameAction||manager._domReady){return}domReady=polling&&((b=manager.getBody())&&!!(b.innerHTML||"").length)||!1;if(d.location.href&&!domReady&&(++n<max)){setTimeout(arguments.callee,2);return}manager.loadHandler({type:domReady?"domready":"domfail"})})()}});var styleCamelRe=/(-[a-z])/gi;var styleCamelFn=function(m,a){return a.charAt(1).toUpperCase()};var CSSInterface=function(hostDocument){var doc;if(hostDocument){doc=hostDocument;return{rules:null,destroy:function(){return doc=null},createStyleSheet:function(cssText,id){var ss;if(!doc){return}var head=doc.getElementsByTagName("head")[0];var rules=doc.createElement("style");rules.setAttribute("type","text/css");if(id){rules.setAttribute("id",id)}if(Ext.isIE){head.appendChild(rules);ss=rules.styleSheet;ss.cssText=cssText}else{try{rules.appendChild(doc.createTextNode(cssText))}catch(e){rules.cssText=cssText}head.appendChild(rules);ss=rules.styleSheet?rules.styleSheet:(rules.sheet||doc.styleSheets[doc.styleSheets.length-1])}this.cacheStyleSheet(ss);return ss},removeStyleSheet:function(id){if(!doc){return}var existing=doc.getElementById(id);if(existing){existing.parentNode.removeChild(existing)}},swapStyleSheet:function(id,url){this.removeStyleSheet(id);if(!doc){return}var ss=doc.createElement("link");ss.setAttribute("rel","stylesheet");ss.setAttribute("type","text/css");ss.setAttribute("id",id);ss.setAttribute("href",url);doc.getElementsByTagName("head")[0].appendChild(ss)},refreshCache:function(){return this.getRules(!0)},cacheStyleSheet:function(ss){if(this.rules){this.rules={}}try{var ssRules=ss.cssRules||ss.rules;for(var j=ssRules.length-1;j>=0;--j){this.rules[ssRules[j].selectorText]=ssRules[j]}}catch(e){}},getRules:function(refreshCache){if(this.rules==null||refreshCache){this.rules={};if(doc){var ds=doc.styleSheets;for(var i=0,len=ds.length;i<len;i++){try{this.cacheStyleSheet(ds[i])}catch(e){}}}}return this.rules},getRule:function(selector,refreshCache){var rs=this.getRules(refreshCache);if(!Ext.isArray(selector)){return rs[selector]}for(var i=0;i<selector.length;i++){if(rs[selector[i]]){return rs[selector[i]]}}return null},updateRule:function(selector,property,value){if(!Ext.isArray(selector)){var rule=this.getRule(selector);if(rule){rule.style[property.replace(styleCamelRe,styleCamelFn)]=value;return!0}}else{for(var i=0;i<selector.length;i++){if(this.updateRule(selector[i],property,value)){return!0}}}return!1}}}};Ext.ux.ManagedIframePanel=Ext.extend(Ext.Panel,{defaultSrc:null,bodyStyle:{position:"relative"},frameStyle:{overflow:"auto"},frameConfig:null,hideMode:!Ext.isIE?"nosize":"display",shimCls:"x-frame-shim",shimUrl:null,loadMask:!1,stateful:!1,animCollapse:Ext.isIE&&Ext.enableFx,autoScroll:!1,closable:!0,ctype:"Ext.ux.ManagedIframePanel",showLoadIndicator:!1,unsupportedText:"Inline frames are NOT enabled/supported by your browser.",initComponent:function(){var f=this.frameConfig?this.frameConfig.autoCreate||this.frameConfig:{};var frCfg=Ext.apply(f,{id:f.id||Ext.id()});frCfg.name=f.name||frCfg.id;if(Ext.isIE&&Ext.isSecure){frCfg.src=Ext.SSL_SECURE_URL}var frameTag=Ext.apply({tag:"iframe",frameborder:0,cls:"x-managed-iframe",style:this.frameStyle||f.style||{}},frCfg);var unsup=this.unsupportedText?{tag:"noframes",html:this.unsupportedText}:[];this.bodyCfg||(this.bodyCfg={cls:this.baseCls+"-body",children:this.contentEl?[]:[frameTag].concat(unsup)});this.autoScroll=!1;this.items=null;if(this.stateful!==!1){this.stateEvents||(this.stateEvents=["documentloaded"])}Ext.ux.ManagedIframePanel.superclass.initComponent.call(this);this.monitorResize||(this.monitorResize=!!this.fitToParent);this.addEvents({documentloaded:!0,domready:!0,message:!0,exception:!0,blur:!0,focus:!0});this.addListener=this.on},doLayout:function(){if(this.fitToParent&&!this.ownerCt){var pos=this.getPosition(),size=(Ext.get(this.fitToParent)||this.getEl().parent()).getViewSize();this.setSize(size.width-pos[0],size.height-pos[1])}Ext.ux.ManagedIframePanel.superclass.doLayout.apply(this,arguments)},beforeDestroy:function(){if(this.rendered){if(this.tools){for(var k in this.tools){Ext.destroy(this.tools[k])}}if(this.header&&this.headerAsText){var s;if(s=this.header.child("span")){s.remove(!0,!0)}this.header.update("")}Ext.each(["iframe","shim","header","topToolbar","bottomToolbar","footer","loadMask","body","bwrap"],function(elName){if(this[elName]){if(typeof this[elName].destroy=="function"){this[elName].destroy()}else{Ext.destroy(this[elName])}this[elName]=null;delete this[elName]}},this)}Ext.ux.ManagedIframePanel.superclass.beforeDestroy.call(this)},onDestroy:function(){Ext.Panel.superclass.onDestroy.call(this)},afterRender:function(container){var html=this.html;delete this.html;Ext.ux.ManagedIframePanel.superclass.afterRender.apply(this,arguments);if(this.iframe=this.body.child("iframe")){this.iframe.ownerCt=this;if(this.loadMask){var mEl;if(mEl=this.loadMask.maskEl){(this[mEl]||mEl||this.body).addClass(MASK_TARGET)}this.loadMask=Ext.apply({disabled:!1,hideOnReady:!1},this.loadMask)}this.getUpdater().showLoadIndicator=this.showLoadIndicator||!1;var ownerCt=this.ownerCt;while(ownerCt){ownerCt.on("afterlayout",function(container,layout){var MIM=Ext.ux.ManagedIFrame.Manager,st=!1;Ext.each(["north","south","east","west"],function(region){var reg;if((reg=layout[region])&&reg.splitEl){st=!0;if(!reg.split._splitTrapped){reg.split.on("beforeresize",MIM.showShims,MIM);reg.split._splitTrapped=!0}}},this);if(st&&!this._splitTrapped){this.on("resize",MIM.hideShims,MIM);this._splitTrapped=!0}},this,{single:!0});ownerCt=ownerCt.ownerCt}this.shim=Ext.get(this.body.child("."+this.shimCls))||Ext.DomHelper.append(this.body,{tag:"img",src:this.shimUrl||Ext.BLANK_IMAGE_URL,cls:this.shimCls,galleryimg:"no"},!0);var El=Ext.Element;var mode=El[this.hideMode.toUpperCase()]||"x-hide-nosize";Ext.each([this[this.collapseEl],this.floating?null:this.getActionEl(),this.iframe],function(el){if(el){el.setVisibilityMode(mode)}},this);if(this.iframe=new Ext.ux.ManagedIFrame(this.iframe,{loadMask:this.loadMask,showLoadIndicator:this.showLoadIndicator,disableMessaging:this.disableMessaging,style:this.frameStyle,src:this.defaultSrc,html:html})){this.loadMask=this.iframe.loadMask;this.iframe.ownerCt=this;this.relayEvents(this.iframe,["blur","focus","unload","documentloaded","domready","exception","message"].concat(this._msgTagHandlers||[]));delete this._msgTagHandlers}}},sendMessage:function(){if(this.iframe){this.iframe.sendMessage.apply(this.iframe,arguments)}},filterOptRe:/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,on:function(name){var tagRE=/^message\:/i,n=null;if(typeof name=="object"){for(var na in name){if(!this.filterOptRe.test(na)&&tagRE.test(na)){n||(n=[]);n.push(na.toLowerCase())}}}else{if(tagRE.test(name)){n=[name.toLowerCase()]}}if(this.getFrame()&&n){this.relayEvents(this.iframe,n)}else{this._msgTagHandlers||(this._msgTagHandlers=[]);if(n){this._msgTagHandlers=this._msgTagHandlers.concat(n)}}Ext.ux.ManagedIframePanel.superclass.on.apply(this,arguments)},setSrc:function(url,discardUrl,callback,scope){url=url||this.defaultSrc||!1;if(url&&this.rendered&&this.iframe){this.iframe.setSrc.call(this.iframe,url,discardUrl,callback,scope)}return this},setLocation:function(url,discardUrl,callback,scope){url=url||this.defaultSrc||!1;if(url&&this.rendered&&this.iframe){this.iframe.setLocation.call(this.iframe,url,discardUrl,callback,scope)}return this},getState:function(){var URI=this.iframe?this.iframe.getDocumentURI()||null:null;return Ext.apply(Ext.ux.ManagedIframePanel.superclass.getState.call(this)||{},URI?{defaultSrc:typeof URI=="function"?URI():URI}:null)},getUpdater:function(){return this.rendered?(this.iframe||this.body).getUpdater():null},getFrame:function(){return this.rendered?this.iframe:null},getFrameWindow:function(){return this.rendered&&this.iframe?this.iframe.getWindow():null},getFrameDocument:function(){return this.rendered&&this.iframe?this.iframe.getDocument():null},getFrameDoc:function(){return this.rendered&&this.iframe?this.iframe.getDoc():null},getFrameBody:function(){return this.rendered&&this.iframe?this.iframe.getBody():null},load:function(loadCfg){var um;if(um=this.getUpdater()){if(loadCfg&&loadCfg.renderer){um.setRenderer(loadCfg.renderer);delete loadCfg.renderer}um.update.apply(um,arguments)}return this},doAutoLoad:function(){this.load(typeof this.autoLoad=="object"?this.autoLoad:{url:this.autoLoad})}});Ext.ux.ManagedIFrame.Manager=MIM=function(){var frames={};var implementation={readyHandler:function(e){try{var $frame=e.target.ownerEl;if($frame&&$frame._frameAction){$frame.loadHandler.call($frame,{type:"domready"})}}catch(rhEx){return}},shimCls:"x-frame-shim",register:function(frame){frame.manager=this;frames[frame.id]=frames[frame.dom.name]={ref:frame,elCache:{}};frame.dom[Ext.isIE?"onreadystatechange":"onload"]=frame.loadHandler.createDelegate(frame);return frame},deRegister:function(frame){frame._unHook();frame.dom.onload=frame.dom.onreadystatechange=null;delete frames[frame.id];delete frames[frame.dom.name]},hideShims:function(){if(!this.shimApplied){return}Ext.select("."+this.shimCls,!0).removeClass(this.shimCls+"-on");this.shimApplied=!1},showShims:function(){if(!this.shimApplied){this.shimApplied=!0;Ext.select("."+this.shimCls,!0).addClass(this.shimCls+"-on")}},getFrameById:function(id){return typeof id=="string"?(frames[id]?frames[id].ref||null:null):null},getFrameByName:function(name){return this.getFrameById(name)},getFrameHash:function(frame){return frame.id?frames[frame.id]:null},eventProxy:function(e){if(!e){return}e=Ext.EventObject.setEvent(e);var be=e.browserEvent||e;(e.type=="unload")&&this._unHook();if(!be.eventPhase||(be.eventPhase==(be.AT_TARGET||2))){return this.fireEvent(e.type,e)}},_flyweights:{},destroy:function(){if(document.addEventListener){window.removeEventListener("DOMFrameContentLoaded",this.readyHandler,!0)}delete this._flyweights},removeNode:Ext.isIE?function(frame,n){frame=MIM.getFrameHash(frame);if(frame&&n&&n.tagName!="BODY"){d=frame.scratchDiv||(frame.scratchDiv=frame.getDocument().createElement("div"));d.appendChild(n);d.innerHTML=""}}:function(frame,n){if(n&&n.parentNode&&n.tagName!="BODY"){n.parentNode.removeChild(n)}}};if(document.addEventListener){window.addEventListener("DOMFrameContentLoaded",implementation.readyHandler,!0)}Ext.EventManager.on(window,"beforeunload",implementation.destroy,implementation);return implementation}();MIM.showDragMask=MIM.showShims;MIM.hideDragMask=MIM.hideShims;MIM.El=function(frame,el,forceNew){var frameObj;frame=(frameObj=MIM.getFrameHash(frame))?frameObj.ref:null;if(!frame){return null}var elCache=frameObj.elCache||(frameObj.elCache={});var dom=frame.getDom(el);if(!dom){return null}var id=dom.id;if(forceNew!==!0&&id&&elCache[id]){return elCache[id]}this.dom=dom;this.id=id||Ext.id(dom)};MIM.El.get=function(frame,el){var ex,elm,id,doc;if(!frame||!el){return null}var frameObj;frame=(frameObj=MIM.getFrameHash(frame))?frameObj.ref:null;if(!frame){return null}var elCache=frameObj.elCache||(frameObj.elCache={});if(!(doc=frame.getDocument())){return null}if(typeof el=="string"){if(!(elm=frame.getDom(el))){return null}if(ex=elCache[el]){ex.dom=elm}else{ex=elCache[el]=new MIM.El(frame,elm)}return ex}else{if(el.tagName){if(!(id=el.id)){id=Ext.id(el)}if(ex=elCache[id]){ex.dom=el}else{ex=elCache[id]=new MIM.El(frame,el)}return ex}else{if(el instanceof MIM.El){if(el!=frameObj.docEl){el.dom=frame.getDom(el.id)||el.dom;elCache[el.id]=el}return el}else{if(el.isComposite){return el}else{if(Ext.isArray(el)){return frame.select(el)}else{if(el==doc){if(!frameObj.docEl){var f=function(){};f.prototype=MIM.El.prototype;frameObj.docEl=new f();frameObj.docEl.dom=doc}return frameObj.docEl}}}}}}return null};Ext.apply(MIM.El.prototype,Ext.Element.prototype);Ext.ns("Ext.ux.panel","Ext.ux.portlet");Ext.reg("iframepanel",Ext.ux.panel.ManagedIframe=Ext.ux.ManagedIframePanel);Ext.ux.ManagedIframePortlet=Ext.extend(Ext.ux.ManagedIframePanel,{anchor:"100%",frame:!0,collapseEl:"bwrap",collapsible:!0,draggable:!0,cls:"x-portlet"});Ext.reg("iframeportlet",Ext.ux.portlet.ManagedIframe=Ext.ux.ManagedIframePortlet);Ext.apply(Ext.Element.prototype,{setVisible:function(visible,animate){if(!animate||!Ext.lib.Anim){if(this.visibilityMode==Ext.Element.DISPLAY){this.setDisplayed(visible)}else{if(this.visibilityMode==Ext.Element.VISIBILITY){this.fixDisplay();this.dom.style.visibility=visible?"visible":"hidden"}else{this[visible?"removeClass":"addClass"](String(this.visibilityMode))}}}else{var dom=this.dom;var visMode=this.visibilityMode;if(visible){this.setOpacity(0.01);this.setVisible(!0)}this.anim({opacity:{to:(visible?1:0)}},this.preanim(arguments,1),null,0.35,"easeIn",function(){if(!visible){if(visMode==Ext.Element.DISPLAY){dom.style.display="none"}else{if(visMode==Ext.Element.VISIBILITY){dom.style.visibility="hidden"}else{Ext.get(dom).addClass(String(visMode))}}Ext.get(dom).setOpacity(1)}})}return this},isVisible:function(deep){var vis=!(this.hasClass(this.visibilityMode)||this.getStyle("visibility")=="hidden"||this.getStyle("display")=="none");if(deep!==!0||!vis){return vis}var p=this.dom.parentNode;while(p&&p.tagName.toLowerCase()!="body"){if(!Ext.fly(p,"_isVisible").isVisible()){return!1}p=p.parentNode}return!0}});Ext.onReady(function(){var CSS=Ext.util.CSS,rules=[];CSS.getRule(".x-managed-iframe")||(rules.push(".x-managed-iframe {height:100%;width:100%;overflow:auto;position:relative;}"));CSS.getRule("."+MASK_TARGET)||(rules.push("."+MASK_TARGET+"{position:relative;zoom:1;}","."+MASK_TARGET+" .ext-el-mask-msg{z-index:101!important;} "));if(!CSS.getRule(".x-frame-shim")){rules.push(".x-frame-shim {z-index:8500;position:absolute;top:0px;left:0px;background:transparent!important;overflow:hidden;display:none;}");rules.push(".x-frame-shim-on{width:100%;height:100%;display:block;zoom:1;}");rules.push(".ext-ie6 .x-frame-shim{margin-left:5px;margin-top:3px;}")}CSS.getRule(".x-hide-nosize")||(rules.push(".x-hide-nosize,.x-hide-nosize *{height:0px!important;width:0px!important;border:none;}"));if(!!rules.length){CSS.createStyleSheet(rules.join(" "))}})})();if(Ext.provide){Ext.provide("miframe")};Ext.ns('Ext.ux.grid');Ext.ux.grid.CheckColumn=function(config){Ext.apply(this,config);if(!this.id){this.id=Ext.id()}
this.renderer=this.renderer.createDelegate(this)};Ext.ux.grid.CheckColumn.prototype={onlyDiferentValues:!1,modifiedChecks:{},init:function(grid){this.grid=grid;this.grid.on('render',this.bindEvents,this);if(this.onlyDiferentValues)this.grid.store.on('load',function(){this.modifiedChecks={}},this)},bindEvents:function(){var view=this.grid.getView();view.mainBody.on('mousedown',this.onMouseDown,this);Ext.fly(view.innerHd).on('mousedown',this.onHdMouseDown,this)},onMouseDown:function(e,t){if(Ext.fly(t).hasClass(this.createId())){e.stopEvent();var index=this.grid.getView().findRowIndex(t);var record=this.grid.store.getAt(index);if(this.onlyDiferentValues){if(!this.modifiedChecks[record.data.Id]){this.modifiedChecks[record.data.Id]=record.data.Id;record.set(this.dataIndex,!record.data[this.dataIndex])}else{delete this.modifiedChecks[record.data.Id];record.reject()}}else{record.set(this.dataIndex,!record.data[this.dataIndex])}}},onHdMouseDown:function(e,t){if(t.className=='x-grid3-hd-checker'){e.stopEvent();var hd=Ext.fly(t.parentNode);var isChecked=hd.hasClass('x-grid3-hd-checker-on');if(isChecked){hd.removeClass('x-grid3-hd-checker-on')}else{hd.addClass('x-grid3-hd-checker-on');var index=this.grid.getView().findRowIndex(t);var record=this.grid.store.getAt(index);var len=this.grid.store.getCount();alert(Ext.fly(this.grid.getView().findRowIndex(t)));for(var i=index;i<len;i++){record.set(this.dataIndex,!record.data[this.dataIndex])}}}},renderer:function(v,p,record){p.css+=' x-grid3-check-col-td';return String.format('<div class="x-grid3-check-col{0} {1}"> </div>',v?'-on':'',this.createId())},createId:function(){return 'x-grid3-cc-'+this.id}};Ext.preg('checkcolumn',Ext.ux.grid.CheckColumn);Ext.grid.CheckColumn=Ext.ux.grid.CheckColumn;Ext.ns('Rad');Rad.Map=function(config){Rad.Map.superclass.constructor.call(this,config)}
Ext.extend(Rad.Map,Ext.ux.ManagedIframePanel,{loadMask:!1,searchAddress:function(address){this.defaultSrc='http://maps.google.com.ar/?output=embed&q='+encodeURI(address);this.setSrc()},searchPath:function(sAddress,dAddress){this.defaultSrc='http://maps.google.com.ar/?output=embed&doflg=ptk&saddr='+encodeURI(sAddress)+'&daddr='+encodeURI(dAddress);this.setSrc()}});Ext.reg('radmap',Rad.Map);Ext.DataView.DragSelector=function(cfg){cfg=cfg||{};var view,proxy,tracker;var rs,bodyRegion,dragRegion=new Ext.lib.Region(0,0,0,0);var dragSafe=cfg.dragSafe===!0;this.init=function(dataView){view=dataView;view.on('render',onRender)};function fillRegions(){rs=[];view.all.each(function(el){rs[rs.length]=el.getRegion()});bodyRegion=view.el.getRegion()}
function cancelClick(){return!1}
function onBeforeStart(e){return!dragSafe||e.target==view.el.dom}
function onStart(e){view.on('containerclick',cancelClick,view,{single:!0});if(!proxy){proxy=view.el.createChild({cls:'x-view-selector'})}else{if(proxy.dom.parentNode!==view.el.dom){view.el.dom.appendChild(proxy.dom)}
proxy.setDisplayed('block')}
fillRegions();view.clearSelections()}
function onDrag(e){var startXY=tracker.startXY;var xy=tracker.getXY();var x=Math.min(startXY[0],xy[0]);var y=Math.min(startXY[1],xy[1]);var w=Math.abs(startXY[0]-xy[0]);var h=Math.abs(startXY[1]-xy[1]);dragRegion.left=x;dragRegion.top=y;dragRegion.right=x+w;dragRegion.bottom=y+h;dragRegion.constrainTo(bodyRegion);proxy.setRegion(dragRegion);for(var i=0,len=rs.length;i<len;i++){var r=rs[i],sel=dragRegion.intersect(r);if(sel&&!r.selected){r.selected=!0;view.select(i,!0)}else if(!sel&&r.selected){r.selected=!1;view.deselect(i)}}}
function onEnd(e){if(!Ext.isIE){view.un('containerclick',cancelClick,view)}
if(proxy){proxy.setDisplayed(!1)}}
function onRender(view){tracker=new Ext.dd.DragTracker({onBeforeStart:onBeforeStart,onStart:onStart,onDrag:onDrag,onEnd:onEnd});tracker.initEl(view.el)}};Ext.namespace('Ext.ux.grid.filter');Ext.ux.grid.filter.Filter=Ext.extend(Ext.util.Observable,{active:!1,dataIndex:null,menu:null,updateBuffer:800,constructor:function(config){Ext.apply(this,config);this.addEvents('activate','deactivate','serialize','update');Ext.ux.grid.filter.Filter.superclass.constructor.call(this);this.menu=new Ext.menu.Menu();this.init(config);if(config&&config.value){this.setValue(config.value);this.setActive(config.active!==!1,!0);delete config.value}},destroy:function(){if(this.menu){this.menu.destroy()}
this.purgeListeners()},init:Ext.emptyFn,getValue:Ext.emptyFn,setValue:Ext.emptyFn,isActivatable:function(){return!0},getSerialArgs:Ext.emptyFn,validateRecord:function(){return!0},serialize:function(){var args=this.getSerialArgs();this.fireEvent('serialize',args,this);return args},fireUpdate:function(){if(this.active){this.fireEvent('update',this)}
this.setActive(this.isActivatable())},setActive:function(active,suppressEvent){if(this.active!=active){this.active=active;if(suppressEvent!==!0){this.fireEvent(active?'activate':'deactivate',this)}}}});Ext.ux.grid.filter.StringFilter=Ext.extend(Ext.ux.grid.filter.Filter,{iconCls:'ux-gridfilter-text-icon',emptyText:'Inregrese el texto...',selectOnFocus:!0,width:125,init:function(config){Ext.applyIf(config,{enableKeyEvents:!0,iconCls:this.iconCls,listeners:{scope:this,keyup:this.onInputKeyUp}});this.inputItem=new Ext.form.TextField(config);this.menu.add(this.inputItem);this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this)},getValue:function(){return this.inputItem.getValue()},setValue:function(value){this.inputItem.setValue(value);this.fireEvent('update',this)},isActivatable:function(){return this.inputItem.getValue().length>0},getSerialArgs:function(){return{type:'string',value:this.getValue()}},validateRecord:function(record){var val=record.get(this.dataIndex);if(typeof val!='string'){return(this.getValue().length===0)}
return val.toLowerCase().indexOf(this.getValue().toLowerCase())>-1},onInputKeyUp:function(field,e){var k=e.getKey();if(k==e.RETURN&&field.isValid()){e.stopEvent();this.menu.hide(!0);return}
this.updateTask.delay(this.updateBuffer)}});Ext.ns('Ext.ux.menu');Ext.ux.menu.RangeMenu=Ext.extend(Ext.menu.Menu,{constructor:function(config){Ext.ux.menu.RangeMenu.superclass.constructor.call(this,config);this.addEvents('update');this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this);var i,len,item,cfg,Cls;for(i=0,len=this.menuItems.length;i<len;i++){item=this.menuItems[i];if(item!=='-'){cfg={itemId:'range-'+item,enableKeyEvents:!0,iconCls:this.iconCls[item]||'no-icon',listeners:{scope:this,keyup:this.onInputKeyUp}};Ext.apply(cfg,Ext.applyIf(this.fields[item]||{},this.fieldCfg[item]),this.menuItemCfgs);Cls=cfg.fieldCls||this.fieldCls;item=this.fields[item]=new Cls(cfg)}
this.add(item)}},fireUpdate:function(){this.fireEvent('update',this)},getValue:function(){var result={},key,field;for(key in this.fields){field=this.fields[key];if(field.isValid()&&String(field.getValue()).length>0){result[key]=field.getValue()}}
return result},setValue:function(data){var key;for(key in this.fields){this.fields[key].setValue(data[key]!==undefined?data[key]:'')}
this.fireEvent('update',this)},onInputKeyUp:function(field,e){var k=e.getKey();if(k==e.RETURN&&field.isValid()){e.stopEvent();this.hide(!0);return}
if(field==this.fields.eq){if(this.fields.gt){this.fields.gt.setValue(null)}
if(this.fields.lt){this.fields.lt.setValue(null)}}
else{this.fields.eq.setValue(null)}
this.updateTask.delay(this.updateBuffer)}});Ext.ux.grid.filter.NumericFilter=Ext.extend(Ext.ux.grid.filter.Filter,{updateBuffer:1200,fieldCls:Ext.form.NumberField,iconCls:{gt:'ux-rangemenu-gt',lt:'ux-rangemenu-lt',eq:'ux-rangemenu-eq'},menuItemCfgs:{emptyText:'Ingrese el texto...',selectOnFocus:!0,width:125},menuItems:['lt','gt','-','eq'],init:function(config){if(this.menu){this.menu.destroy()}
this.menu=new Ext.ux.menu.RangeMenu(Ext.apply(config,{fieldCfg:this.fieldCfg||{},fieldCls:this.fieldCls,fields:this.fields||{},iconCls:this.iconCls,menuItemCfgs:this.menuItemCfgs,menuItems:this.menuItems,updateBuffer:this.updateBuffer}));this.menu.on('update',this.fireUpdate,this)},getValue:function(){return this.menu.getValue()},setValue:function(value){this.menu.setValue(value)},isActivatable:function(){var values=this.getValue();for(key in values){if(values[key]!==undefined){return!0}}
return!1},getSerialArgs:function(){var key,args=[],values=this.menu.getValue();for(key in values){args.push({type:'numeric',comparison:key,value:values[key]})}
return args},validateRecord:function(record){var val=record.get(this.dataIndex),values=this.getValue();if(values.eq!==undefined&&val!=values.eq){return!1}
if(values.lt!==undefined&&val>=values.lt){return!1}
if(values.gt!==undefined&&val<=values.gt){return!1}
return!0}});Ext.namespace('Ext.ux.menu');Ext.ux.menu.ListMenu=Ext.extend(Ext.menu.Menu,{labelField:'text',loadingText:'Loading...',loadOnShow:!0,single:!1,constructor:function(cfg){this.selected=[];this.addEvents('checkchange');Ext.ux.menu.ListMenu.superclass.constructor.call(this,cfg=cfg||{});if(!cfg.store&&cfg.options){var options=[];for(var i=0,len=cfg.options.length;i<len;i++){var value=cfg.options[i];switch(Ext.type(value)){case 'array':options.push(value);break;case 'object':options.push([value.id,value[this.labelField]]);break;case 'string':options.push([value,value]);break}}
this.store=new Ext.data.Store({reader:new Ext.data.ArrayReader({id:0},['id',this.labelField]),data:options,listeners:{'load':this.onLoad,scope:this}});this.loaded=!0}else{this.add({text:this.loadingText,iconCls:'loading-indicator'});this.store.on('load',this.onLoad,this)}},destroy:function(){if(this.store){this.store.destroy()}
Ext.ux.menu.ListMenu.superclass.destroy.call(this)},show:function(){var lastArgs=null;return function(){if(arguments.length===0){Ext.ux.menu.ListMenu.superclass.show.apply(this,lastArgs)}else{lastArgs=arguments;if(this.loadOnShow&&!this.loaded){this.store.load()}
Ext.ux.menu.ListMenu.superclass.show.apply(this,arguments)}}}(),onLoad:function(store,records){var visible=this.isVisible();this.hide(!1);this.removeAll(!0);var gid=this.single?Ext.id():null;for(var i=0,len=records.length;i<len;i++){var item=new Ext.menu.CheckItem({text:records[i].get(this.labelField),group:gid,checked:this.selected.indexOf(records[i].id)>-1,hideOnClick:!1});item.itemId=records[i].id;item.on('checkchange',this.checkChange,this);this.add(item)}
this.loaded=!0;if(visible){this.show()}
this.fireEvent('load',this,records)},getSelected:function(){return this.selected},setSelected:function(value){value=this.selected=[].concat(value);if(this.loaded){this.items.each(function(item){item.setChecked(!1,!0);for(var i=0,len=value.length;i<len;i++){if(item.itemId==value[i]){item.setChecked(!0,!0)}}},this)}},checkChange:function(item,checked){var value=[];this.items.each(function(item){if(item.checked){value.push(item.itemId)}},this);this.selected=value;this.fireEvent('checkchange',item,checked)}});Ext.ux.grid.filter.ListFilter=Ext.extend(Ext.ux.grid.filter.Filter,{phpMode:!1,init:function(config){this.dt=new Ext.util.DelayedTask(this.fireUpdate,this);if(this.menu){this.menu.destroy()}
this.menu=new Ext.ux.menu.ListMenu(config);this.menu.on('checkchange',this.onCheckChange,this)},getValue:function(){return this.menu.getSelected()},setValue:function(value){this.menu.setSelected(value);this.fireEvent('update',this)},isActivatable:function(){return this.getValue().length>0},getSerialArgs:function(){var args={type:'list',value:this.phpMode?this.getValue().join(','):this.getValue()};return args},onCheckChange:function(){this.dt.delay(this.updateBuffer)},validateRecord:function(record){return this.getValue().indexOf(record.get(this.dataIndex))>-1}});Ext.namespace('Ext.ux.grid');Ext.ux.grid.GridFilters=Ext.extend(Ext.util.Observable,{autoReload:!0,filterCls:'ux-filtered-column',local:!1,menuFilterText:'Filtro',paramPrefix:'filter',showMenu:!0,stateId:undefined,updateBuffer:800,constructor:function(config){config=config||{};this.deferredUpdate=new Ext.util.DelayedTask(this.reload,this);this.filters=new Ext.util.MixedCollection();this.filters.getKey=function(o){return o?o.dataIndex:null};this.addFilters(config.filters);delete config.filters;Ext.apply(this,config)},init:function(grid){if(grid instanceof Ext.grid.GridPanel){this.grid=grid;this.bindStore(this.grid.getStore(),!0);if(this.filters.getCount()==0){this.addFilters(this.grid.getColumnModel())}
this.grid.filters=this;this.grid.addEvents({'filterupdate':!0});grid.on({scope:this,beforestaterestore:this.applyState,beforestatesave:this.saveState,beforedestroy:this.destroy,reconfigure:this.onReconfigure});if(grid.rendered){this.onRender()}else{grid.on({scope:this,single:!0,render:this.onRender})}}else if(grid instanceof Ext.PagingToolbar){this.toolbar=grid}},applyState:function(grid,state){var key,filter;this.applyingState=!0;this.clearFilters();if(state.filters){for(key in state.filters){filter=this.filters.get(key);if(filter){filter.setValue(state.filters[key]);filter.setActive(!0);}}}
this.deferredUpdate.cancel();if(this.local){this.reload()}
delete this.applyingState;delete state.filters},saveState:function(grid,state){var filters={};this.filters.each(function(filter){if(filter.active){filters[filter.dataIndex]=filter.getValue()}});return(state.filters=filters)},onRender:function(){this.grid.getView().on('refresh',this.onRefresh,this);this.createMenu()},destroy:function(){this.removeAll();this.purgeListeners();if(this.filterMenu){Ext.menu.MenuMgr.unregister(this.filterMenu);this.filterMenu.destroy();this.filterMenu=this.menu.menu=null}},removeAll:function(){if(this.filters){Ext.destroy.apply(Ext,this.filters.items);this.filters.clear()}},bindStore:function(store,initial){if(!initial&&this.store){if(this.local){store.un('load',this.onLoad,this)}else{store.un('beforeload',this.onBeforeLoad,this)}}
if(store){if(this.local){store.on('load',this.onLoad,this)}else{store.on('beforeload',this.onBeforeLoad,this)}}
this.store=store},onReconfigure:function(){this.bindStore(this.grid.getStore());this.store.clearFilter();this.removeAll();this.addFilters(this.grid.getColumnModel());this.updateColumnHeadings()},createMenu:function(){var view=this.grid.getView(),hmenu=view.hmenu;if(this.showMenu&&hmenu){this.sep=hmenu.addSeparator();this.filterMenu=new Ext.menu.Menu({id:this.grid.id+'-filters-menu'});this.menu=hmenu.add({checked:!1,itemId:'filters',text:this.menuFilterText,menu:this.filterMenu});this.menu.on({scope:this,checkchange:this.onCheckChange,beforecheckchange:this.onBeforeCheck});hmenu.on('beforeshow',this.onMenu,this)}
this.updateColumnHeadings()},getMenuFilter:function(){var view=this.grid.getView();if(!view||view.hdCtxIndex===undefined){return null}
if(view.cm.config[view.hdCtxIndex].filter&&view.cm.config[view.hdCtxIndex].filter.dataIndex){return this.filters.get(view.cm.config[view.hdCtxIndex].filter.dataIndex)}else{return this.filters.get(view.cm.config[view.hdCtxIndex].dataIndex)}},onMenu:function(filterMenu){var filter=this.getMenuFilter();if(filter){this.menu.menu=filter.menu;this.menu.setChecked(filter.active,!1);this.menu.setDisabled(filter.disabled===!0)}
this.menu.setVisible(filter!==undefined);this.sep.setVisible(filter!==undefined)},onCheckChange:function(item,value){this.getMenuFilter().setActive(value)},onBeforeCheck:function(check,value){return!value||this.getMenuFilter().isActivatable()},onStateChange:function(event,filter){if(event==='serialize'){return}
if(filter==this.getMenuFilter()){this.menu.setChecked(filter.active,!1)}
if((this.autoReload||this.local)&&!this.applyingState){this.deferredUpdate.delay(this.updateBuffer)}
this.updateColumnHeadings();if(!this.applyingState){this.grid.saveState()}
this.grid.fireEvent('filterupdate',this,filter)},onBeforeLoad:function(store,options){options.params=options.params||{};this.cleanParams(options.params);var params=this.buildQuery(this.getFilterData());Ext.apply(options.params,params)},onLoad:function(store,options){store.filterBy(this.getRecordFilter())},onRefresh:function(){this.updateColumnHeadings()},updateColumnHeadings:function(){var view=this.grid.getView(),i,len,filter;if(view.mainHd){for(i=0,len=view.cm.config.length;i<len;i++){filter=this.getFilter(view.cm.config[i].dataIndex);Ext.fly(view.getHeaderCell(i))[filter&&filter.active?'addClass':'removeClass'](this.filterCls)}}},reload:function(){if(this.local){this.grid.store.clearFilter(!0);this.grid.store.filterBy(this.getRecordFilter())}else{var start,store=this.grid.store;this.deferredUpdate.cancel();if(this.toolbar){start=store.paramNames.start;if(store.lastOptions&&store.lastOptions.params&&store.lastOptions.params[start]){store.lastOptions.params[start]=0}}
store.reload()}},getRecordFilter:function(){var f=[],len,i;this.filters.each(function(filter){if(filter.active){f.push(filter)}});len=f.length;return function(record){for(i=0;i<len;i++){if(!f[i].validateRecord(record)){return!1}}
return!0}},addFilter:function(config){var Cls=this.getFilterClass(config.type),filter=config.menu?config:(new Cls(config));this.filters.add(filter);Ext.util.Observable.capture(filter,this.onStateChange,this);return filter},addFilters:function(filters){if(filters){var i,len,filter,cm=!1,dI;if(filters instanceof Ext.grid.ColumnModel){filters=filters.config;cm=!0}
try{for(i=0,len=filters.length;i<len;i++){filter=!1;if(cm){if(filters[i].filter){dI=filters[i].filter.dataIndex||filters[i].dataIndex}else{dI=filters[i].dataIndex}
filter=filters[i].filter||filters[i].filterable;if(filter){filter=(filter===!0)?{}:filter;Ext.apply(filter,{dataIndex:dI});filter.type=filter.type||this.store.fields.get(dI).type.type}}else{filter=filters[i]}
if(filter){this.addFilter(filter)}}}catch(e){alert(e)}}},getFilter:function(dataIndex){return this.filters.get(dataIndex)},clearFilters:function(){this.filters.each(function(filter){filter.setActive(!1)})},getFilterData:function(){var filters=[],i,len;this.filters.each(function(f){if(f.active){var d=[].concat(f.serialize());for(i=0,len=d.length;i<len;i++){filters.push({field:f.dataIndex,data:d[i]})}}});return filters},buildQuery:function(filters){var p={},i,f,root,dataPrefix,key,tmp,len=filters.length;if(!this.encode){for(i=0;i<len;i++){f=filters[i];root=[this.paramPrefix,'[',i,']'].join('');p[root+'[field]']=f.field;dataPrefix=root+'[data]';for(key in f.data){p[[dataPrefix,'[',key,']'].join('')]=f.data[key]}}}else{tmp=[];for(i=0;i<len;i++){f=filters[i];tmp.push(Ext.apply({},{field:f.field},f.data))}
if(tmp.length>0){p[this.paramPrefix]=Ext.util.JSON.encode(tmp)}}
return p},cleanParams:function(p){if(this.encode){delete p[this.paramPrefix]}else{var regex,key;regex=new RegExp('^'+this.paramPrefix+'\[[0-9]+\]');for(key in p){if(regex.test(key)){delete p[key]}}}},getFilterClass:function(type){switch(type){case 'auto':type='string';break;case 'int':case 'float':type='numeric';break;case 'bool':type='boolean';break}
return Ext.ux.grid.filter[type.substr(0,1).toUpperCase()+type.substr(1)+'Filter']}});Ext.preg('gridfilters',Ext.ux.grid.GridFilters);Ext.ux.grid.filter.DateFilter=Ext.extend(Ext.ux.grid.filter.Filter,{afterText:'Despues',beforeText:'Antes',compareMap:{before:'lt',after:'gt',on:'eq'},dateFormat:'Y/m/d',menuItems:['before','after','-','on'],menuItemCfgs:{selectOnFocus:!0,width:125},onText:'El',pickerOpts:{},init:function(config){var menuCfg,i,len,item,cfg,Cls;menuCfg=Ext.apply(this.pickerOpts,{minDate:this.minDate,maxDate:this.maxDate,format:this.dateFormat,listeners:{scope:this,select:this.onMenuSelect}});this.fields={};for(i=0,len=this.menuItems.length;i<len;i++){item=this.menuItems[i];if(item!=='-'){cfg={itemId:'range-'+item,text:this[item+'Text'],menu:new Ext.menu.DateMenu(Ext.apply(menuCfg,{itemId:item})),listeners:{scope:this,checkchange:this.onCheckChange}};Cls=Ext.menu.CheckItem;item=this.fields[item]=new Cls(cfg)}
this.menu.add(item)}},onCheckChange:function(){this.setActive(this.isActivatable());this.fireEvent('update',this)},onInputKeyUp:function(field,e){var k=e.getKey();if(k==e.RETURN&&field.isValid()){e.stopEvent();this.menu.hide(!0);return}},onMenuSelect:function(menuItem,value,picker){var fields=this.fields,field=this.fields[menuItem.itemId];field.setChecked(!0);if(field==fields.on){fields.before.setChecked(!1,!0);fields.after.setChecked(!1,!0)}else{fields.on.setChecked(!1,!0);if(field==fields.after&&fields.before.menu.picker.value<value){fields.before.setChecked(!1,!0)}else if(field==fields.before&&fields.after.menu.picker.value>value){fields.after.setChecked(!1,!0)}}
this.fireEvent('update',this)},getValue:function(){var key,result={};for(key in this.fields){if(this.fields[key].checked){result[key]=this.fields[key].menu.picker.getValue()}}
return result},setValue:function(value,preserve){var key;for(key in this.fields){if(value[key]){this.fields[key].menu.picker.setValue(value[key]);this.fields[key].setChecked(!0)}else if(!preserve){this.fields[key].setChecked(!1)}}
this.fireEvent('update',this)},isActivatable:function(){var key;for(key in this.fields){if(this.fields[key].checked){return!0}}
return!1},getSerialArgs:function(){var args=[];for(var key in this.fields){if(this.fields[key].checked){args.push({type:'date',comparison:this.compareMap[key],value:this.getFieldValue(key).format(this.dateFormat)})}}
return args},getFieldValue:function(item){return this.fields[item].menu.picker.getValue()},getPicker:function(item){return this.fields[item].menu.picker},validateRecord:function(record){var key,pickerValue,val=record.get(this.dataIndex);if(!Ext.isDate(val)){return!1}
val=val.clearTime(!0).getTime();for(key in this.fields){if(this.fields[key].checked){pickerValue=this.getFieldValue(key).clearTime(!0).getTime();if(key=='before'&&pickerValue<=val){return!1}
if(key=='after'&&pickerValue>=val){return!1}
if(key=='on'&&pickerValue!=val){return!1}}}
return!0}});Ext.ux.grid.filter.BooleanFilter=Ext.extend(Ext.ux.grid.filter.Filter,{defaultValue:!1,yesText:'Si',noText:'No',init:function(config){var gId=Ext.id();this.options=[new Ext.menu.CheckItem({text:this.yesText,group:gId,checked:this.defaultValue===!0}),new Ext.menu.CheckItem({text:this.noText,group:gId,checked:this.defaultValue===!1})];this.menu.add(this.options[0],this.options[1]);for(var i=0;i<this.options.length;i++){this.options[i].on('click',this.fireUpdate,this);this.options[i].on('checkchange',this.fireUpdate,this)}},getValue:function(){return this.options[0].checked},setValue:function(value){this.options[value?0:1].setChecked(!0)},getSerialArgs:function(){var args={type:'boolean',value:this.getValue()};return args},validateRecord:function(record){return record.get(this.dataIndex)==this.getValue()}});Ext.ns('Ext.ux.grid');Ext.ux.grid.RowEditor=Ext.extend(Ext.Panel,{floating:!0,shadow:!1,layout:'hbox',cls:'x-small-editor',buttonAlign:'center',baseCls:'x-row-editor',elements:'header,footer,body',frameWidth:5,buttonPad:3,clicksToEdit:2,monitorValid:!0,focusDelay:250,errorSummary:!0,saveText:'Save',cancelText:'Cancel',commitChangesText:'You need to commit or cancel your changes',errorText:'Errors',defaults:{normalWidth:!0},initComponent:function(){Ext.ux.grid.RowEditor.superclass.initComponent.call(this);this.addEvents('beforeedit','canceledit','validateedit','afteredit')},init:function(grid){this.grid=grid;this.ownerCt=grid;if(this.clicksToEdit===2){grid.on('rowdblclick',this.onRowDblClick,this)}else{grid.on('rowclick',this.onRowClick,this);if(Ext.isIE){grid.on('rowdblclick',this.onRowDblClick,this)}}
grid.getStore().on('remove',function(){this.stopEditing(!1)},this);grid.on({scope:this,keydown:this.onGridKey,columnresize:this.verifyLayout,columnmove:this.refreshFields,reconfigure:this.refreshFields,beforedestroy:this.beforedestroy,destroy:this.destroy,bodyscroll:{buffer:250,fn:this.positionButtons}});grid.getColumnModel().on('hiddenchange',this.verifyLayout,this,{delay:1});grid.getView().on('refresh',this.stopEditing.createDelegate(this,[]))},beforedestroy:function(){this.stopMonitoring();this.grid.getStore().un('remove',this.onStoreRemove,this);this.stopEditing(!1);Ext.destroy(this.btns,this.tooltip)},refreshFields:function(){this.initFields();this.verifyLayout()},isDirty:function(){var dirty;this.items.each(function(f){if(String(this.values[f.id])!==String(f.getValue())){dirty=!0;return!1}},this);return dirty},startEditing:function(rowIndex,doFocus){if(this.editing&&this.isDirty()){this.showTooltip(this.commitChangesText);return}
if(Ext.isObject(rowIndex)){rowIndex=this.grid.getStore().indexOf(rowIndex)}
if(this.fireEvent('beforeedit',this,rowIndex)!==!1){this.editing=!0;var g=this.grid,view=g.getView(),row=view.getRow(rowIndex),record=g.store.getAt(rowIndex);this.record=record;this.rowIndex=rowIndex;this.values={};if(!this.rendered){this.render(view.getEditorParent())}
var w=Ext.fly(row).getWidth();this.setSize(w);if(!this.initialized){this.initFields()}
var cm=g.getColumnModel(),fields=this.items.items,f,val;for(var i=0,len=cm.getColumnCount();i<len;i++){val=this.preEditValue(record,cm,i);f=fields[i];f.setValue(val);this.values[f.id]=Ext.isEmpty(val)?'':val}
this.verifyLayout(!0);if(!this.isVisible()){this.setPagePosition(Ext.fly(row).getXY())}else{this.el.setXY(Ext.fly(row).getXY(),{duration:0.15})}
if(!this.isVisible()){this.show().doLayout()}
if(doFocus!==!1){this.doFocus.defer(this.focusDelay,this)}}},stopEditing:function(saveChanges){this.editing=!1;if(!this.isVisible()){return}
if(saveChanges===!1||!this.isValid()){this.hide();this.fireEvent('canceledit',this,saveChanges===!1);return}
var changes={},r=this.record,hasChange=!1,cm=this.grid.colModel,fields=this.items.items;for(var i=0,len=cm.getColumnCount();i<len;i++){if(!cm.isHidden(i)&&!(fields[i]instanceof Ext.form.DisplayField)){var dindex=cm.getDataIndex(i);if(!Ext.isEmpty(dindex)){var oldValue=r.data[dindex],value=this.postEditValue(fields[i].getValue(),oldValue,r,dindex);if(String(oldValue)!==String(value)){changes[dindex]=value;hasChange=!0}}}}
if(hasChange&&this.fireEvent('validateedit',this,changes,r,this.rowIndex)!==!1){r.beginEdit();Ext.iterate(changes,function(name,value){r.set(name,value)});r.endEdit();this.fireEvent('afteredit',this,changes,r,this.rowIndex)}
this.hide()},verifyLayout:function(force){if(this.el&&(this.isVisible()||force===!0)){var row=this.grid.getView().getRow(this.rowIndex);this.setSize(Ext.fly(row).getWidth(),Ext.isIE?Ext.fly(row).getHeight()+9:undefined);var cm=this.grid.colModel,fields=this.items.items;for(var i=0,len=cm.getColumnCount();i<len;i++){if(!cm.isHidden(i)){var adjust=0;if(i===(len-1)){adjust+=3}else{adjust+=1}
fields[i].show();fields[i].setWidth(cm.getColumnWidth(i)-adjust);fields[i].width=cm.getColumnWidth(i)-adjust}else{fields[i].hide()}}
this.doLayout();this.positionButtons()}},slideHide:function(){this.hide()},initFields:function(){var cm=this.grid.getColumnModel(),pm=Ext.layout.ContainerLayout.prototype.parseMargins;this.removeAll(!1);for(var i=0,len=cm.getColumnCount();i<len;i++){var c=cm.getColumnAt(i),ed=c.getEditor();if(!ed){ed=c.displayEditor||new Ext.form.DisplayField()}
if(i==0){ed.margins=pm('0 1 2 1')}else if(i==len-1){ed.margins=pm('0 0 2 1')}else{if(Ext.isIE){ed.margins=pm('0 0 2 0')}
else{ed.margins=pm('0 1 2 0')}}
ed.setWidth(cm.getColumnWidth(i));ed.column=c;if(ed.ownerCt!==this){ed.on('focus',this.ensureVisible,this);ed.on('specialkey',this.onKey,this)}
this.insert(i,ed)}
this.initialized=!0},onKey:function(f,e){if(e.getKey()===e.ENTER){this.stopEditing(!0);e.stopPropagation()}},onGridKey:function(e){if(e.getKey()===e.ENTER&&!this.isVisible()){var r=this.grid.getSelectionModel().getSelected();if(r){var index=this.grid.store.indexOf(r);this.startEditing(index);e.stopPropagation()}}},ensureVisible:function(editor){if(this.isVisible()){this.grid.getView().ensureVisible(this.rowIndex,this.grid.colModel.getIndexById(editor.column.id),!0)}},onRowClick:function(g,rowIndex,e){if(this.clicksToEdit=='auto'){var li=this.lastClickIndex;this.lastClickIndex=rowIndex;if(li!=rowIndex&&!this.isVisible()){return}}
this.startEditing(rowIndex,!1);this.doFocus.defer(this.focusDelay,this,[e.getPoint()])},onRowDblClick:function(g,rowIndex,e){this.startEditing(rowIndex,!1);this.doFocus.defer(this.focusDelay,this,[e.getPoint()])},onRender:function(){Ext.ux.grid.RowEditor.superclass.onRender.apply(this,arguments);this.el.swallowEvent(['keydown','keyup','keypress']);this.btns=new Ext.Panel({baseCls:'x-plain',cls:'x-btns',elements:'body',layout:'table',width:(this.minButtonWidth*2)+(this.frameWidth*2)+(this.buttonPad*4),items:[{ref:'saveBtn',itemId:'saveBtn',xtype:'button',text:this.saveText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[!0])},{xtype:'button',text:this.cancelText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[!1])}]});this.btns.render(this.bwrap)},afterRender:function(){Ext.ux.grid.RowEditor.superclass.afterRender.apply(this,arguments);this.positionButtons();if(this.monitorValid){this.startMonitoring()}},onShow:function(){if(this.monitorValid){this.startMonitoring()}
Ext.ux.grid.RowEditor.superclass.onShow.apply(this,arguments)},onHide:function(){Ext.ux.grid.RowEditor.superclass.onHide.apply(this,arguments);this.stopMonitoring();this.grid.getView().focusRow(this.rowIndex)},positionButtons:function(){if(this.btns){var g=this.grid,h=this.el.dom.clientHeight,view=g.getView(),scroll=view.scroller.dom.scrollLeft,bw=this.btns.getWidth(),width=Math.min(g.getWidth(),g.getColumnModel().getTotalWidth());this.btns.el.shift({left:(width/2)-(bw/2)+scroll,top:h-2,stopFx:!0,duration:0.2})}},isDate:function(o){return typeof o.getMonth==='function'},preEditValue:function(r,cm,i){field=cm.getDataIndex(i);c=cm.getColumnAt(i),ed=c.getEditor();var value;if(!ed){if(c.renderer){if(r.data[field+'_cdisplay']){value=r.data[field+'_cdisplay']}else{if(r.data[field]){value=c.renderer(r.data[field],null,r)}else{value=''}}}else{value=r.data[field]}}else{value=r.data[field]}
return this.autoEncode&&typeof value==='string'?Ext.util.Format.htmlDecode(value):value},postEditValue:function(value,originalValue,r,field){if(value instanceof Date)value=value.format("Y-m-d");return this.autoEncode&&typeof value=='string'?Ext.util.Format.htmlEncode(value):value},doFocus:function(pt){if(this.isVisible()){var index=0,cm=this.grid.getColumnModel(),c;if(pt){index=this.getTargetColumnIndex(pt)}
for(var i=index||0,len=cm.getColumnCount();i<len;i++){c=cm.getColumnAt(i);if(!c.hidden&&c.getEditor()){c.getEditor().focus();break}}}},getTargetColumnIndex:function(pt){var grid=this.grid,v=grid.view,x=pt.left,cms=grid.colModel.config,i=0,match=!1;for(var len=cms.length,c;c=cms[i];i++){if(!c.hidden){if(Ext.fly(v.getHeaderCell(i)).getRegion().right>=x){match=i;break}}}
return match},startMonitoring:function(){if(!this.bound&&this.monitorValid){this.bound=!0;Ext.TaskMgr.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this})}},stopMonitoring:function(){this.bound=!1;if(this.tooltip){this.tooltip.hide()}},isValid:function(){var valid=!0;this.items.each(function(f){if(!f.isValid(!0)){valid=!1;return!1}});return valid},bindHandler:function(){if(!this.bound){return!1}
var valid=this.isValid();if(!valid&&this.errorSummary){this.showTooltip(this.getErrorText().join(''))}
this.btns.saveBtn.setDisabled(!valid);this.fireEvent('validation',this,valid)},lastVisibleColumn:function(){var i=this.items.getCount()-1,c;for(;i>=0;i--){c=this.items.items[i];if(!c.hidden){return c}}},showTooltip:function(msg){var t=this.tooltip;if(!t){t=this.tooltip=new Ext.ToolTip({maxWidth:600,cls:'errorTip',width:300,title:this.errorText,autoHide:!1,anchor:'left',anchorToTarget:!0,mouseOffset:[40,0]})}
var v=this.grid.getView(),top=parseInt(this.el.dom.style.top,10),scroll=v.scroller.dom.scrollTop,h=this.el.getHeight();if(top+h>=scroll){t.initTarget(this.lastVisibleColumn().getEl());if(!t.rendered){t.show();t.hide()}
t.body.update(msg);t.doAutoWidth(20);t.show()}else if(t.rendered){t.hide()}},getErrorText:function(){var data=['<ul>'];this.items.each(function(f){if(!f.isValid(!0)){data.push('<li>',f.getActiveError(),'</li>')}});data.push('</ul>');return data}});Ext.preg('roweditor',Ext.ux.grid.RowEditor);Ext.namespace('Ext.ux.menu');Ext.ux.menu.TreeMenu=function(cfg){Ext.ux.menu.TreeMenu.superclass.constructor.call(this,{plain:!1,items:[new Ext.ux.menu.TreeMenuItem(cfg)],cls:'ux-tree-menu'});this.relayEvents(this.items.get(0),["select","search"]);this.tree=cfg.tree};Ext.extend(Ext.ux.menu.TreeMenu,Ext.menu.Menu);Ext.ux.menu.TreeMenuItem=function(cfg){this.addEvents({select:!0,search:!0});Ext.ux.menu.TreeMenu.superclass.constructor.call(this,cfg);this.qTask=new Ext.util.DelayedTask(this.doQuery,this);this.searchBox=new Ext.form.TextField({cls:'ux-tree-menu-search',emptyText:this.emptyText});this.tree.getSelectionModel().on('selectionchange',this.onSelect,this)};Ext.extend(Ext.ux.menu.TreeMenuItem,Ext.menu.BaseItem,{minHeight:240,minWidth:200,hideOnClick:!1,searchDelay:500,tree:undefined,searchFn:undefined,emptyText:'Search...',handelOffset:3,onRender:function(container){var el=this.el=container.createChild({cls:'ux-tree-menu-wrap',children:[{cls:'ux-tree-menu-search-icon'}]});if(this.searchFn){this.searchBox.render(el);this.searchBox.getEl().setStyle('margin-bottom','3px');this.searchBox.el.on('keyup',function(){this.qTask.delay(this.searchDelay)},this)}
this.tree.autoScroll=!0;this.tree.render(el);var resizer=new Ext.Resizable(el,{pinned:!0,handles:'se',listeners:{'resize':function(rsz,w,h){this.resize(w,h);this.parentMenu.autoWidth();this.parentMenu.el.show()},scope:this}});this.resize(this.minWidth,this.minHeight);if(this.searchFn)
this.doQuery()},onSelect:function(model,node){this.fireEvent('select',node.id,node)},doQuery:function(callback){var value=this.searchBox.getValue();this.searchFn(value.length>0?value:null,callback);this.fireEvent('search',value)},resize:function(w,h){var search=this.searchBox.getEl();padding=this.el.getFrameWidth('tb'),searchOff=0;if(search){search.setWidth(w-this.el.getFrameWidth('lr'));searchOff=search.getHeight()}
this.tree.setWidth(w);this.tree.setHeight(h-searchOff-padding-this.handelOffset)}});Ext.namespace("Ext.ux.menu");Ext.ux.menu.RangeMenu=function(){Ext.ux.menu.RangeMenu.superclass.constructor.apply(this,arguments);this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this);var cfg=this.fieldCfg;var cls=this.fieldCls;var fields=this.fields=Ext.applyIf(this.fields||{},{'gt':new Ext.ux.menu.EditableItem({iconCls:this.icons.gt,editor:new cls(typeof cfg=="object"?cfg.gt||'':cfg)}),'lt':new Ext.ux.menu.EditableItem({iconCls:this.icons.lt,editor:new cls(typeof cfg=="object"?cfg.lt||'':cfg)}),'eq':new Ext.ux.menu.EditableItem({iconCls:this.icons.eq,editor:new cls(typeof cfg=="object"?cfg.gt||'':cfg)})});this.add(fields.gt,fields.lt,'-',fields.eq);for(var key in fields)
fields[key].on('keyup',function(event,input,notSure,field){if(event.getKey()==event.ENTER&&field.isValid()){this.hide(!0);return}
if(field==fields.eq){fields.gt.setValue(null);fields.lt.setValue(null)}else{fields.eq.setValue(null)}
this.updateTask.delay(this.updateBuffer)}.createDelegate(this,[fields[key]],!0));this.addEvents({'update':!0})};Ext.extend(Ext.ux.menu.RangeMenu,Ext.menu.Menu,{fieldCls:Ext.form.NumberField,fieldCfg:'',updateBuffer:500,icons:{gt:'ux-rangemenu-gt',lt:'ux-rangemenu-lt',eq:'ux-rangemenu-eq'},fireUpdate:function(){this.fireEvent("update",this)},setValue:function(data){for(var key in this.fields)
this.fields[key].setValue(data[key]!==undefined?data[key]:'');this.fireEvent("update",this)},getValue:function(){var result={};for(var key in this.fields){var field=this.fields[key];if(field.isValid()&&String(field.getValue()).length>0)
result[key]=field.getValue()}
return result}});RadTemplates={};RadTemplates.articulo=new Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item">','<h4>{Codigo}: {Descripcion}</h4>','Marca: <i>{Marca_cdisplay}</i>&nbsp;&nbsp; - &nbsp; <i>{IVA_cdisplay}</i>','</div>','</tpl>');RadTemplates.articuloVersion=new Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item x-combo-detalle">','<h4><span class="x-combo-span-right">{ArticulosCodigo}</span>{Articulo_cdisplay}</h4>','{Descripcion}','</div>','</tpl>');RadTemplates.articuloAlmacenes=new Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item">','<h4>{Codigo}: {Descripcion}</h4>','Marca: <i>{Marca_cdisplay}</i>','<tpl if="EsParaCompra = 1">&nbsp;&nbsp;- <i>Se Compra</i></tpl>','<tpl if="EsParaVenta = 1">&nbsp;&nbsp;- <i>Se Vende</i></tpl>','<tpl if="EsInsumo = 1">&nbsp;&nbsp;- <i>Es Insumo</i></tpl>','<tpl if="EsProducido = 1">&nbsp;&nbsp;- <i>Es Producido</i></tpl>','</div>','</tpl>');RadTemplates.chequeras=new Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item">','<h4>Serie {Serie} / Chequera {NumeroDeChequera}</h4>','<div>{TipoDeCuenta} {CuentaBancaria_cdisplay}</div>','<div>{BancosSucursalesDescripcion}</div>','</div>','</tpl>');RadTemplates.cuentaBancaria=new Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item">','<div>{TipoDeCuenta_cdisplay} : {BancoSucursal_cdisplay} : {Numero}</div>','</div>','</tpl>');Ext.ns('Ext.ux.form');Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:'Browse...',buttonOnly:!1,buttonOffset:3,readOnly:!0,autoSize:Ext.emptyFn,initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents('fileselected')},onRender:function(ct,position){Ext.ux.form.FileUploadField.superclass.onRender.call(this,ct,position);this.wrap=this.el.wrap({cls:'x-form-field-wrap x-form-file-wrap'});this.el.addClass('x-form-file-text');this.el.dom.removeAttribute('name');this.createFileInput();var btnCfg=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(btnCfg,{renderTo:this.wrap,cls:'x-form-file-btn'+(btnCfg.iconCls?' x-btn-icon':'')}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}
this.bindListeners();this.resizeEl=this.positionEl=this.wrap},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass(['x-btn-over','x-btn-focus'])},mouseleave:function(){this.button.removeClass(['x-btn-over','x-btn-focus','x-btn-click'])},mousedown:function(){this.button.addClass('x-btn-click')},mouseup:function(){this.button.removeClass(['x-btn-over','x-btn-focus','x-btn-click'])},change:function(){var v=this.fileInput.dom.value;this.setValue(v);this.fireEvent('fileselected',this,v)}})},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:'x-form-file',tag:'input',type:'file',size:1})},reset:function(){if(this.rendered){this.fileInput.remove();this.createFileInput();this.bindListeners()}
Ext.ux.form.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+'-file'},onResize:function(w,h){Ext.ux.form.FileUploadField.superclass.onResize.call(this,w,h);this.wrap.setWidth(w);if(!this.buttonOnly){var w=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(w)}},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap)},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(!0)},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(!1)},doDisable:function(disabled){this.fileInput.dom.disabled=disabled;this.button.setDisabled(disabled)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,'tl-tr',[2,0])}});Ext.reg('fileuploadfield',Ext.ux.form.FileUploadField);Ext.form.FileUploadField=Ext.ux.form.FileUploadField;Ext.namespace("Ext.ux.menu");Ext.ux.menu.ListMenu=function(cfg){this.addEvents('checkchanged');Ext.ux.menu.ListMenu.superclass.constructor.call(this,cfg=cfg||{});if(!cfg.store&&cfg.options){var options=[];for(var i=0,len=cfg.options.length;i<len;i++){var value=cfg.options[i];switch(Ext.type(value)){case 'array':options.push(value);break;case 'object':options.push([value.id,value[this.labelField]]);break;case 'string':options.push([value,value]);break}}
this.store=new Ext.data.Store({reader:new Ext.data.ArrayReader({id:0},['id',this.labelField]),data:options,listeners:{'load':this.onLoad,scope:this}});this.loaded=!0}else{this.add({text:this.loadingText,iconCls:'loading-indicator'});this.store.on('load',this.onLoad,this)}};Ext.extend(Ext.ux.menu.ListMenu,Ext.menu.Menu,{labelField:'text',loadingText:'Loading...',loadOnShow:!0,single:!1,selected:[],show:function(){var lastArgs=null;return function(){if(arguments.length==0){Ext.ux.menu.ListMenu.superclass.show.apply(this,lastArgs)}else{lastArgs=arguments;if(this.loadOnShow&&!this.loaded)this.store.load();Ext.ux.menu.ListMenu.superclass.show.apply(this,arguments)}}}(),onLoad:function(store,records){var visible=this.isVisible();this.hide(!1);this.removeAll();var gid=this.single?Ext.id():null;for(var i=0,len=records.length;i<len;i++){var item=new Ext.menu.CheckItem({text:records[i].get(this.labelField),group:gid,checked:this.selected.indexOf(records[i].id)>-1,hideOnClick:!1});item.itemId=records[i].id;item.on('checkchange',this.checkChange,this);this.add(item)}
this.loaded=!0;if(visible)
this.show();this.fireEvent('load',this,records)},setSelected:function(value){var value=this.selected=[].concat(value);if(this.loaded)
this.items.each(function(item){item.setChecked(!1,!0);for(var i=0,len=value.length;i<len;i++)
if(item.itemId==value[i])
item.setChecked(!0,!0);},this)},checkChange:function(item,checked){var value=[];this.items.each(function(item){if(item.checked)
value.push(item.itemId)},this);this.selected=value;this.fireEvent("checkchange",item,checked)},getSelected:function(){return this.selected}});Ext.ns('Ext.ux.grid');Ext.ux.grid.GroupSummary=Ext.extend(Ext.util.Observable,{constructor:function(config){Ext.apply(this,config);Ext.ux.grid.GroupSummary.superclass.constructor.call(this)},init:function(grid){this.grid=grid;var v=this.view=grid.getView();v.doGroupEnd=this.doGroupEnd.createDelegate(this);v.afterMethod('onColumnWidthUpdated',this.doWidth,this);v.afterMethod('onAllColumnWidthsUpdated',this.doAllWidths,this);v.afterMethod('onColumnHiddenUpdated',this.doHidden,this);v.afterMethod('onUpdate',this.doUpdate,this);v.afterMethod('onRemove',this.doRemove,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<tbody><tr>{cells}</tr></tbody>','</table></div>');this.rowTpl.disableFormats=!0}
this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=!0}
this.cellTpl.compile()},toggleSummaries:function(visible){var el=this.grid.getGridEl();if(el){if(visible===undefined){visible=el.hasClass('x-grid-hide-summary')}
el[visible?'removeClass':'addClass']('x-grid-hide-summary')}},renderSummary:function(o,cs){cs=cs||this.view.getColumnData();var cfg=this.grid.getColumnModel().config,buf=[],c,p={},cf,last=cs.length-1;for(var i=0,len=cs.length;i<len;i++){c=cs[i];cf=cfg[i];p.id=c.id;p.style=c.style;p.css=i==0?'x-grid3-cell-first ':(i==last?'x-grid3-cell-last ':'');if(cf.summaryType||cf.summaryRenderer){p.value=(cf.summaryRenderer||c.renderer)(o.data[c.name],p,o)}else{p.value=''}
if(p.value==undefined||p.value==="")p.value="&#160;";buf[buf.length]=this.cellTpl.apply(p)}
return this.rowTpl.apply({tstyle:'width:'+this.view.getTotalWidth()+';',cells:buf.join('')})},calculate:function(rs,cs){var data={},r,c,cfg=this.grid.getColumnModel().config,cf;for(var j=0,jlen=rs.length;j<jlen;j++){r=rs[j];for(var i=0,len=cs.length;i<len;i++){c=cs[i];cf=cfg[i];if(cf.summaryType){data[c.name]=Ext.ux.grid.GroupSummary.Calculations[cf.summaryType](data[c.name]||0,r,c.name,data)}}}
return data},doGroupEnd:function(buf,g,cs,ds,colCount){var data=this.calculate(g.rs,cs);buf.push('</div>',this.renderSummary({data:data},cs),'</div>')},doWidth:function(col,w,tw){if(!this.isGrouped()){return}
var gs=this.view.getGroups(),len=gs.length,i=0,s;for(;i<len;++i){s=gs[i].childNodes[2];s.style.width=tw;s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.width=w}},doAllWidths:function(ws,tw){if(!this.isGrouped()){return}
var gs=this.view.getGroups(),len=gs.length,i=0,j,s,cells,wlen=ws.length;for(;i<len;i++){s=gs[i].childNodes[2];s.style.width=tw;s.firstChild.style.width=tw;cells=s.firstChild.rows[0].childNodes;for(j=0;j<wlen;j++){cells[j].style.width=ws[j]}}},doHidden:function(col,hidden,tw){if(!this.isGrouped()){return}
var gs=this.view.getGroups(),len=gs.length,i=0,s,display=hidden?'none':'';for(;i<len;i++){s=gs[i].childNodes[2];s.style.width=tw;s.firstChild.style.width=tw;s.firstChild.rows[0].childNodes[col].style.display=display}},isGrouped:function(){return!Ext.isEmpty(this.grid.getStore().groupField)},refreshSummary:function(groupValue){return this.refreshSummaryById(this.view.getGroupId(groupValue))},getSummaryNode:function(gid){var g=Ext.fly(gid,'_gsummary');if(g){return g.down('.x-grid3-summary-row',!0)}
return null},refreshSummaryById:function(gid){var g=Ext.getDom(gid);if(!g){return!1}
var rs=[];this.grid.getStore().each(function(r){if(r._groupId==gid){rs[rs.length]=r}});var cs=this.view.getColumnData(),data=this.calculate(rs,cs),markup=this.renderSummary({data:data},cs),existing=this.getSummaryNode(gid);if(existing){g.removeChild(existing)}
Ext.DomHelper.append(g,markup);return!0},doUpdate:function(ds,record){this.refreshSummaryById(record._groupId)},doRemove:function(ds,record,index,isUpdate){if(!isUpdate){this.refreshSummaryById(record._groupId)}},showSummaryMsg:function(groupValue,msg){var gid=this.view.getGroupId(groupValue),node=this.getSummaryNode(gid);if(node){node.innerHTML='<div class="x-grid3-summary-msg">'+msg+'</div>'}}});Ext.grid.GroupSummary=Ext.ux.grid.GroupSummary;Ext.ux.grid.GroupSummary.Calculations={'checkedsum':function(v,record,colName,data,rowIdx,grid){if(record.data.checked){return data[colName]+Ext.num(v,0)}else{return data[colName]}},'selectedsum':function(v,record,colName,data,rowIdx,grid){if(record.data.checked){return data[colName]+Ext.num(v,0)}else{return data[colName]}},'sum':function(v,record,field){return v+(record.data[field]||0)},'count':function(v,record,field,data){return data[field+'count']?++data[field+'count']:(data[field+'count']=1)},'max':function(v,record,field,data){var v=record.data[field];var max=data[field+'max']===undefined?(data[field+'max']=v):data[field+'max'];return v>max?(data[field+'max']=v):max},'min':function(v,record,field,data){var v=record.data[field];var min=data[field+'min']===undefined?(data[field+'min']=v):data[field+'min'];return v<min?(data[field+'min']=v):min},'average':function(v,record,field,data){var c=data[field+'count']?++data[field+'count']:(data[field+'count']=1);var t=(data[field+'total']=((data[field+'total']||0)+(record.data[field]||0)));return t===0?0:t/c}};Ext.grid.GroupSummary.Calculations=Ext.ux.grid.GroupSummary.Calculations;Ext.ux.grid.HybridSummary=Ext.extend(Ext.ux.grid.GroupSummary,{calculate:function(rs,cs){var gcol=this.view.getGroupField(),gvalue=rs[0].data[gcol],gdata=this.getSummaryData(gvalue);return gdata||Ext.ux.grid.HybridSummary.superclass.calculate.call(this,rs,cs)},updateSummaryData:function(groupValue,data,skipRefresh){var json=this.grid.getStore().reader.jsonData;if(!json.summaryData){json.summaryData={}}
json.summaryData[groupValue]=data;if(!skipRefresh){this.refreshSummary(groupValue)}},getSummaryData:function(groupValue){var reader=this.grid.getStore().reader,json=reader.jsonData,fields=reader.recordType.prototype.fields,v;if(json&&json.summaryData){v=json.summaryData[groupValue];if(v){return reader.extractValues(v,fields.items,fields.length)}}
return null}});Ext.grid.HybridSummary=Ext.ux.grid.HybridSummary;Ext.ns('Rad');Rad.TreePanel=Ext.extend(Ext.tree.TreePanel,{model:null,module:null,ref:null,parent:null,display:null,tpl:null,autoLoadPath:null,animate:!1,autoScroll:!0,useArrows:!1,enableDD:!1,containerScroll:!0,border:!1,rootVisible:!1,initComponent:function(){if(Ext.isString(this.tpl))
this.tpl=new Ext.Template(this.tpl);else if(this.tpl==null)
this.tpl='{'+this.display+'}';this.buildToolbar();this.buildBottombar();this.buildLoader();Rad.TreePanel.superclass.initComponent.call(this)},root:{draggable:!1,editable:!1,id:'root'},buildToolbar:function(){this.tbar=[{text:'Agregar...',iconCls:'add',menu:new Ext.menu.Menu({items:[{text:'En este nivel',scope:this,iconCls:'add_down',handler:function(){var selectedNode=this.getSelectionModel().getSelectedNode();if(selectedNode){this.addRow(selectedNode.parentNode)}else{Ext.Msg.alert('Atencion','Debe seleccionar un registro')}}},{text:'Dentro',scope:this,iconCls:'add_down_merge',handler:function(){var selectedNode=this.getSelectionModel().getSelectedNode();if(selectedNode){selectedNode.expand(!1,!1,this.addRow,this)}else{Ext.Msg.alert('Atencion','Debe seleccionar un registro')}}}]})},{text:'Editar',scope:this,iconCls:'edit',handler:this.abmWindowShow},'-',{text:'Borrar',scope:this,iconCls:'remove',handler:this.deleteRows}]},buildBottombar:function(){this.bbar=[{text:'Recargar',iconCls:'x-tbar-loading',handler:function(){this.getRootNode().reload()},scope:this},'-',{text:'Expandir todo',icon:'../images/arrow_branch_down.png',handler:function(){this.asyncExpandCollapse(!0)},scope:this},{text:'Contraer todo',icon:'../images/arrow_merge.png',handler:function(){this.asyncExpandCollapse(!1)},scope:this}]},buildLoader:function(){this.loader=new Rad.TreeLoader({dataUrl:'/default/treedatagateway/list/model/'+this.model+'/m/'+this.module,nodeParameter:'filter',baseParams:{ref:this.ref}})},abmWindowShow:function(){var selectedNode=this.getSelectionModel().getSelectedNode();var selected=(selectedNode)?new Ext.data.Record(selectedNode.attributes.data):undefined;if(selected!=undefined){if(this.abmWindow==null){this.abmWindow=app.desktop.createWindow(this.getAbmWindowConfig(),Rad.ABMWindowTree)}
this.disable();this.abmWindow.show();var form=this.abmWindow.getForm();if(form){form.loadRecord(selected)}else{Ext.MessageBox.alert('Atencion','No se encontro el formulario para cargar los datos')}}else{Ext.MessageBox.alert('Atencion','Seleccione un registro a editar')}},getAbmWindowConfig:function(){var config={layout:'fit',width:this.abmWindowWidth,height:this.abmWindowHeight,title:this.abmWindowTitle,plain:!0,modal:!1,bodyStyle:'padding:0px;margin:0px;',border:!1,constrain:!0,items:this.abmForm,id:this.id+'_formwindow',grid:this}
Ext.apply(config,this.abmWindowConfig);return config},dropConfig:{appendOnly:!0},addRow:function(parent){var newNode=new Rad.AsyncTreeNode({leaf:!0,data:{}});newNode.attributes.data[this.parent]=(parent.isRoot)?null:(parent.attributes.data.Id);parent.appendChild(newNode);newNode.select();this.abmWindowShow()},deleteRows:function(){records=this.getSelectionModel().getSelectedNode();if(records){Ext.Msg.confirm('Borrar','&iquest;Est&aacute; seguro que desea borrar el registro y sus hijos?',function(response){if(response=='yes'){Rad.callRemoteJsonAction({url:'/default/treedatagateway/deleterow/model/'+this.model+'/m/'+this.module,params:{rows:records.attributes.data.Id,ref:this.ref},success:function(response){if(response.success==!0){records.remove()}},scope:this})}},this)}},asyncExpandCollapse:function(expand){this.getRootNode().cascade(function(node){if(expand)
node.expand(!0);else node.collapse()})}});Rad.TreePanel.nodeTypes={};Rad.TreeNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{renderElements:function(){n.text=this.ownerTree.tpl.apply(n.attributes.data);Rad.TreeNodeUI.superclass.renderElements.call(this,arguments)}});Rad.AsyncTreeNode=Ext.extend(Ext.tree.AsyncTreeNode,{uiProvider:Rad.TreeNodeuI,render:function(){if(this.attributes.data)
this.text=this.ownerTree.tpl.apply(this.attributes.data);Rad.AsyncTreeNode.superclass.render.call(this,arguments)},setText:function(text){text=this.ownerTree.tpl.apply(this.attributes.data);Rad.AsyncTreeNode.superclass.setText.call(this,text)}});Rad.TreePanel.nodeTypes.radasync=Rad.AsyncTreeNode;Rad.TreeLoader=Ext.extend(Ext.tree.TreeLoader,{createNode:function(attr){if(this.baseAttrs){Ext.applyIf(attr,this.baseAttrs)}
if(this.applyLoader!==!1&&!attr.loader){attr.loader=this}
if(Ext.isString(attr.uiProvider)){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}
if(attr.nodeType){return new Rad.TreePanel.nodeTypes[attr.nodeType](attr)}else{return attr.leaf?new Rad.AsyncTreeNode(attr):new Rad.AsyncTreeNode(attr)}}});Rad.FormTree=Ext.extend(Rad.Form,{onSuccess:function(form,action){if(this.record!=null){if(action){}
if(action){this.updateGridStoreRecord(action.result.record)}else{this.updateGridStoreRecord();this.getForm().fireEvent('actioncomplete',this)}}},updateGridStoreRecord:function(values){var selectedNode=this.ownerCt.grid.getSelectionModel().getSelectedNode();selectedNode.attributes.data=values;selectedNode.setText(values[this.ownerCt.grid.display]);selectedNode.setId(values.Id);selectedNode.parentNode.expandable=!0;selectedNode.parentNode.leaf=!1;selectedNode.parentNode.ui.updateExpandIcon()}});Rad.ABMWindowTree=Ext.extend(Rad.ABMWindow,{autoHideOnSubmit:!0,grid:null,initComponent:function(){this.initialConfig.closeAction='hide';this.closeAction='hide';Rad.ABMWindow.superclass.initComponent.call(this,arguments);if(this.autoHideOnSubmit){this.getForm().on('actioncomplete',function(){this.hide()},this)}
this.on('hide',function(){this.grid.enable();var selected=this.grid.getSelectionModel().getSelectedNode();if(!selected.attributes.data.Id){selected.remove()}},this)},getForm:function(){if(this.items.items[0]instanceof Rad.Form){return this.items.items[0]}else if(this.tree.abmFormId){return this.findById(this.tree.abmFormId)}else{this.publish('/desktop/showError','La ventana ABMWindowTree no puede retornar el formulario<br>Posiblemente falte sobreescribir el método getForm');return!1}}});Ext.reg('radasync',Rad.AsyncTreeNode);Ext.reg('radtree',Rad.TreePanel);Ext.reg('radformtree',Rad.FormTree);Ext.namespace("Ext.ux.menu");Ext.ux.menu.EditableItem=Ext.extend(Ext.menu.BaseItem,{itemCls:"x-menu-item",hideOnClick:!1,initComponent:function(){this.addEvents({keyup:!0});this.editor=this.editor||new Ext.form.TextField();if(this.text)
this.editor.setValue(this.text)},onRender:function(container){var s=container.createChild({cls:this.itemCls,html:'<img src="'+(this.icon||Ext.BLANK_IMAGE_URL)+'" class="x-menu-item-icon'+(this.iconCls?' '+this.iconCls:'')+'" style="margin: 3px 10px 2px 2px;" />'});Ext.apply(this.config,{width:125});this.editor.render(s);this.el=s;this.relayEvents(this.editor.el,["keyup"]);this.el.swallowEvent(['keydown','keypress']);Ext.each(["keydown","keypress"],function(eventName){this.el.on(eventName,function(e){if(e.isNavKeyPress())
e.stopPropagation()},this)},this);if(Ext.isGecko){s.setOverflow('auto');var containerSize=container.getSize();this.editor.getEl().setStyle('position','fixed');container.setSize(containerSize)}
Ext.ux.menu.EditableItem.superclass.onRender.apply(this,arguments)},getValue:function(){return this.editor.getValue()},setValue:function(value){this.editor.setValue(value)},isValid:function(preventMark){return this.editor.isValid(preventMark)}});Ext.ux.form.AdvCombo=Ext.extend(Ext.ux.form.ComboBox,{aditionalTriggersClasses:[],onTrigger1Click:function(){this.onTriggerClick()},showSearchMenu:function(obj){this.searchMenu.show(this.triggers[this.searchIndex])},showFetchMenu:function(obj){this.fetchMenu.show(this.triggers[this.fetchIndex])},onSearchItemCheck:function(item,checked){this.searchField=item.value},onFetchItemCheck:function(item,checked){this.store.baseParams.fetch=item.value},initComponent:function(){this.triggerClasses=['x-form-trigger'];Ext.ux.form.AdvCombo.superclass.initComponent.call(this,arguments)},addTrigersFromConf:function(){if(this.searchOptions){var vmenu=['<b class="menu-title">Buscar Por</b>'];for(var i=0;i<this.searchOptions.length;i++){o=this.searchOptions[i];vmenu.push({text:o.text,value:o.value,checked:(i==0),scope:this,group:'searchgroup',checkHandler:this.onSearchItemCheck})}
this.searchIndex=this.triggerClasses.length;this.searchMenu=menu=new Ext.menu.Menu({items:vmenu});this.triggerClasses.push({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-form-search-trigger"});var triggerHandler='onTrigger'+this.triggerClasses.length+'Click';if(!this[triggerHandler]){this[triggerHandler]=this.showSearchMenu}}
if(this.fetchOptions){var vmenu=['<b class="menu-title">Buscar</b>'];for(var i=0;i<this.fetchOptions.length;i++){o=this.fetchOptions[i];vmenu.push({text:o.text,value:o.value,checked:(i==0),scope:this,group:'searchgroup',checkHandler:this.onFetchItemCheck})}
this.fetchMenu=menu=new Ext.menu.Menu({items:vmenu});this.fetchIndex=this.triggerClasses.length;this.triggerClasses.push({tag:"img",src:'images/bullet_blue.png',cls:"x-form-trigger"});var triggerHandler='onTrigger'+this.triggerClasses.length+'Click';if(!this[triggerHandler]){this[triggerHandler]=this.showFetchMenu}}},onRender:function(ct,position){this.addTrigersFromConf();Ext.ux.form.AdvCombo.superclass.onRender.call(this,ct,position);this.wrap=this.el.wrap({cls:'x-form-field-wrap x-form-field-trigger-wrap'});if(!this.triggerConfig){this.triggerClasses.concat(this.aditionalTriggersClasses);if(this.triggerClasses.length>1){var triggers=[];for(var i=0;i<this.triggerClasses.length;i++){o=this.triggerClasses[i];if(typeof(o)=='string'){triggers.push({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+o})}else{triggers.push(o)}}
this.triggerConfig={tag:'span',cls:'x-form-twin-triggers',cn:triggers}}else{this.triggerConfig={tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClasses[0]}}}
this.trigger=this.wrap.createChild(this.triggerConfig);if(this.hideTrigger){this.trigger.setDisplayed(!1)}
this.initTrigger();if(!this.width){this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())}
if(!this.editable){this.editable=!0;this.setEditable(!1)}},getTrigger:function(index){return this.triggers[index]},initTrigger:function(){if(this.trigger.dom.tagName=='IMG'){this.trigger.remove();return}
var ts=this.wrap.select('.x-form-trigger',!0);this.wrap.setStyle('overflow','hidden');var triggerField=this;ts.each(function(t,all,index){t.hide=function(){var w=triggerField.wrap.getWidth();this.dom.style.display='none';triggerField.el.setWidth(w-triggerField.trigger.getWidth())};t.show=function(){var w=triggerField.wrap.getWidth();this.dom.style.display='';triggerField.el.setWidth(w-triggerField.trigger.getWidth())};var triggerIndex=(this.triggerClasses.length>1?index+1:'');if(this['hideTrigger'+triggerIndex]){t.dom.style.display='none'}
var triggerHandler='onTrigger'+triggerIndex+'Click';if(!this[triggerHandler]){this[triggerHandler]=function(){console.log(triggerHandler)}}
this.mon(t,'click',this[triggerHandler],this,{preventDefault:!0});t.addClassOnOver('x-form-trigger-over');t.addClassOnClick('x-form-trigger-click');var qtip=this['trigger'+triggerIndex+'Tip'];if(qtip){if(Ext.isObject(qtip)){Ext.QuickTips.register(Ext.apply({target:t.id},qtip))}else{t.dom.qtip=qtip}}},this);this.triggers=ts.elements},onBeforeCallApp:function(combo)
{return{}}});Ext.reg('AdvCombo',Ext.ux.form.AdvCombo);Ext.ux.StatusBar=Ext.extend(Ext.Toolbar,{cls:'x-statusbar',busyIconCls:'x-status-busy',busyText:'Loading...',autoClear:5000,emptyText:'&nbsp;',activeThreadId:0,initComponent:function(){if(this.statusAlign=='right'){this.cls+=' x-status-right'}
Ext.ux.StatusBar.superclass.initComponent.call(this)},afterRender:function(){Ext.ux.StatusBar.superclass.afterRender.call(this);var right=this.statusAlign=='right';this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=new Ext.Toolbar.TextItem({cls:'x-status-text '+(this.currIconCls||''),text:this.text||this.defaultText||''});if(right){this.add('->');this.add(this.statusEl)}else{this.insert(0,this.statusEl);this.insert(1,'->')}
this.doLayout()},setStatus:function(o){o=o||{};if(typeof o=='string'){o={text:o}}
if(o.text!==undefined){this.setText(o.text)}
if(o.iconCls!==undefined){this.setIcon(o.iconCls)}
if(o.clear){var c=o.clear,wait=this.autoClear,defaults={useDefaults:!0,anim:!0};if(typeof c=='object'){c=Ext.applyIf(c,defaults);if(c.wait){wait=c.wait}}else if(typeof c=='number'){wait=c;c=defaults}else if(typeof c=='boolean'){c=defaults}
c.threadId=this.activeThreadId;this.clearStatus.defer(wait,this,[c])}
return this},clearStatus:function(o){o=o||{};if(o.threadId&&o.threadId!==this.activeThreadId){return this}
var text=o.useDefaults?this.defaultText:this.emptyText,iconCls=o.useDefaults?(this.defaultIconCls?this.defaultIconCls:''):'';if(o.anim){this.statusEl.el.fadeOut({remove:!1,useDisplay:!0,scope:this,callback:function(){this.setStatus({text:text,iconCls:iconCls});this.statusEl.el.show()}})}else{this.statusEl.hide();this.setStatus({text:text,iconCls:iconCls});this.statusEl.show()}
return this},setText:function(text){this.activeThreadId++;this.text=text||'';if(this.rendered){this.statusEl.setText(this.text)}
return this},getText:function(){return this.text},setIcon:function(cls){this.activeThreadId++;cls=cls||'';if(this.rendered){if(this.currIconCls){this.statusEl.removeClass(this.currIconCls);this.currIconCls=null}
if(cls.length>0){this.statusEl.addClass(cls);this.currIconCls=cls}}else{this.currIconCls=cls}
return this},showBusy:function(o){if(typeof o=='string'){o={text:o}}
o=Ext.applyIf(o||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(o)}});Ext.reg('statusbar',Ext.ux.StatusBar);Ext.ux.form.LinkTriggerField=Ext.extend(Ext.ux.form.AdvCombo,{onBeforeCallApp:function(combo)
{return{}},initComponent:function(){Ext.ux.form.LinkTriggerField.superclass.initComponent.call(this,arguments);this.triggerClasses=['x-form-trigger',{tag:"img",src:'images/bullet_go.png',cls:"x-form-trigger"}]},onTrigger2Click:function(){defaults={action:'find',value:this.link.fixedValue||this.getValue()};Ext.applyIf(defaults,this.onBeforeCallApp(this));this.publish(app.channels.apps+this.link,defaults)}});Ext.reg('LinkTriggerField',Ext.ux.form.LinkTriggerField);Ext.ns('ERP');ERP.depositoResaltadorMenu=Ext.extend(Ext.menu.Item,{color:'rojo',deposito:null,initComponent:function(){this.menu={items:[{text:'Articulo',scope:this,iconCls:'x-btn-text-icon',icon:'images/modulos/Articulos16.png',handler:function(){win=app.desktop.createWindow({layout:'form',width:570,height:100,minimizable:!1,collapsible:!1,constrain:!1,maximizable:!1,title:'Resaltar articulos',plain:!0,modal:!0,border:!1,constrain:!0,bodyStyle:'padding:15px',items:{xtype:'xcombo',iconCls:'no-icon',tpl:RadTemplates.articuloAlmacenes,anchor:'98%',minChars:3,displayField:'Descripcion',autocomplete:!0,selectOnFocus:!0,pageSize:20,forceSelection:!0,forceReload:!0,loadingText:'Cargando...',lazyRender:!0,triggerAction:'all',fieldLabel:'Articulo',searchField:'Descripcion',editable:!0,typeAhead:!1,valueField:'Id',autoLoad:!1,allowBlank:!0,store:new Ext.data.JsonStore({url:'datagateway/combolist/model/ArticulosGenericos/m/Base',autoLoad:!0,root:'rows',idProperty:'Id',storeId:'ArticulosFiltrosAlmacenes',totalProperty:'count'}),listeners:{scope:this,'select':function(combo){this.deposito.resaltar(combo.getValue(),'esArticulo','mmi-filtro'+this.color,'',this.color);win.close()}}}});win.show()}},{text:'Creados Desde',scope:this,iconCls:'x-btn-text-icon',icon:'images/modulos/Depositos16.png',menu:new Ext.menu.DateMenu({scope:this,listeners:{select:{fn:function(datepicker,date){this.deposito.resaltar(date,'esCreadoDespues','mmi-filtro'+this.color,'',this.color)},scope:this}}})},{text:'Vencidos',scope:this,iconCls:'x-btn-text-icon',icon:'images/modulos/Depositos16.png',menu:new Ext.menu.DateMenu({scope:this,listeners:{select:{fn:function(datepicker,date){this.deposito.resaltar(date,'esVencidosDespues','mmi-filtro'+this.color,'',this.color)},scope:this}}})},{text:'Quitar Resaltado',scope:this,iconCls:'x-btn-text-icon',icon:'images/cancel.png',handler:function(){this.deposito.quitarResaltado(this.color)}}]};ERP.depositoResaltadorMenu.superclass.initComponent.call(this)}});Ext.ns('ERP');function filtrosDepositos(view){this.view=view;this.porArticulo=function(articulo){this.view.tpl.filtro=function(value){return(articulo==value.Mmi.Articulo)?'ubicacion-resaltada':'ubicacion-no-resaltada'};this.view.refresh()};this.porArticuloVersion=function(articulo){this.view.tpl.filtro=function(value){return(articulo==value.Mmi.ArticuloVersion)?'ubicacion-resaltada':'ubicacion-no-resaltada'};this.view.refresh()};this.esArticulo=function(value,valorFiltro){return(valorFiltro==value.Mmi.Articulo)},this.esCreadoDespues=function(value,valorFiltro){return(value.Mmi.FechaIngreso&&valorFiltro.format('Y-m-d h:i:s')<value.Mmi.FechaIngreso)};this.esVencidosDespues=function(value,valorFiltro){return(value.Mmi.FechaIngreso&&valorFiltro.format('Y-m-d h:i:s')<value.Mmi.FechaVencimiento)};this.porArticuloYRemitoArticuloSalida=function(articulo,rArticulo){this.view.tpl.filtro=function(value){v=(rArticulo==value.Mmi.RemitoArticuloSalida)?' mmi-resaltado ':'';return((articulo==value.Mmi.Articulo)&&(!value.Mmi.RemitoArticuloSalida||v))?'ubicacion-resaltada'+v:'ubicacion-no-resaltada'+v};this.view.refresh()};this.porArticuloYRemitoArticulo=function(articulo,rArticulo){this.view.tpl.filtro=function(value){v=(rArticulo==value.Mmi.RemitoArticulo)?' mmi-resaltado ':'';return((articulo==value.Mmi.Articulo)&&(!value.Mmi.RemitoArticulo||v))?'ubicacion-resaltada'+v:'ubicacion-no-resaltada'+v};this.view.refresh()};this.porTipo=function(articulo){this.view.tpl.filtro=function(value){return 'ubicacion-no-resaltada'};this.view.refresh()};this.filtrarTodo=function(){this.view.tpl.filtro=function(value){return 'ubicacion-no-resaltada'};this.view.refresh()};this.porOrdenDeProduccionDetalleTemporalYArticuloVersion=function(odpDetalle,articulo){var oD=odpDetalle;var a=articulo;var dview=this.view;this.view.tpl.filtro=function(value){v=(value.AsignadoODPDetalleTemporal==oD)?' mmi-resaltado':' mmi-no-resaltado';console.log(dview.almacenSeleccionado.TipoDeAlmacen);if(dview.almacenSeleccionado.TipoDeAlmacen==3)return 'ubicacion-no-resaltada'+v;return(a==value.Mmi.ArticuloVersion)?'ubicacion-resaltada'+v:'ubicacion-no-resaltada'+v}
this.view.refresh()};this.quitar=function(){this.view.tpl.filtro=function(){return 'ubicacion-resaltada'}
this.view.refresh()}}
ERP.depositoDataView=Ext.extend(Ext.DataView,{almacen:null,almacenSeleccionado:null,url:'/Almacenes/Almacenes/getcells',itemSelector:'div.thumb-cell',selectedClass:'thumb-cell-selected',loadingText:'Cargando...',autoWidth:!0,multiSelect:!0,trackOver:!0,isTarget:!0,filtros:null,emptyText:'<div style="display: table;margin: 0 auto;font-size:110%;padding-top:30px;font-weight: bold;">Almacen vac&iacute;o</div>',plugins:new Ext.DataView.DragSelector({dragSafe:!0}),mmiMostrarDescripcion:1,setMostrarEnDetalle:function(mode){this.mmiMostrarDescripcion=mode;this.refresh()},cambiarAlmacen:function(alm){this.almacenSeleccionado=alm;this.store.baseParams={almacen:alm.Id};this.almacen=alm.Id;this.store.reload()},initComponent:function(){this.addEvents('paletPartido');this.addEvents('paletModificado');this.addEvents('paletEliminado');this.filtros=new filtrosDepositos(this);this.tpl=new Ext.XTemplate('<tpl for=".">','<tpl if="Fila == 1"><div style="clear:both"></div></tpl>','<div class="thumb-cell {[this.getStateClass(values)]}" id="ubicacion{Id}" ubicacion={Id} Profundidad="{Profundidad}" Fila={Fila} Altura="{Altura}"  >','<div class=\"ubicMmis\"><div class=\"ubicDesc ubicMmiDesc\">{[this.getDescripcion(values)]}</div><div class=\"ubicDesc\">{Descripcion}</div></div>','</div>','<tpl if="Altura == 1 && Fila == this.getFilas()"><div style="clear:both; height:20px; width:1px"></div></tpl>','</tpl>',{getDescripcion:function(data){if(this.scope.mmiMostrarDescripcion==1)return data.Mmi.Identificador;if(this.scope.mmiMostrarDescripcion==2)return data.Lote.Numero;if(this.scope.mmiMostrarDescripcion==3)return data.Mmi.CantidadActual;if(this.scope.mmiMostrarDescripcion==4)return Ext.util.Format.date(Date.parseDate(data.Lote.FechaVencimiento,"Y-m-d"),'d/m/Y');if(this.scope.mmiMostrarDescripcion==5)return Ext.util.Format.date(Date.parseDate(data.Lote.FechaElaboracion,"Y-m-d"),'d/m/Y')},getStateClass:function(data){if(data.Mmi&&data.Mmi.Id>0){if(data.Mmi.RemitoArticuloSalida){cssClass='mmi-asignado '}else if(data.AsignadoODPDetalleTemporal){cssClass='mmi-asignado-prodadd '}else if(data.Mmi.Orden){cssClass='mmi-asignado-prod '}else{cssClass='ubicacion-full '}}else{if(data.Existente==1){cssClass='ubicacion-empty '}else{cssClass='ubicacion-anulada '}}
return cssClass+this.filtro(data)+this.resaltar(data)},filtro:function(data){return ''},resaltar:function(data){dView=this.scope;var rtn='';for(var i in this.resCfg)
{rtn=rtn+' '+((dView.filtros[this.resCfg[i][1]](data,this.resCfg[i][0]))?this.resCfg[i][2]:this.resCfg[i][3])}
return rtn},resCfg:{},getFilas:function(){return parseInt(this.scope.store.reader.jsonData.cantFila)}});this.tpl.scope=this;this.store=new Ext.data.JsonStore({url:this.url,baseParams:{almacen:this.almacen},autoLoad:this.almacen!=null,root:'rows',idProperty:'Id',storeId:'viewStore',listeners:{beforeload:function(){},load:function(){}},totalCount:'cantFila',fields:['Id','Descripcion','Observaciones','Almacen','Fila','Profundidad','Altura','Existente','Mmi','A','AsignadoODPDetalleTemporal','CE','CS','Lote']});this.store.on('load',function(t,r,o){if(r[0]&&r[0].json.CantFila){this.el.setWidth(r[0].json.CantFila*60)}},this);this.on('resize',function(t,adjWidth,adjHeight,rawWidth,rawHeight){var r=t.store.getAt(0);if(r&&r.json.CantFila){this.el.setWidth(r.json.CantFila*60)}},this);this.cmenu=new Ext.menu.Menu({items:[{text:'Detalle',iconCls:'x-btn-text-icon',icon:'images/page_white_text.png',scope:this,handler:function(){this.showNodeDetail()}},{text:'Imprimir Identificador',iconCls:'x-btn-text-icon',icon:'images/printer.png',scope:this,handler:function(){app.publish('/desktop/modules/js/commonApps/showUrl.js',{action:'launch',url:'/Window/BirtReporter/report/template/Identificador_Palets_Entrantes/id/'+this.contextMmi,width:900,height:500,title:'Mmi'})}},{text:'Trazabilidad',iconCls:'x-btn-text-icon',icon:'images/arrow_divide.png',scope:this,handler:function(){this.showNodeTrace()}}]});ERP.depositoDataView.superclass.initComponent.call(this)},cambiarArticuloPalet:function(paletId,articuloversion,callback){Rad.callRemoteJsonAction({url:'/Almacenes/Almacenes/cambiararticulommi',params:{id:paletId,articuloversion:articuloversion},scope:this,success:function(response){this.store.reload();window.app.publish('/desktop/notify',{title:'Info',iconCls:'x-icon-information',html:'Mmi Modificado'});this.fireEvent('paletModificado',this)},async:!0})},cambiarCantidadPalet:function(paletId,cantidad,callback){Rad.callRemoteJsonAction({url:'/Almacenes/Almacenes/cambiarcantidadmmi',params:{id:paletId,cantidad:cantidad},scope:this,success:function(response){this.store.reload();window.app.publish('/desktop/notify',{title:'Info',iconCls:'x-icon-information',html:'Mmi Modificado'});this.fireEvent('paletModificado',this)},async:!0})},partirPalet:function(paletId,cantidad,callback){Rad.callRemoteJsonAction({url:'/Almacenes/Almacenes/partirmmi',params:{id:paletId,cantidad:cantidad},scope:this,success:function(response){this.store.reload();window.app.publish('/desktop/notify',{title:'Info',iconCls:'x-icon-information',html:'Mmi Partido'});this.fireEvent('paletPartido',this)},async:!0})},eliminarPalet:function(paletId,cantidad,callback){Rad.callRemoteJsonAction({url:'/Almacenes/Almacenes/eliminarmmi',params:{id:paletId},scope:this,success:function(response){this.store.reload();window.app.publish('/desktop/notify',{title:'Info',iconCls:'x-icon-information',html:'Mmi Eliminado'});this.fireEvent('paletEliminado',this)},})},resaltar:function(param,fnFiltro,resaltada,normal,name){if(!normal)normal='';if(!resaltada)resaltada='';this.tpl.resCfg[name]=new Array()
this.tpl.resCfg[name][0]=param;this.tpl.resCfg[name][1]=fnFiltro;this.tpl.resCfg[name][2]=resaltada;this.tpl.resCfg[name][3]=normal;this.refresh()},quitarResaltado:function(name){delete(this.tpl.resCfg[name]);this.refresh()},asignando:!1,sumarSeleccionados:function(selections){var total=0;for(var i=0,len=selections.length;i<len;i++){selItem=this.store.getAt(selections[i].viewIndex);if(!selItem.data.Mmi.RemitoArticuloSalida){total=total+Ext.num(selItem.data.Mmi.CantidadActual,0)}}
return total},showNodeDetail:function(){t=this.tip;t.showBy(this.contextNode);t.update('<div class="panelDeDetalles panelDetalleAzul">'+this.getDetalleMmiHtml(this.contextNode.viewIndex)+'</div>',!1,function(){this.tip.syncShadow()})},showNodeTrace:function(){this.publish('/desktop/modules/Almacenes/Trazabilidad',{action:'launch',id:this.contextMmi})},getDetalleMmiHtml:function(index){var data=this.store.getAt(index).data;if(data.Mmi.Id==null)return "<h3>Ubicación Vacía</h3>";var fe,fv,fi;if(data.Lote.FechaElaboracion){fe=Ext.util.Format.date(Date.parseDate(data.Lote.FechaElaboracion,"Y-m-d"),'d/m/Y')}
if(data.Lote.FechaVencimiento){fv=Ext.util.Format.date(Date.parseDate(data.Lote.FechaVencimiento,"Y-m-d"),'d/m/Y')}
if(data.Lote.FechaIngreso){fi=Ext.util.Format.date(Date.parseDate(data.Lote.FechaIngreso,"Y-m-d h:i:s"),'d/m/Y h:i:s')}
tooltip="<h3>MMI: "+data.Mmi.Identificador+"</h3>"+"<div class='detalle'>"+"<b>Articulo:</b>"+"<span>"+data.A.Descripcion+"</span>"+"<b>Fecha de Ingreso:</b>"+"<span>"+(fi||'-')+"</span>"+"<b>Cantidad Actual / Original:</b>"+"<span>"+data.Mmi.CantidadActual+' / '+data.Mmi.CantidadOriginal+"</span>"+"<hr><b>Lote:</b>"+"<span>"+data.Lote.Numero+"</span>"+"<b>Elaboración - Vencimiento:</b>"+"<span>"+(fe||'-')+' - '+(fv||'-')+"</span>";if(data.CE&&data.CE.Numero||data.CS&&data.CS.Numero){tooltip+='<hr>'}
if(data.CE&&data.CE.Numero){tooltip+='<b>Ingreso</b>';tooltip+="<span class='sub'>Remíto: "+data.CE.Punto+'-'+data.CE.Numero+"</span>"}
if(data.CS&&data.CS.Numero){tooltip+='<b>Despacho</b>';tooltip+="<span class='sub'>Asignado a remíto: "+data.CS.Punto+'-'+data.CS.Numero+"</span>"}
tooltip+="</div>";return tooltip},listeners:{contextmenu:function(i,index,node,e){if(node){this.contextNode=node;dt=this.store.getAt(this.contextNode.viewIndex);if(dt.data.Mmi.Id){this.contextMmi=dt.data.Mmi.Id;this.cmenu.showAt(e.getXY())}}
e.stopEvent()},beforeselect:function(i,n,s){var estado=(!Ext.fly(n).hasClass('ubicacion-no-resaltada'));return estado},destroy:function(){this.tip.destroy()}},afterRender:function(){Ext.DataView.prototype.afterRender.apply(this,arguments);this.tip=new Ext.ToolTip({autoWidth:!1,width:300,height:300,dismissDelay:0,trackMouse:!1,autoHide:!1,shadow:!0,closable:!0,floating:!0})}});Ext.ux.Reorderer=Ext.extend(Object,{defaults:{animate:!0,animationDuration:0.2,defaultReorderable:!1},constructor:function(config){Ext.apply(this,config||{},this.defaults)},init:function(target){this.target=target;this.initEvents();var items=this.getItems(),length=items.length,i;for(i=0;i<length;i++){this.createIfReorderable(items[i])}},reorder:function(mappings){var target=this.target;if(target.fireEvent('before-reorder',mappings,target,this)!==!1){this.doReorder(mappings);target.fireEvent('reorder',mappings,target,this)}},doReorder:function(paramName){throw new Error("doReorder must be implemented in the Ext.ux.Reorderer subclass")},createItemDD:function(item){throw new Error("createItemDD must be implemented in the Ext.ux.Reorderer subclass")},createItemDD:function(button){var el=button.getEl(),id=el.id,tbar=this.target,me=this;button.dd=new Ext.dd.DD(el,undefined,{isTarget:!1});button.dd.constrainTo(tbar.getEl());button.dd.setYConstraint(0,0,0);Ext.apply(button.dd,{b4StartDrag:function(){this.startPosition=el.getXY();this.startZIndex=el.getStyle('zIndex');el.setStyle('zIndex',10000);button.suspendEvents()},onDrag:function(e){var buttonX=el.getXY()[0],deltaX=buttonX-this.startPosition[0],items=tbar.items.items,oldIndex=items.indexOf(button),newIndex;for(var index=0;index<items.length;index++){var item=items[index];if(item.reorderable&&item.id!=button.id){var box=item.getEl().getBox(),midpoint=(me.buttonXCache[item.id]||box.x)+(box.width/2),movedLeft=oldIndex>index&&deltaX<0&&buttonX<midpoint,movedRight=oldIndex<index&&deltaX>0&&(buttonX+el.getWidth())>midpoint;if(movedLeft||movedRight){me[movedLeft?'onMovedLeft':'onMovedRight'](button,index,oldIndex);break}}}},endDrag:function(){me.updateButtonXCache();el.moveTo(me.buttonXCache[button.id],undefined,{duration:me.animationDuration,scope:this,callback:function(){button.resumeEvents();tbar.fireEvent('reordered',button,tbar)}});el.setStyle('zIndex',this.startZIndex)}})},createIfReorderable:function(item){if(this.defaultReorderable&&item.reorderable==undefined){item.reorderable=!0}
if(item.reorderable&&!item.dd){if(item.rendered){this.createItemDD(item)}else{item.on('render',this.createItemDD.createDelegate(this,[item]),this,{single:!0})}}},getItems:function(){return this.target.items.items},initEvents:function(){this.target.addEvents('before-reorder','reorder')}});Ext.ux.HBoxReorderer=Ext.extend(Ext.ux.Reorderer,{init:function(container){this.buttonXCache={};container.on({scope:this,add:function(container,item){this.createIfReorderable(item)}});Ext.ux.HBoxReorderer.superclass.init.apply(this,arguments)},createItemDD:function(button){if(button.dd!=undefined){return}
var el=button.getEl(),id=el.id,me=this,tbar=me.target;button.dd=new Ext.dd.DD(el,undefined,{isTarget:!1});el.applyStyles({position:'absolute'});var menuDisabler=function(){return!1};Ext.apply(button.dd,{b4StartDrag:function(){this.startPosition=el.getXY();this.startZIndex=el.getStyle('zIndex');el.setStyle('zIndex',10000);button.suspendEvents();if(button.menu){button.menu.on('beforeshow',menuDisabler,me)}},startDrag:function(){this.constrainTo(tbar.getEl());this.setYConstraint(0,0,0)},onDrag:function(e){var buttonX=el.getXY()[0],deltaX=buttonX-this.startPosition[0],items=tbar.items.items,length=items.length,oldIndex=items.indexOf(button),newIndex,index,item;for(index=0;index<length;index++){item=items[index];if(item.reorderable&&item.id!=button.id){var box=item.getEl().getBox(),midpoint=(me.buttonXCache[item.id]||box.x)+(box.width/2),movedLeft=oldIndex>index&&deltaX<0&&buttonX<midpoint,movedRight=oldIndex<index&&deltaX>0&&(buttonX+el.getWidth())>midpoint;if(movedLeft||movedRight){me[movedLeft?'onMovedLeft':'onMovedRight'](button,index,oldIndex);break}}}},endDrag:function(){me.updateButtonXCache();el.moveTo(me.buttonXCache[button.id],el.getY(),{duration:me.animationDuration,scope:this,callback:function(){button.resumeEvents();if(button.menu){button.menu.un('beforeshow',menuDisabler,me)}
tbar.fireEvent('reordered',button,tbar)}});el.setStyle('zIndex',this.startZIndex)}})},onMovedLeft:function(item,newIndex,oldIndex){var tbar=this.target,items=tbar.items.items,length=items.length,index;if(newIndex!=undefined&&newIndex!=oldIndex){tbar.remove(item,!1);tbar.insert(newIndex,item);this.updateButtonXCache();for(index=0;index<length;index++){var obj=items[index],newX=this.buttonXCache[obj.id];if(item==obj){item.dd.startPosition[0]=newX}else{var el=obj.getEl();el.moveTo(newX,el.getY(),{duration:this.animationDuration})}}}},onMovedRight:function(item,newIndex,oldIndex){this.onMovedLeft.apply(this,arguments)},updateButtonXCache:function(){var tbar=this.target,items=tbar.items,totalX=tbar.getEl().getBox(!0).x;items.each(function(item){this.buttonXCache[item.id]=totalX;totalX+=item.getEl().getWidth()},this)}});Ext.direct.RadRemotingProvider=Ext.extend(Ext.direct.RemotingProvider,{doSend:function(data){var o={url:this.url,callback:this.onData,scope:this,ts:data,timeout:this.timeout},callData;var headers;if(Ext.isArray(data)){callData=[];for(var i=0,len=data.length;i<len;i++){callData.push(this.getCallData(data[i]))}}else{headers=data.headers;delete(data.headers);callData=this.getCallData(data)}
if(this.enableUrlEncode){var params={};params[Ext.isString(this.enableUrlEncode)?this.enableUrlEncode:'data']=Ext.encode(callData);o.params=params}else{o.jsonData=callData}
o.headers=headers;Ext.Ajax.request(o)}});Ext.Direct.PROVIDERS.radremoting=Ext.direct.RadRemotingProvider;Ext.ux.ToolbarDroppable=Ext.extend(Object,{constructor:function(config){Ext.apply(this,config,{})},init:function(toolbar){this.toolbar=toolbar;this.toolbar.on({scope:this,render:this.createDropTarget})},createDropTarget:function(){this.dropTarget=new Ext.dd.DropTarget(this.toolbar.getEl(),{notifyOver:this.notifyOver.createDelegate(this),notifyDrop:this.notifyDrop.createDelegate(this)})},addDDGroup:function(ddGroup){this.dropTarget.addToGroup(ddGroup)},calculateEntryIndex:function(e){var entryIndex=0,toolbar=this.toolbar,items=toolbar.items.items,count=items.length,xTotal=toolbar.getEl().getXY()[0],xHover=e.getXY()[0]-xTotal;for(var index=0;index<count;index++){var item=items[index],width=item.getEl().getWidth(),midpoint=xTotal+width/2;xTotal+=width;if(xHover<midpoint){entryIndex=index;break}else{entryIndex=index+2}}
return entryIndex+2},canDrop:function(data){return!0},notifyOver:function(dragSource,event,data){return this.canDrop.apply(this,arguments)?this.dropTarget.dropAllowed:this.dropTarget.dropNotAllowed},notifyDrop:function(dragSource,event,data){var canAdd=this.canDrop(dragSource,event,data),tbar=this.toolbar;if(canAdd){var entryIndex=this.calculateEntryIndex(event);tbar.insert(entryIndex,this.createItem(data));tbar.doLayout();this.afterLayout()}
return canAdd},createItem:function(data){throw new Error("The createItem method must be implemented in the ToolbarDroppable plugin")},afterLayout:Ext.emptyFn});Ext.ux.ToolbarReorderer=Ext.extend(Ext.ux.Reorderer,{init:function(toolbar){this.buttonXCache={};toolbar.on({scope:this,add:function(toolbar,item){this.createIfReorderable(item)}});Ext.ux.ToolbarReorderer.superclass.init.apply(this,arguments)},createItemDD:function(button){if(button.dd!=undefined){return}
var el=button.getEl(),id=el.id,tbar=this.target,me=this;button.dd=new Ext.dd.DD(el,undefined,{isTarget:!1});var menuDisabler=function(){return!1};Ext.apply(button.dd,{b4StartDrag:function(){this.startPosition=el.getXY();this.startZIndex=el.getStyle('zIndex');el.setStyle('zIndex',10000);button.suspendEvents();if(button.menu){button.menu.on('beforeshow',menuDisabler,me)}},startDrag:function(){this.constrainTo(tbar.getEl());this.setYConstraint(0,0,0)},onDrag:function(e){var buttonX=el.getXY()[0],deltaX=buttonX-this.startPosition[0],items=tbar.items.items,oldIndex=items.indexOf(button),newIndex;for(var index=0;index<items.length;index++){var item=items[index];if(item.reorderable&&item.id!=button.id){var box=item.getEl().getBox(),midpoint=(me.buttonXCache[item.id]||box.x)+(box.width/2),movedLeft=oldIndex>index&&deltaX<0&&buttonX<midpoint,movedRight=oldIndex<index&&deltaX>0&&(buttonX+el.getWidth())>midpoint;if(movedLeft||movedRight){me[movedLeft?'onMovedLeft':'onMovedRight'](button,index,oldIndex);break}}}},endDrag:function(){me.updateButtonXCache();el.moveTo(me.buttonXCache[button.id],el.getY(),{duration:me.animationDuration,scope:this,callback:function(){button.resumeEvents();if(button.menu){button.menu.un('beforeshow',menuDisabler,me)}
tbar.fireEvent('reordered',button,tbar)}});el.setStyle('zIndex',this.startZIndex)}})},onMovedLeft:function(item,newIndex,oldIndex){var tbar=this.target,items=tbar.items.items;if(newIndex!=undefined&&newIndex!=oldIndex){tbar.remove(item,!1);tbar.insert(newIndex,item);this.updateButtonXCache();for(var index=0;index<items.length;index++){var obj=items[index],newX=this.buttonXCache[obj.id];if(item==obj){item.dd.startPosition[0]=newX}else{var el=obj.getEl();el.moveTo(newX,el.getY(),{duration:this.animationDuration})}}}},onMovedRight:function(item,newIndex,oldIndex){this.onMovedLeft.apply(this,arguments)},updateButtonXCache:function(){var tbar=this.target,items=tbar.items,totalX=tbar.getEl().getBox(!0).x;items.each(function(item){this.buttonXCache[item.id]=totalX;totalX+=item.getEl().getWidth()},this)}});Ext.namespace('Ext.ux.form');Ext.ux.form.SuperBoxSelect=function(config){Ext.ux.form.SuperBoxSelect.superclass.constructor.call(this,config);this.addEvents('beforeadditem','additem','newitem','beforeremoveitem','removeitem','clear')};Ext.ux.form.SuperBoxSelect=Ext.extend(Ext.ux.form.SuperBoxSelect,Ext.ux.form.ComboBox,{addNewDataOnBlur:!1,allowAddNewData:!1,allowQueryAll:!0,backspaceDeletesLastItem:!0,classField:null,clearBtnCls:'',clearLastQueryOnEscape:!1,clearOnEscape:!1,displayFieldTpl:null,extraItemCls:'',extraItemStyle:'',expandBtnCls:'',fixFocusOnTabSelect:!0,forceFormValue:!0,forceSameValueQuery:!1,itemDelimiterKey:Ext.EventObject.ENTER,navigateItemsWithTab:!0,pinList:!0,preventDuplicates:!0,queryFilterRe:'',queryValuesDelimiter:'|',queryValuesIndicator:'query',removeValuesFromStore:!0,renderFieldBtns:!0,stackItems:!1,styleField:null,supressClearValueRemoveEvents:!1,validationEvent:'blur',valueDelimiter:',',initComponent:function(){Ext.apply(this,{items:new Ext.util.MixedCollection(!1),usedRecords:new Ext.util.MixedCollection(!1),addedRecords:[],remoteLookup:[],hideTrigger:!0,grow:!1,resizable:!1,multiSelectMode:!1,preRenderValue:null,filteredQueryData:''});if(this.queryFilterRe){if(Ext.isString(this.queryFilterRe)){this.queryFilterRe=new RegExp(this.queryFilterRe)}}
if(this.transform){this.doTransform()}
if(this.forceFormValue){this.items.on({add:this.manageNameAttribute,remove:this.manageNameAttribute,clear:this.manageNameAttribute,scope:this})}
Ext.ux.form.SuperBoxSelect.superclass.initComponent.call(this);if(this.mode==='remote'&&this.store){this.store.on('load',this.onStoreLoad,this)}},onRender:function(ct,position){var h=this.hiddenName;this.hiddenName=null;Ext.ux.form.SuperBoxSelect.superclass.onRender.call(this,ct,position);this.hiddenName=h;this.manageNameAttribute();var extraClass=(this.stackItems===!0)?'x-superboxselect-stacked':'';if(this.renderFieldBtns){extraClass+=' x-superboxselect-display-btns'}
this.el.removeClass('x-form-text').addClass('x-superboxselect-input-field');this.wrapEl=this.el.wrap({tag:'ul'});this.outerWrapEl=this.wrapEl.wrap({tag:'div',cls:'x-form-text x-superboxselect '+extraClass});this.inputEl=this.el.wrap({tag:'li',cls:'x-superboxselect-input'});if(this.renderFieldBtns){this.setupFieldButtons().manageClearBtn()}
this.setupFormInterception()},doTransform:function(){var s=Ext.getDom(this.transform),transformValues=[];if(!this.store){this.mode='local';var d=[],opts=s.options;for(var i=0,len=opts.length;i<len;i++){var o=opts[i],oe=Ext.get(o),value=oe.getAttributeNS(null,'value')||'',cls=oe.getAttributeNS(null,'className')||'',style=oe.getAttributeNS(null,'style')||'';if(o.selected){transformValues.push(value)}
d.push([value,o.text,cls,typeof(style)==="string"?style:style.cssText])}
this.store=new Ext.data.SimpleStore({'id':0,fields:['value','text','cls','style'],data:d});Ext.apply(this,{valueField:'value',displayField:'text',classField:'cls',styleField:'style'})}
if(transformValues.length){this.value=transformValues.join(',')}},setupFieldButtons:function(){this.buttonWrap=this.outerWrapEl.createChild({cls:'x-superboxselect-btns'});this.buttonClear=this.buttonWrap.createChild({tag:'div',cls:'x-superboxselect-btn-clear '+this.clearBtnCls});if(this.allowQueryAll){this.buttonExpand=this.buttonWrap.createChild({tag:'div',cls:'x-superboxselect-btn-expand '+this.expandBtnCls})}
this.initButtonEvents();return this},initButtonEvents:function(){this.buttonClear.addClassOnOver('x-superboxselect-btn-over').on('click',function(e){e.stopEvent();if(this.disabled){return}
this.clearValue();this.el.focus()},this);if(this.allowQueryAll){this.buttonExpand.addClassOnOver('x-superboxselect-btn-over').on('click',function(e){e.stopEvent();if(this.disabled){return}
if(this.isExpanded()){this.multiSelectMode=!1}else if(this.pinList){this.multiSelectMode=!0}
this.onTriggerClick()},this)}},removeButtonEvents:function(){this.buttonClear.removeAllListeners();if(this.allowQueryAll){this.buttonExpand.removeAllListeners()}
return this},clearCurrentFocus:function(){if(this.currentFocus){this.currentFocus.onLnkBlur();this.currentFocus=null}
return this},initEvents:function(){var el=this.el;el.on({click:this.onClick,focus:this.clearCurrentFocus,blur:this.onBlur,keydown:this.onKeyDownHandler,keyup:this.onKeyUpBuffered,scope:this});this.on({collapse:this.onCollapse,expand:this.clearCurrentFocus,scope:this});this.wrapEl.on('click',this.onWrapClick,this);this.outerWrapEl.on('click',this.onWrapClick,this);this.inputEl.focus=function(){el.focus()};Ext.ux.form.SuperBoxSelect.superclass.initEvents.call(this);Ext.apply(this.keyNav,{tab:function(e){if(this.fixFocusOnTabSelect&&this.isExpanded()){e.stopEvent();el.blur();this.onViewClick(!1);this.focus(!1,10);return!0}
this.onViewClick(!1);if(el.dom.value!==''){this.setRawValue('')}
return!0},down:function(e){if(!this.isExpanded()&&!this.currentFocus){if(this.allowQueryAll){this.onTriggerClick()}}else{this.inKeyMode=!0;this.selectNext()}},enter:function(){}})},onClick:function(){this.clearCurrentFocus();this.collapse();this.autoSize()},beforeBlur:function(){if(this.allowAddNewData&&this.addNewDataOnBlur){var v=this.el.dom.value;if(v!==''){this.fireNewItemEvent(v)}}
Ext.form.ComboBox.superclass.beforeBlur.call(this)},onFocus:function(){this.outerWrapEl.addClass(this.focusClass);Ext.ux.form.SuperBoxSelect.superclass.onFocus.call(this)},onBlur:function(){this.outerWrapEl.removeClass(this.focusClass);this.clearCurrentFocus();if(this.el.dom.value!==''){this.applyEmptyText();this.autoSize()}
Ext.ux.form.SuperBoxSelect.superclass.onBlur.call(this)},onCollapse:function(){this.view.clearSelections();this.multiSelectMode=!1},onWrapClick:function(e){e.stopEvent();this.collapse();this.el.focus();this.clearCurrentFocus()},markInvalid:function(msg){var elp,t;if(!this.rendered||this.preventMark){return}
this.outerWrapEl.addClass(this.invalidClass);msg=msg||this.invalidText;switch(this.msgTarget){case 'qtip':Ext.apply(this.el.dom,{qtip:msg,qclass:'x-form-invalid-tip'});Ext.apply(this.wrapEl.dom,{qtip:msg,qclass:'x-form-invalid-tip'});if(Ext.QuickTips){Ext.QuickTips.enable()}
break;case 'title':this.el.dom.title=msg;this.wrapEl.dom.title=msg;this.outerWrapEl.dom.title=msg;break;case 'under':if(!this.errorEl){elp=this.getErrorCt();if(!elp){this.el.dom.title=msg;break}
this.errorEl=elp.createChild({cls:'x-form-invalid-msg'});this.errorEl.setWidth(elp.getWidth(!0)-20)}
this.errorEl.update(msg);Ext.form.Field.msgFx[this.msgFx].show(this.errorEl,this);break;case 'side':if(!this.errorIcon){elp=this.getErrorCt();if(!elp){this.el.dom.title=msg;break}
this.errorIcon=elp.createChild({cls:'x-form-invalid-icon'})}
this.alignErrorIcon();Ext.apply(this.errorIcon.dom,{qtip:msg,qclass:'x-form-invalid-tip'});this.errorIcon.show();this.on('resize',this.alignErrorIcon,this);break;default:t=Ext.getDom(this.msgTarget);t.innerHTML=msg;t.style.display=this.msgDisplay;break}
this.fireEvent('invalid',this,msg)},clearInvalid:function(){if(!this.rendered||this.preventMark){return}
this.outerWrapEl.removeClass(this.invalidClass);switch(this.msgTarget){case 'qtip':this.el.dom.qtip='';this.wrapEl.dom.qtip='';break;case 'title':this.el.dom.title='';this.wrapEl.dom.title='';this.outerWrapEl.dom.title='';break;case 'under':if(this.errorEl){Ext.form.Field.msgFx[this.msgFx].hide(this.errorEl,this)}
break;case 'side':if(this.errorIcon){this.errorIcon.dom.qtip='';this.errorIcon.hide();this.un('resize',this.alignErrorIcon,this)}
break;default:var t=Ext.getDom(this.msgTarget);t.innerHTML='';t.style.display='none';break}
this.fireEvent('valid',this)},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,'tl-tr',[Ext.isIE?5:2,3])}},expand:function(){if(this.isExpanded()||!this.hasFocus){return}
if(this.bufferSize){this.doResize(this.bufferSize);delete this.bufferSize}
this.list.alignTo(this.outerWrapEl,this.listAlign).show();this.innerList.setOverflow('auto');this.mon(Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});this.fireEvent('expand',this)},restrictHeight:function(){var inner=this.innerList.dom,st=inner.scrollTop,list=this.list;inner.style.height='';var pad=list.getFrameWidth('tb')+(this.resizable?this.handleHeight:0)+this.assetHeight,h=Math.max(inner.clientHeight,inner.offsetHeight,inner.scrollHeight),ha=this.getPosition()[1]-Ext.getBody().getScroll().top,hb=Ext.lib.Dom.getViewHeight()-ha-this.getSize().height,space=Math.max(ha,hb,this.minHeight||0)-list.shadowOffset-pad-5;h=Math.min(h,space,this.maxHeight);this.innerList.setHeight(h);list.beginUpdate();list.setHeight(h+pad);list.alignTo(this.outerWrapEl,this.listAlign);list.endUpdate();if(this.multiSelectMode){inner.scrollTop=st}},validateValue:function(val){if(this.items.getCount()===0){if(this.allowBlank){this.clearInvalid();return!0}else{this.markInvalid(this.blankText);return!1}}
this.clearInvalid();return!0},manageNameAttribute:function(){if(this.items.getCount()===0&&this.forceFormValue){this.el.dom.setAttribute('name',this.hiddenName||this.name)}else{this.el.dom.removeAttribute('name')}},setupFormInterception:function(){var form;this.findParentBy(function(p){if(p.getForm){form=p.getForm()}});if(form){var formGet=form.getValues;form.getValues=function(asString){this.el.dom.disabled=!0;var oldVal=this.el.dom.value;this.setRawValue('');var vals=formGet.call(form);this.el.dom.disabled=!1;this.setRawValue(oldVal);if(this.forceFormValue&&this.items.getCount()===0){vals[this.name]=''}
return asString?Ext.urlEncode(vals):vals}.createDelegate(this)}},onResize:function(w,h,rw,rh){var reduce=Ext.isIE6?4:Ext.isIE7?1:Ext.isIE8?1:0;if(this.wrapEl){this._width=w;this.outerWrapEl.setWidth(w-reduce);if(this.renderFieldBtns){reduce+=(this.buttonWrap.getWidth()+20);this.wrapEl.setWidth(w-reduce)}}
Ext.ux.form.SuperBoxSelect.superclass.onResize.call(this,w,h,rw,rh);this.autoSize()},onEnable:function(){Ext.ux.form.SuperBoxSelect.superclass.onEnable.call(this);this.items.each(function(item){item.enable()});if(this.renderFieldBtns){this.initButtonEvents()}},onDisable:function(){Ext.ux.form.SuperBoxSelect.superclass.onDisable.call(this);this.items.each(function(item){item.disable()});if(this.renderFieldBtns){this.removeButtonEvents()}},clearValue:function(supressRemoveEvent){Ext.ux.form.SuperBoxSelect.superclass.clearValue.call(this);this.preventMultipleRemoveEvents=supressRemoveEvent||this.supressClearValueRemoveEvents||!1;this.removeAllItems();this.preventMultipleRemoveEvents=!1;this.fireEvent('clear',this);return this},fireNewItemEvent:function(val){this.view.clearSelections();this.collapse();this.setRawValue('');if(this.queryFilterRe){val=val.replace(this.queryFilterRe,'');if(!val){return}}
this.fireEvent('newitem',this,val,this.filteredQueryData)},onKeyUp:function(e){if(this.editable!==!1&&(!e.isSpecialKey()||e.getKey()===e.BACKSPACE)&&this.itemDelimiterKey.indexOf!==e.getKey()&&(!e.hasModifier()||e.shiftKey)){this.lastKey=e.getKey();this.dqTask.delay(this.queryDelay)}},onKeyDownHandler:function(e,t){var toDestroy,nextFocus,idx;if(e.getKey()===e.ESC){if(!this.isExpanded()){if(this.el.dom.value!=''&&(this.clearOnEscape||this.clearLastQueryOnEscape)){if(this.clearOnEscape){this.el.dom.value=''}
if(this.clearLastQueryOnEscape){this.lastQuery=''}
e.stopEvent()}}}
if((e.getKey()===e.DELETE||e.getKey()===e.SPACE)&&this.currentFocus){e.stopEvent();toDestroy=this.currentFocus;this.on('expand',function(){this.collapse()},this,{single:!0});idx=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(idx<(this.items.getCount()-1)){nextFocus=this.items.itemAt(idx+1)}
toDestroy.preDestroy(!0);if(nextFocus){(function(){nextFocus.onLnkFocus();this.currentFocus=nextFocus}).defer(200,this)}
return!0}
var val=this.el.dom.value,it,ctrl=e.ctrlKey;if(this.itemDelimiterKey===e.getKey()){e.stopEvent();if(val!==""){if(ctrl||!this.isExpanded()){this.fireNewItemEvent(val)}else{this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=!0;this.unsetDelayCheck.defer(10,this)}}}else{if(!this.isExpanded()){return}
this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=!0;this.unsetDelayCheck.defer(10,this)}}
return!0}
if(val!==''){this.autoSize();return}
if(e.getKey()===e.HOME){e.stopEvent();if(this.items.getCount()>0){this.collapse();it=this.items.get(0);it.el.focus()}
return!0}
if(e.getKey()===e.BACKSPACE){e.stopEvent();if(this.currentFocus){toDestroy=this.currentFocus;this.on('expand',function(){this.collapse()},this,{single:!0});idx=this.items.indexOfKey(toDestroy.key);this.clearCurrentFocus();if(idx<(this.items.getCount()-1)){nextFocus=this.items.itemAt(idx+1)}
toDestroy.preDestroy(!0);if(nextFocus){(function(){nextFocus.onLnkFocus();this.currentFocus=nextFocus}).defer(200,this)}
return}else{it=this.items.get(this.items.getCount()-1);if(it){if(this.backspaceDeletesLastItem){this.on('expand',function(){this.collapse()},this,{single:!0});it.preDestroy(!0)}else{if(this.navigateItemsWithTab){it.onElClick()}else{this.on('expand',function(){this.collapse();this.currentFocus=it;this.currentFocus.onLnkFocus.defer(20,this.currentFocus)},this,{single:!0})}}}
return!0}}
if(!e.isNavKeyPress()){this.multiSelectMode=!1;this.clearCurrentFocus();return}
if(e.getKey()===e.LEFT||(e.getKey()===e.UP&&!this.isExpanded())){e.stopEvent();this.collapse();it=this.items.get(this.items.getCount()-1);if(this.navigateItemsWithTab){if(it){it.focus()}}else{if(this.currentFocus){idx=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(idx!==0){this.currentFocus=this.items.itemAt(idx-1);this.currentFocus.onLnkFocus()}}else{this.currentFocus=it;if(it){it.onLnkFocus()}}}
return!0}
if(e.getKey()===e.DOWN){if(this.currentFocus){this.collapse();e.stopEvent();idx=this.items.indexOfKey(this.currentFocus.key);if(idx==(this.items.getCount()-1)){this.clearCurrentFocus.defer(10,this)}else{this.clearCurrentFocus();this.currentFocus=this.items.itemAt(idx+1);if(this.currentFocus){this.currentFocus.onLnkFocus()}}
return!0}}
if(e.getKey()===e.RIGHT){this.collapse();it=this.items.itemAt(0);if(this.navigateItemsWithTab){if(it){it.focus()}}else{if(this.currentFocus){idx=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(idx<(this.items.getCount()-1)){this.currentFocus=this.items.itemAt(idx+1);if(this.currentFocus){this.currentFocus.onLnkFocus()}}}else{this.currentFocus=it;if(it){it.onLnkFocus()}}}}},onKeyUpBuffered:function(e){if(!e.isNavKeyPress()){this.autoSize()}},reset:function(){this.killItems();Ext.ux.form.SuperBoxSelect.superclass.reset.call(this);this.addedRecords=[];this.autoSize().setRawValue('')},applyEmptyText:function(){this.setRawValue('');if(this.items.getCount()>0){this.el.removeClass(this.emptyClass);this.setRawValue('');return this}
if(this.rendered&&this.emptyText&&this.getRawValue().length<1){this.setRawValue(this.emptyText);this.el.addClass(this.emptyClass)}
return this},removeAllItems:function(){this.items.each(function(item){item.preDestroy(!0)},this);this.manageClearBtn();return this},killItems:function(){this.items.each(function(item){item.kill()},this);this.resetStore();this.items.clear();this.manageClearBtn();return this},resetStore:function(){this.store.clearFilter();if(!this.removeValuesFromStore){return this}
this.usedRecords.each(function(rec){this.store.add(rec)},this);this.usedRecords.clear();if(!this.store.remoteSort){this.store.sort(this.displayField,'ASC')}
return this},sortStore:function(){var ss=this.store.getSortState();if(ss&&ss.field){this.store.sort(ss.field,ss.direction)}
return this},getCaption:function(dataObject){if(typeof this.displayFieldTpl==='string'){this.displayFieldTpl=new Ext.XTemplate(this.displayFieldTpl)}
var caption,recordData=dataObject instanceof Ext.data.Record?dataObject.data:dataObject;if(this.displayFieldTpl){caption=this.displayFieldTpl.apply(recordData)}else if(this.displayField){caption=recordData[this.displayField]}
return caption},addRecord:function(record){var display=record.data[this.displayField],caption=this.getCaption(record),val=record.data[this.valueField],cls=this.classField?record.data[this.classField]:'',style=this.styleField?record.data[this.styleField]:'';if(this.removeValuesFromStore){this.usedRecords.add(val,record);this.store.remove(record)}
this.addItemBox(val,display,caption,cls,style);this.fireEvent('additem',this,val,record)},createRecord:function(recordData){if(!this.recordConstructor){var recordFields=[{name:this.valueField},{name:this.displayField}];if(this.classField){recordFields.push({name:this.classField})}
if(this.styleField){recordFields.push({name:this.styleField})}
this.recordConstructor=Ext.data.Record.create(recordFields)}
return new this.recordConstructor(recordData)},addItems:function(newItemObjects){if(Ext.isArray(newItemObjects)){Ext.each(newItemObjects,function(item){this.addItem(item)},this)}else{this.addItem(newItemObjects)}},addNewItem:function(newItemObject){this.addItem(newItemObject,!0)},addItem:function(newItemObject,forcedAdd){var val=newItemObject[this.valueField];if(this.disabled){return!1}
if(this.preventDuplicates&&this.hasValue(val)){return}
var record=this.findRecord(this.valueField,val);if(record){this.addRecord(record);return}else if(!this.allowAddNewData){return}
if(this.mode==='remote'){this.remoteLookup.push(newItemObject);this.doQuery(val,!1,!1,forcedAdd);return}
var rec=this.createRecord(newItemObject);this.store.add(rec);this.addRecord(rec);return!0},addItemBox:function(itemVal,itemDisplay,itemCaption,itemClass,itemStyle){var hConfig,parseStyle=function(s){var ret='';switch(typeof s){case 'function':ret=s.call();break;case 'object':for(var p in s){ret+=p+':'+s[p]+';'}
break;case 'string':ret=s+';'}
return ret},itemKey=Ext.id(null,'sbx-item'),box=new Ext.ux.form.SuperBoxSelectItem({owner:this,disabled:this.disabled,renderTo:this.wrapEl,cls:this.extraItemCls+' '+itemClass,style:parseStyle(this.extraItemStyle)+' '+itemStyle,caption:itemCaption,display:itemDisplay,value:itemVal,key:itemKey,listeners:{'remove':function(item){if(this.fireEvent('beforeremoveitem',this,item.value)===!1){return!1}
this.items.removeKey(item.key);if(this.removeValuesFromStore){if(this.usedRecords.containsKey(item.value)){this.store.add(this.usedRecords.get(item.value));this.usedRecords.removeKey(item.value);this.sortStore();if(this.view){this.view.render()}}}
if(!this.preventMultipleRemoveEvents){this.fireEvent.defer(250,this,['removeitem',this,item.value,this.findInStore(item.value)])}},destroy:function(){this.collapse();this.autoSize().manageClearBtn().validateValue()},scope:this}});box.render();hConfig={tag:'input',type:'hidden',value:itemVal,name:(this.hiddenName||this.name)};if(this.disabled){Ext.apply(hConfig,{disabled:'disabled'})}
box.hidden=this.el.insertSibling(hConfig,'before');this.items.add(itemKey,box);this.applyEmptyText().autoSize().manageClearBtn().validateValue()},manageClearBtn:function(){if(!this.renderFieldBtns||!this.rendered){return this}
var cls='x-superboxselect-btn-hide';if(this.items.getCount()===0){this.buttonClear.addClass(cls)}else{this.buttonClear.removeClass(cls)}
return this},findInStore:function(val){var index=this.store.find(this.valueField,val);if(index>-1){return this.store.getAt(index)}
return!1},getSelectedRecords:function(){var ret=[];if(this.removeValuesFromStore){ret=this.usedRecords.getRange()}else{var vals=[];this.items.each(function(item){vals.push(item.value)});Ext.each(vals,function(val){ret.push(this.findInStore(val))},this)}
return ret},findSelectedItem:function(el){var ret;this.items.each(function(item){if(item.el.dom===el){ret=item;return!1}});return ret},findSelectedRecord:function(el){var ret,item=this.findSelectedItem(el);if(item){ret=this.findSelectedRecordByValue(item.value)}
return ret},findSelectedRecordByValue:function(val){var ret;if(this.removeValuesFromStore){this.usedRecords.each(function(rec){if(rec.get(this.valueField)==val){ret=rec;return!1}},this)}else{ret=this.findInStore(val)}
return ret},getValue:function(){var ret=[];this.items.each(function(item){ret.push(item.value)});return ret.join(this.valueDelimiter)},getCount:function(){return this.items.getCount()},getValueEx:function(){var ret=[];this.items.each(function(item){var newItem={};newItem[this.valueField]=item.value;newItem[this.displayField]=item.display;if(this.classField){newItem[this.classField]=item.cls||''}
if(this.styleField){newItem[this.styleField]=item.style||''}
ret.push(newItem)},this);return ret},initValue:function(){if(Ext.isObject(this.value)||Ext.isArray(this.value)){this.setValueEx(this.value);this.originalValue=this.getValue()}else{Ext.ux.form.SuperBoxSelect.superclass.initValue.call(this)}
if(this.mode==='remote'){this.setOriginal=!0}},addValue:function(value){if(Ext.isEmpty(value)){return}
var values=value;if(!Ext.isArray(value)){value=''+value;values=value.split(this.valueDelimiter)}
Ext.each(values,function(val){var record=this.findRecord(this.valueField,val);if(record){this.addRecord(record)}else if(this.mode==='remote'){this.remoteLookup.push(val)}},this);if(this.mode==='remote'){var q=this.remoteLookup.join(this.queryValuesDelimiter);this.doQuery(q,!1,!0)}},setValue:function(value){if(!this.rendered){this.value=value;return}
this.removeAllItems().resetStore();this.remoteLookup=[];this.addValue(value)},setValueEx:function(data){if(!this.rendered){this.value=data;return}
this.removeAllItems().resetStore();if(!Ext.isArray(data)){data=[data]}
this.remoteLookup=[];if(this.allowAddNewData&&this.mode==='remote'){Ext.each(data,function(d){var r=this.findRecord(this.valueField,d[this.valueField])||this.createRecord(d);this.addRecord(r)},this);return}
Ext.each(data,function(item){this.addItem(item)},this)},hasValue:function(val){var has=!1;this.items.each(function(item){if(item.value==val){has=!0;return!1}},this);return has},onSelect:function(record,index){if(this.fireEvent('beforeselect',this,record,index)!==!1){var val=record.data[this.valueField];if(this.preventDuplicates&&this.hasValue(val)){return}
this.setRawValue('');this.lastSelectionText='';if(this.fireEvent('beforeadditem',this,val,record,this.filteredQueryData)!==!1){this.addRecord(record)}
if(this.store.getCount()===0||!this.multiSelectMode){this.collapse()}else{this.restrictHeight()}}},onDestroy:function(){this.items.purgeListeners();this.killItems();if(this.allowQueryAll){Ext.destroy(this.buttonExpand)}
if(this.renderFieldBtns){Ext.destroy(this.buttonClear,this.buttonWrap)}
Ext.destroy(this.inputEl,this.wrapEl,this.outerWrapEl);Ext.ux.form.SuperBoxSelect.superclass.onDestroy.call(this)},autoSize:function(){if(!this.rendered){return this}
if(!this.metrics){this.metrics=Ext.util.TextMetrics.createInstance(this.el)}
var el=this.el,v=el.dom.value,d=document.createElement('div');if(v===""&&this.emptyText&&this.items.getCount()<1){v=this.emptyText}
d.appendChild(document.createTextNode(v));v=d.innerHTML;d=null;v+="&#160;";var w=Math.max(this.metrics.getWidth(v)+24,24);if(typeof this._width!='undefined'){w=Math.min(this._width,w)}
this.el.setWidth(w);if(Ext.isIE){this.el.dom.style.top='0'}
this.fireEvent('autosize',this,w);return this},shouldQuery:function(q){if(this.lastQuery){var m=q.match("^"+this.lastQuery);if(!m||this.store.getCount()){return!0}else{return(m[0]!==this.lastQuery)}}
return!0},doQuery:function(q,forceAll,valuesQuery,forcedAdd){q=Ext.isEmpty(q)?'':q;if(this.queryFilterRe){this.filteredQueryData='';var m=q.match(this.queryFilterRe);if(m&&m.length){this.filteredQueryData=m[0]}
q=q.replace(this.queryFilterRe,'');if(!q&&m){return}}
var qe={query:q,forceAll:forceAll,combo:this,cancel:!1};if(this.fireEvent('beforequery',qe)===!1||qe.cancel){return!1}
q=qe.query;forceAll=qe.forceAll;if(forceAll===!0||(q.length>=this.minChars)||valuesQuery&&!Ext.isEmpty(q)){if(forcedAdd||this.forceSameValueQuery||this.shouldQuery(q)){this.lastQuery=q;if(this.mode=='local'){this.selectedIndex=-1;if(forceAll){this.store.clearFilter()}else{this.store.filter(this.displayField,q)}
this.onLoad()}else{this.store.baseParams[this.queryParam]=q;this.store.baseParams[this.queryValuesIndicator]=valuesQuery;this.store.load({params:this.getParams(q)});if(!forcedAdd){this.expand()}}}else{this.selectedIndex=-1;this.onLoad()}}},onStoreLoad:function(store,records,options){var q=options.params[this.queryParam]||store.baseParams[this.queryParam]||"",isValuesQuery=options.params[this.queryValuesIndicator]||store.baseParams[this.queryValuesIndicator];if(this.removeValuesFromStore){this.store.each(function(record){if(this.usedRecords.containsKey(record.get(this.valueField))){this.store.remove(record)}},this)}
if(isValuesQuery){var params=q.split(this.queryValuesDelimiter);Ext.each(params,function(p){this.remoteLookup.remove(p);var rec=this.findRecord(this.valueField,p);if(rec){this.addRecord(rec)}},this);if(this.setOriginal){this.setOriginal=!1;this.originalValue=this.getValue()}}
if(q!==''&&this.allowAddNewData){Ext.each(this.remoteLookup,function(r){if(typeof r==="object"&&r[this.valueField]===q){this.remoteLookup.remove(r);if(records.length&&records[0].get(this.valueField)===q){this.addRecord(records[0]);return}
var rec=this.createRecord(r);this.store.add(rec);this.addRecord(rec);this.addedRecords.push(rec);(function(){if(this.isExpanded()){this.collapse()}}).defer(10,this);return}},this)}
var toAdd=[];if(q===''){Ext.each(this.addedRecords,function(rec){if(this.preventDuplicates&&this.usedRecords.containsKey(rec.get(this.valueField))){return}
toAdd.push(rec)},this)}else{var re=new RegExp(Ext.escapeRe(q)+'.*','i');Ext.each(this.addedRecords,function(rec){if(this.preventDuplicates&&this.usedRecords.containsKey(rec.get(this.valueField))){return}
if(re.test(rec.get(this.displayField))){toAdd.push(rec)}},this)}
this.store.add(toAdd);this.sortStore();if(this.store.getCount()===0&&this.isExpanded()){this.collapse()}}});Ext.reg('superboxselect',Ext.ux.form.SuperBoxSelect);Ext.ux.form.SuperBoxSelectItem=function(config){Ext.apply(this,config);Ext.ux.form.SuperBoxSelectItem.superclass.constructor.call(this)};Ext.ux.form.SuperBoxSelectItem=Ext.extend(Ext.ux.form.SuperBoxSelectItem,Ext.Component,{initComponent:function(){Ext.ux.form.SuperBoxSelectItem.superclass.initComponent.call(this)},onElClick:function(e){var o=this.owner;o.clearCurrentFocus().collapse();if(o.navigateItemsWithTab){this.focus()}else{o.el.dom.focus();var that=this;(function(){this.onLnkFocus();o.currentFocus=this}).defer(10,this)}},onLnkClick:function(e){if(e){e.stopEvent()}
this.preDestroy();if(!this.owner.navigateItemsWithTab){this.owner.el.focus()}},onLnkFocus:function(){this.el.addClass("x-superboxselect-item-focus");this.owner.outerWrapEl.addClass("x-form-focus")},onLnkBlur:function(){this.el.removeClass("x-superboxselect-item-focus");this.owner.outerWrapEl.removeClass("x-form-focus")},enableElListeners:function(){this.el.on('click',this.onElClick,this,{stopEvent:!0});this.el.addClassOnOver('x-superboxselect-item-hover')},enableLnkListeners:function(){this.lnk.on({click:this.onLnkClick,focus:this.onLnkFocus,blur:this.onLnkBlur,scope:this})},enableAllListeners:function(){this.enableElListeners();this.enableLnkListeners()},disableAllListeners:function(){this.el.removeAllListeners();this.lnk.un('click',this.onLnkClick,this);this.lnk.un('focus',this.onLnkFocus,this);this.lnk.un('blur',this.onLnkBlur,this)},onRender:function(ct,position){Ext.ux.form.SuperBoxSelectItem.superclass.onRender.call(this,ct,position);var el=this.el;if(el){el.remove()}
this.el=el=ct.createChild({tag:'li'},ct.last());el.addClass('x-superboxselect-item');var btnEl=this.owner.navigateItemsWithTab?(Ext.isSafari?'button':'a'):'span';var itemKey=this.key;Ext.apply(el,{focus:function(){var c=this.down(btnEl+'.x-superboxselect-item-close');if(c){c.focus()}},preDestroy:function(){this.preDestroy()}.createDelegate(this)});this.enableElListeners();el.update(this.caption);var cfg={tag:btnEl,'class':'x-superboxselect-item-close',tabIndex:this.owner.navigateItemsWithTab?'0':'-1'};if(btnEl==='a'){cfg.href='#'}
this.lnk=el.createChild(cfg);if(!this.disabled){this.enableLnkListeners()}else{this.disableAllListeners()}
this.on({disable:this.disableAllListeners,enable:this.enableAllListeners,scope:this});this.setupKeyMap()},setupKeyMap:function(){this.keyMap=new Ext.KeyMap(this.lnk,[{key:[Ext.EventObject.BACKSPACE,Ext.EventObject.DELETE,Ext.EventObject.SPACE],fn:this.preDestroy,scope:this},{key:[Ext.EventObject.RIGHT,Ext.EventObject.DOWN],fn:function(){this.moveFocus('right')},scope:this},{key:[Ext.EventObject.LEFT,Ext.EventObject.UP],fn:function(){this.moveFocus('left')},scope:this},{key:[Ext.EventObject.HOME],fn:function(){var l=this.owner.items.get(0).el.focus();if(l){l.el.focus()}},scope:this},{key:[Ext.EventObject.END],fn:function(){this.owner.el.focus()},scope:this},{key:Ext.EventObject.ENTER,fn:function(){}}]);this.keyMap.stopEvent=!0},moveFocus:function(dir){var el=this.el[dir=='left'?'prev':'next']()||this.owner.el;el.focus.defer(100,el)},preDestroy:function(supressEffect){if(this.fireEvent('remove',this)===!1){return}
var actionDestroy=function(){if(this.owner.navigateItemsWithTab){this.moveFocus('right')}
this.hidden.remove();this.hidden=null;this.destroy()};if(supressEffect){actionDestroy.call(this)}else{this.el.hide({duration:0.2,callback:actionDestroy,scope:this})}
return this},kill:function(){this.hidden.remove();this.hidden=null;this.purgeListeners();this.destroy()},onDisable:function(){if(this.hidden){this.hidden.dom.setAttribute('disabled','disabled')}
this.keyMap.disable();Ext.ux.form.SuperBoxSelectItem.superclass.onDisable.call(this)},onEnable:function(){if(this.hidden){this.hidden.dom.removeAttribute('disabled')}
this.keyMap.enable();Ext.ux.form.SuperBoxSelectItem.superclass.onEnable.call(this)},onDestroy:function(){Ext.destroy(this.lnk,this.el);Ext.ux.form.SuperBoxSelectItem.superclass.onDestroy.call(this)}});Ext.ns('Ext.ux');Ext.ux.PanelCollapsedTitle=(function(){var rotatedCls='x-panel-header-rotated';var supportsSVG=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1");var patchCollapsedElem=function(){var verticalText=((this.region=='east')||(this.region=='west'));var containerStyle='overflow: visible; padding: 0; border: none; background: none;';if(verticalText&&supportsSVG){this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:'div',style:'height: 100%; overflow: hidden;'});var SVGNS='http://www.w3.org/2000/svg';var svg=document.createElementNS(SVGNS,'svg');this.collapsedHeader.dom.appendChild(svg);svg.setAttribute('width','100%');svg.setAttribute('height','100%');var textContainer=document.createElementNS(SVGNS,'text');textContainer.setAttribute('x',8);textContainer.setAttribute('y',1);textContainer.setAttribute('transform','rotate(90 6 1)');textContainer.setAttribute('class','x-panel-header '+rotatedCls);svg.appendChild(textContainer);this.collapsedHeaderText=document.createTextNode(this.title);textContainer.appendChild(this.collapsedHeaderText);var color=Ext.fly(textContainer).getStyle('color');textContainer.setAttribute('style',containerStyle+';fill: '+000000+';')}else{var titleElemStyle='position: relative;';if(verticalText){titleElemStyle+='white-space: nowrap; writing-mode: tb-rl; top: 1px; left: 3px;'}else{titleElemStyle+='top: 2px;';containerStyle+='padding-left: 4px; margin-right: 18px;'};this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:'div',style:containerStyle,cls:'x-panel-header '+rotatedCls,html:'<span style="'+titleElemStyle+'">'+this.title+'</span>'});this.collapsedHeaderText=this.collapsedHeader.first()};if(this.collapsedIconCls)this.setCollapsedIconClass(this.collapsedIconCls)};this.init=function(p){if(p.collapsible||p.collapsed){var verticalText=((p.region=='east')||(p.region=='west'));p.setTitle=Ext.Panel.prototype.setTitle.createSequence(function(t){if(this.rendered&&this.collapsedHeaderText){if(this.collapsedHeaderText.dom){this.collapsedHeaderText.dom.innerHTML=t}else if(this.collapsedHeaderText.replaceData){this.collapsedHeaderText.nodeValue=t}}});p.setCollapsedIconClass=function(cls){var old=this.collapsedIconCls;this.collapsedIconCls=cls;if(this.rendered&&this.collapsedHeader){var hd=this.collapsedHeader,img=hd.child('img.x-panel-inline-icon');if(img){if(this.collapsedIconCls){Ext.fly(img).replaceClass(old,this.collapsedIconCls)}else{Ext.fly(img).remove()}}else if(this.collapsedIconCls){Ext.DomHelper.insertBefore(hd.dom.firstChild,{tag:'img',src:Ext.BLANK_IMAGE_URL,cls:'x-panel-inline-icon '+this.collapsedIconCls,style:verticalText?'display: block; margin: 1px 2px;':'margin-top: 2px; margin-right: 4px'})}}};p.on('render',function(){if(this.ownerCt.rendered&&this.ownerCt.layout.hasLayout){patchCollapsedElem.call(p)}else{this.ownerCt.on('afterlayout',patchCollapsedElem,p,{single:!0})}},p)}};return this})();ImageDragZone=function(view,config){this.view=view;ImageDragZone.superclass.constructor.call(this,view.getEl(),config)};Ext.extend(ImageDragZone,Ext.dd.DragZone,{getDragData:function(e){var target=e.getTarget('.thumb-cell-selected');if(target){var view=this.view;if(!view.isSelected(target)){view.onClick(e)}
var selNodes=view.getSelectedNodes();var dragData={nodes:selNodes};var img=null;var selItem=null;if(selNodes.length==1){selItem=view.store.getAt(selNodes[0].viewIndex);if((!selItem.data.Mmi||!selItem.data.Mmi.Id)&&!selItem.data.Ocupado){selNodes.remove(selNodes[0]);return!1}
img=document.createElement('img');img.src='../images/palets/palet.png';dragData.ddel=img;dragData.sourceEl=target;dragData.single=!0}else{var div=document.createElement('div');var toMove=[];img=document.createElement('img');img.src='../images/palets/palet.png';div.appendChild(img);for(var i=0,len=selNodes.length;i<len;i++){selItem=view.store.getAt(selNodes[i].viewIndex);if((selItem.data.Mmi&&selItem.data.Mmi.Id)||selItem.data.Ocupado){toMove.push(selNodes[i])}}
var count=document.createElement('div');if(toMove.length==0)
return!1;count.innerHTML=toMove.length+' Mmis';div.appendChild(count);dragData.ddel=div;sourceEl:target;dragData.multi=!0;dragData.nodes=toMove}
return dragData}
return!1},afterRepair:function(){for(var i=0,len=this.dragData.nodes.length;i<len;i++){Ext.fly(this.dragData.nodes[i]).frame('#8db2e3',1)}
this.dragging=!1},getRepairXY:function(e){if(!this.dragData.multi){var xy=Ext.Element.fly(this.dragData.ddel).getXY();xy[0]+=3;xy[1]+=3;return xy}
return!1}});Ext.ns('ERP');ERP.depositoPanel=Ext.extend(Ext.Panel,{almacenId:null,depositoId:null,mover:!0,activeItem:0,layout:'card',padding:'5',modoVista:1,destroy:function(){Ext.destroy(this.dd);Ext.destroy(this.depositoDragZone);Ext.destroy(this.depositoTempDragZone)},hideTemporal:function(){this.get(0).get(2).hide();this.doLayout()},showTemporal:function(){this.get(0).get(2).show();this.doLayout()},setPerspectiva:function(modo){if(!this.comboDeposito.getValue()){app.publish('/desktop/showError','Debe seleccionar primero el Depósito.');return}else if(!this.comboAlmacenes.getValue()){app.publish('/desktop/showError','Debe seleccionar primero el Almacen.');return}
this.perspectiva=modo;this.deposito.store.baseParams.perspectiva=modo;this.deposito.store.reload()},setModoVista:function(modo){this.modoVista=modo;if(modo==1){this.modoGrillaBt.toggle(!1);this.getTopToolbar().get(1).show();this.layout.setActiveItem(0);this.deposito.clearSelections();this.gridMmis.getSelectionModel().clearSelections()}else if(modo==2){this.modoGraficoBt.toggle(!1);this.layout.setActiveItem(1);this.getTopToolbar().get(1).hide();this.deposito.clearSelections();this.gridMmis.getSelectionModel().clearSelections()}},initComponent:function(){this.comboDeposito=new Ext.ux.form.ComboBox({displayFieldTpl:'{TipoDeDireccion_cdisplay}: {Direccion}',tpl:'<tpl for="."><div class="x-combo-list-item"><h3>{TipoDeDireccion_cdisplay} - {Localidad_cdisplay}</h3>{Direccion}</div></tpl>',selectOnFocus:!0,forceSelection:!0,forceReload:!0,loadingText:'Cargando...',emptyText:'Seleccione un Depósito',lazyRender:!0,triggerAction:'all',valueField:'Id',autoLoad:!1,store:new Ext.data.JsonStore({url:'/datagateway/combolist/model/DepositosPropios/m/Base/TipoDeDireccion/2',autoLoad:!0,root:'rows',idProperty:'Id',storeId:'DepositoStore32sd',totalProperty:'count',fields:['Id','TipoDeDireccion_cdisplay','Direccion','Localidad_cdisplay']})});this.comboAlmacenes=new Ext.ux.form.ComboBox({displayField:'Descripcion',selectOnFocus:!0,forceSelection:!0,forceReload:!0,loadingText:'Cargando...',lazyRender:!0,triggerAction:'all',valueField:'Id',autoLoad:!1,store:new Ext.data.JsonStore({url:'/datagateway/combolist/model/Almacenes/m/Almacenes',root:'rows',autoLoad:!1,idProperty:'Id',storeId:'AlmacenesStore32sd',totalProperty:'count',fields:['Id','Descripcion','TieneRack','TipoDeAlmacen','Perspectiva']})});this.perspectivaButton=new Ext.Button({tooltip:'Perspectiva',icon:'images/32/3d-view.png',scale:'large',menu:{items:['<b class="menu-title">Perspectiva</b>',{group:'perspectiva',text:'Frente',scope:this,checked:!1,handler:function(){this.setPerspectiva(1)}},{group:'perspectiva',text:'Lateral',scope:this,checked:!1,handler:function(){this.setPerspectiva(3)}},{group:'perspectiva',text:'Arriba',scope:this,checked:!1,handler:function(){this.setPerspectiva(2)}}]}});this.verDetalleMmiButton=new Ext.Button({tooltip:'Ver en el Detalle de Mmi',icon:'images/32/application_view_icons.png',scale:'large',menu:{items:['<b class="menu-title">Ver</b>',{group:'detallemmi',text:'Identificador',scope:this,checked:!0,handler:function(){this.deposito.setMostrarEnDetalle(1)}},{group:'detallemmi',text:'Lote',scope:this,checked:!1,handler:function(){this.deposito.setMostrarEnDetalle(2)}},{group:'detallemmi',text:'Cantidad',scope:this,checked:!1,handler:function(){this.deposito.setMostrarEnDetalle(3)}},{group:'detallemmi',text:'Fecha Vencimiento',scope:this,checked:!1,handler:function(){this.deposito.setMostrarEnDetalle(4)}},{group:'detallemmi',text:'Fecha Elaboración',scope:this,checked:!1,handler:function(){this.deposito.setMostrarEnDetalle(5)}}]}});this.modoGraficoBt=new Ext.Button({tip:'Grafica',icon:'images/32/racks.png',enableToggle:!0,pressed:!0,handler:function(){this.setModoVista(1)},scope:this});this.modoGrillaBt=new Ext.Button({icon:'images/32/grid.png',enableToggle:!0,tip:'Grilla',enableToggle:!0,handler:function(){this.setModoVista(2)},scope:this});this.gridMmis=Ext.ComponentMgr.create({xtype:"radgridpanel",filters:!0,url:"/default/datagateway",model:"Mmis",module:"Almacenes",forceFit:!0,stateful:!1,iniSection:"almacenes",border:!1,autoSave:!0,loadAuto:!1,view:new Ext.grid.GroupingView({enableNoGroups:!1,forceFit:!0,resaltar:{tipo:'nada'},fresaltar:function(r){switch(this.resaltar.tipo)
{case 'RemitoArticuloSalida':return r.get('RemitoArticuloSalida')==this.resaltar.valor;break;case 'RemitoArticuloIngreso':return r.get('RemitoArticulo')==this.resaltar.valor;break;case 'TemporalesProduccion':return r.data.AsignadoODPDetalleTemporal==this.resaltar.valor;break;default:return!1}},resaltarNada:function(){this.resaltar={tipo:'nada'}},resaltarRemitoArticuloSalida:function(a){this.resaltar={tipo:'RemitoArticuloSalida',valor:a}},resaltarRemitoArticuloIngreso:function(a){this.resaltar={tipo:'RemitoArticuloIngreso',valor:a}},resaltarTemporalesProduccion:function(a){this.resaltar={tipo:'TemporalesProduccion',valor:a}},getRowClass:function(record,rowIndex,p,store){if(this.fresaltar(record))return 'x-grid3-row-blue';return 'x-grid3-row'},hideGroupedColumn:!0,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "MMI" : "MMI"]})'})});this.comboDeposito.on('select',function(c,r,i){this.comboAlmacenes.store.baseParams.Deposito=r.data.Id;this.comboAlmacenes.clearValue();this.deposito.store.removeAll();this.depositoId=r.data.Id;if(this.depositoTemp){this.depositoTemp.store.baseParams.deposito=this.depositoId;this.depositoTemp.store.reload()}
this.gridMmis.setPermanentFilter(0,'Deposito',r.data.Id);this.gridMmis.store.load()},this);this.comboAlmacenes.on('beforequery',function(){var v=this.comboDeposito.getValue();if(!v){app.publish('/desktop/showError','Debe seleccionar primero el Deposito.');return!1}},this);var t1=new Ext.Toolbar.TextItem(' ');var t2=new Ext.Toolbar.TextItem(' ');this.bbar=new Ext.ux.StatusBar({busyText:'Cargando',defaultIconCls:'default-icon',text:'Listo',iconCls:'ready-icon',updateSeleccion:function(datos){Ext.fly(t1.el).update(datos+'&nbsp;')},updateTotal:function(datos){Ext.fly(t2.el).update(datos+'&nbsp;')},items:['-',t1,t2]});this.deposito=new ERP.depositoDataView({almacen:this.almacenId});this.deposito.on('paletPartido',function(){if(this.mover)this.depositoTemp.store.reload()},this);this.deposito.on('paletModificado',function(){if(this.mover)this.depositoTemp.store.reload()},this);this.deposito.on('mouseenter',function(t,i){var html=this.deposito.getDetalleMmiHtml(i);this.panelDetalles.update(html)},this);this.deposito.on('mouseleave',function(t,i){this.panelDetalles.update('')},this);this.panelDetalles=new Ext.Panel({border:!0,region:'east',width:240,margins:'0 0 5 0',bodyCssClass:'panelDeDetalles panelDetalleAzul',});this.items=[{layout:'border',border:!1,items:[{region:'center',frame:!1,autoScroll:!0,border:!1,xtype:'panel',activeItem:0,layout:'fit',items:[this.deposito,]},this.panelDetalles]},this.gridMmis];if(this.mover){this.agregarDepositoTemp()}
this.comboAlmacenes.on('select',function(c,e,i){this.deposito.cambiarAlmacen(e.data);this.perspectivaButton.menu.items.items[e.data.Perspectiva].setChecked(!0,!0)},this);this.tbar=[{xtype:'buttongroup',title:'Vista',defaults:{scale:'large'},columns:3,items:[this.modoGraficoBt,this.modoGrillaBt,this.comboDeposito]},{xtype:'buttongroup',title:'Almacen',columns:6,items:[this.comboAlmacenes,this.perspectivaButton,this.verDetalleMmiButton,{tooltip:'Resaltar',scale:'large',iconCls:'x-btn-text-icon',icon:'images/32/resaltarpalet.png',menu:new Ext.menu.Menu({items:['<b class="menu-title">Resaltar</b>',new ERP.depositoResaltadorMenu({text:'Rojo',deposito:this.deposito}),new ERP.depositoResaltadorMenu({color:'azul',text:'Azul',deposito:this.deposito})]})},{enableToggle:!0,scale:'large',icon:'images/32/application_view_detail.png',tooltip:'Racks',pressed:!0,toggleHandler:function(item,pressed){Ext.select("#x-desktop .thumb-cell .ubicDesc").toggle()}},{enableToggle:!0,scale:'large',tooltip:'Detalles',icon:'images/32/application_side_list_r32.png',pressed:!0,toggleHandler:function(item,pressed){if(pressed){this.panelDetalles.show();this.doLayout()}else{this.panelDetalles.hide();this.doLayout()}},scope:this}]},];ERP.depositoPanel.superclass.initComponent.call(this);this.depositoTemp.on('afterrender',this.setDropTargets,this)},agregarDepositoTemp:function(){this.depositoTemp=new ERP.depositoDataView({style:"background-color:#efefef",url:'/Almacenes/Almacenes/gettemporal'});this.depositoTemp.on('mouseenter',function(t,i){var html=this.depositoTemp.getDetalleMmiHtml(i);this.panelDetalles.update(html)},this);this.depositoTemp.on('mouseleave',function(t,i){this.panelDetalles.update('')},this);this.items[0].items.push({xtype:'panel',region:'south',height:80,border:!0,layout:'fit',items:[this.depositoTemp]})},onDropDeposito:function(source,e,data){return!1},setDropTargets:function(){if(!this.mover)return;this.deposito.ddGroup='ubicacion';this.dropTarget=this.get(0).get(0).body;this.dd=new Ext.dd.DropTarget(this.dropTarget,{ddGroup:'ubicacion',scope:this,notifyOver:function(source,e,data){var comboAlmacenes=this.scope.comboAlmacenes;var rAlmacenDestino=comboAlmacenes.store.getAt(comboAlmacenes.store.findExact('Id',comboAlmacenes.getValue()));if(!rAlmacenDestino)return!1;return this.dropAllowed},notifyDrop:function(source,e,data){var comboAlmacenes=this.scope.comboAlmacenes;var rAlmacenDestino=comboAlmacenes.store.getAt(comboAlmacenes.store.findExact('Id',comboAlmacenes.getValue()));if(!rAlmacenDestino)return!1;switch(e.getTarget().getAttribute('class')){case 'thumb':e.target=e.getTarget().parentNode.parentNode;break;case 'ubicMmis':e.target=e.getTarget().parentNode;break;case 'ubicDesc':e.target=e.getTarget().parentNode.parentNode;break}
var itemTo=[];var items=[];var cantMoves=0;var indexTo=null;var i=0;switch(source.id){case this.scope.depositoTemp.id:indexTo=this.scope.deposito.store.findExact('Id',e.getTarget().getAttribute('ubicacion'));var almacenOrigen=this.scope.depositoTemp.store.getAt(data.nodes[0].viewIndex).data.Almacen;Ext.each(data.nodes,function(item,number,all){var selectedItem=this.scope.depositoTemp.store.getAt(item.viewIndex);var itemTo=this.scope.deposito.store.getAt(indexTo+cantMoves);items.push({desde:selectedItem.data.Id,hacia:(rAlmacenDestino.data.TieneRack!='0')?itemTo.data.Id:null});if(indexTo!=-1)cantMoves++},this);Models.Almacenes_Model_AlmacenesMapper.moverMmis(almacenOrigen,rAlmacenDestino.data.Id,items,this.scope.depositoId,function(){this.scope.depositoTemp.store.reload();this.scope.deposito.store.reload()},this);return!0;break;case(this.scope.deposito.id):var almacenMov=comboAlmacenes.store.getAt(comboAlmacenes.store.findExact('Id',comboAlmacenes.getValue()));if(!almacenMov.data.TieneRack)
return app.publish('/desktop/showError','No se pueden mover MMIs en el mismo almacen no rackeable');indexTo=this.scope.deposito.store.findExact('Id',parseInt(e.getTarget().getAttribute('ubicacion')));var ubicacionDestino;var posicionInvalida=!1;Ext.each(data.nodes,function(item,number,all){ubicacionDestino=this.scope.deposito.store.getAt(indexTo+cantMoves);if(!ubicacionDestino||posicionInvalida){posicionInvalida=!0;return!1}
items.push({desde:this.scope.deposito.store.getAt(item.viewIndex).data.Id,hacia:ubicacionDestino.data.Id});if(indexTo!=-1)cantMoves++;i++;return!0},this);if(posicionInvalida)return!1;Models.Almacenes_Model_AlmacenesMapper.moverMmis(almacenMov.data.Id,almacenMov.data.Id,items,this.scope.depositoId,function(){this.scope.deposito.store.reload()},this);return!0;break;default:this.scope.onDropDeposito(source,e,data);return!1;break}}});this.get(0).get(2).ddGroup='ubicacion';this.ddt=new Ext.dd.DropTarget(this.get(0).get(2).body,{scope:this,ddGroup:'ubicacion',notifyOver:function(source,e,data){var comboAlmacenes=this.scope.comboAlmacenes;var rAlmacenDestino=comboAlmacenes.store.getAt(comboAlmacenes.store.findExact('Id',comboAlmacenes.getValue()));if(!rAlmacenDestino)return!1;return this.dropAllowed},notifyDrop:function(source,e,data){var comboAlmacenes=this.scope.comboAlmacenes;var rAlmacen=comboAlmacenes.store.getAt(comboAlmacenes.store.findExact('Id',comboAlmacenes.getValue()));if(e.getTarget().getAttribute('class')=='thumb')
e.target=e.getTarget().parentNode;if(source.id==this.scope.deposito.id){var items=[];var selectedItem;Ext.each(data.nodes,function(item,number,all){selectedItem=this.scope.deposito.store.getAt(item.viewIndex);items.push({desde:selectedItem.data.Id,hacia:null})},this);Models.Almacenes_Model_AlmacenesMapper.moverMmis(selectedItem.data.Mmi.Almacen||selectedItem.data.Almacen,null,items,this.scope.depositoId,function(){this.scope.deposito.store.reload();this.scope.depositoTemp.store.reload()},this);return!0}else{return!1}}});this.depositoDragZone=new ImageDragZone(this.deposito,{containerScroll:!0,ddGroup:'ubicacion',isTarget:!0});this.depositoTempDragZone=new ImageDragZone(this.depositoTemp,{containerScroll:!0,ddGroup:'ubicacion',isTarget:!0})}});Ext.ns('Rad');Rad.ParameterTable=Ext.extend(Ext.grid.PropertyGrid,{constructor:function(config){config=config||{};if(!config.masterGrid)alert('Rad.ParameterTable necesita el parametro masterGrid');if(!config.model)alert('Rad.ParameterTable necesita el parametro model');if(!config.module)alert('Rad.ParameterTable necesita el parametro module');Ext.grid.PropertyGrid.superclass.constructor.call(this,config);if(config.caracteristicas){this.customEditors={};for(var i=0;i<config.caracteristicas.length;i++){var c=config.caracteristicas[i];this.customEditors[c.Descripcion]=this.getEditorFromType(c.TipoDeCampo,c.Id)}}
this.on('validateedit',function(e){var selected=this.masterGrid.getSelectionModel().getSelected();if(selected){Rad.callRemoteJsonAction({url:'/default/datagateway/setcaracteristicas',params:{model:this.model,m:this.module,property:e.record.id,value:e.value,id:selected.data.Id},async:!1,success:function(){},failure:function(r){e.record.data.value=e.originalValue;return!0}})}},this)},getEditorFromType:function(fieldType,caracteristica){switch(fieldType){case '1':return new Ext.grid.GridEditor(new Ext.form.NumberField({selectOnFocus:!0,decimalPrecision:0}));break;case '2':return new Ext.grid.GridEditor(new Ext.form.NumberField({selectOnFocus:!0,decimalPrecision:6}));break;case '3':return new Ext.grid.GridEditor(new Ext.ux.form.XDateField({format:'d/m/Y'}));break;case '5':return new Ext.grid.GridEditor(new Ext.form.ComboBox({displayField:'description',valueField:'description',lazyRender:!0,forceSelection:!0,autocomplete:!0,allowBlank:!0,store:new Ext.data.JsonStore({root:'rows',totalProperty:'count',idProperty:'id',url:'/default/datagateway/getcaracteristicaslista/caracteristica/'+caracteristica+'/model/'+this.model+'/m/'+this.module,fields:[{name:'id'},{name:'description'}]}),typeAhead:!1,triggerAction:'all',selectOnFocus:!0}));break;case '6':return new Ext.grid.GridEditor(new Ext.form.ComboBox({store:['Si','No'],triggerAction:'all',selectOnFocus:!0,}));break;case '7':return new Ext.grid.GridEditor(new Ext.ux.form.DateTime(new Ext.ux.form.XDateField({dateFormat:'d/m/Y',timeFormat:'H:i:s'})));break}},getRowSelectHandler:function(){var that=this;return function(i,id,r){if(!r.data.Id)return;var el=that.getGridEl();el.mask();Rad.callRemoteJsonAction({url:'/default/datagateway/getcaracteristicas/model/'+that.model+'/m/'+that.module,params:{id:r.data.Id},success:function(response){that.setSource(response.data);el.unmask()},failure:function(){el.unmask()}})}}});Ext.ns('Rad');Rad.wamp=Ext.extend(Object,{session:null,constructor:function(config){t=this;Ext.apply(this,config||{});ab.connect(this.wsuri,function(s){t.session=s},function(code,reason){t.session=null})},publish:function(topic,ev){this.checkConn();this.session.publish(topic,ev)},subscribe:function(topic,callback){this.checkConn();this.session.subscribe(topic,callback)},isConected:function(){return(this.session!=null)},getSession:function(){return this.session},checkConn:function()
{if(!this.isConected())throw{message:"No esta conectado al Server WAMP"}}})
